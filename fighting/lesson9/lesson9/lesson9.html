<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<meta name="GENERATOR" content="Microsoft FrontPage 6.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>New Page 1</title>
<style>
<!--
table.MsoTableGrid
	{border:1.0pt solid windowtext;
	font-size:10.0pt;
	font-family:"Times New Roman","serif"}
-->
</style>
</head>

<body>

<div align="center">
  <center>
  <table border="0" width="740" height="350" cellspacing="0" cellpadding="0">
    <!-- MSTableType="nolayout" -->
	<tr>
      <td width="740" height="133" background="Site/top.jpg" colspan="3">&nbsp;</td>
    </tr>
    <tr>
      <td width="127" height="356" background="Site/middle1.jpg" valign="top">
        <p align="left">
        <b><font face="Arial" size="1" color="#505866">&nbsp;&nbsp;&nbsp; 
		<a href="http://www.blitz-school.info"><font color="#FFFF99">Курсы</font></a><br>
        &nbsp;&nbsp;&nbsp; </font><font face="Arial" size="1" color="#FFFF99">
		<a href="http://www.blitz-school.info/reg.html"><font color="#FFFF99">Регистрация</font></a><br>
        &nbsp;&nbsp;&nbsp;
		<a href="http://www.blitz-school.info/study_tech.html">
		<font color="#FFFF99">Методика</font></a><br>
        &nbsp;&nbsp;&nbsp; </font>
		<a href="http://www.blitz-school.info/program.html"><font face="Arial" size="1" color="#FFFF99">Оглавление</font></a><font face="Arial" size="1" color="#FFFF99"><br>
        &nbsp;&nbsp;&nbsp; <a href="http://www.blitz-school.info/login.html">
		<font color="#FFFF99">Для учащихся</font></a><br>
        &nbsp;&nbsp;&nbsp; </font></b>
		<img border="0" src="../navdiv.gif" width="80" height="4"><br>
        <b><font size="1" face="Arial" color="#505866">&nbsp;&nbsp;&nbsp;
        <a href="http://www.blitz-school.info/articles.html">
		<font color="#FFFF99">Статьи</font></a><br>
        &nbsp;&nbsp;&nbsp; </font><font size="1" face="Arial" color="#FFFF99">
		<a href="http://www.blitz-school.info/instrum.html">
		<font color="#FFFF99">Инструменты</font></a><br>
		<span lang="en-us">&nbsp;&nbsp;&nbsp; </span>
		<a href="http://www.blitz-school.info/contacts.html">
		<font color="#FFFF99">Контакты</font></a><br>
		<span lang="en-us">&nbsp;&nbsp;&nbsp; </span></font></b>&nbsp;</td>
      <td width="586" height="356" background="Site/bg.gif" valign="top">

<p align="center"><font color="#008000"><b><font size="5"><span lang="ru">Урок 9. </span></font></b>
<span lang="ru"><font size="5"><b>Использование магии</b></font><br>
</span>
</font><b></p>
<p align="justify"><font face="Arial" size="2" color="#000080">9</font><span lang="ru"><font face="Arial" color="#000080"><a name="kopv"><font size="2">.1. 
</font></a></font></span></b><a name="kopv"><b>
<font face="Arial" size="2" color="#000080">Магические свитки </font></b></a>
<span lang="ru"><b><a name="kopv">
<font size="2" face="Arial" color="#000080">&nbsp;.</font></a></b><font size="2" face="Arial">
<br>
</font></span><font size="2" face="Arial">
&nbsp;&nbsp;&nbsp;&nbsp; <span lang="ru"><br>
&nbsp;&nbsp;&nbsp; Так как мы создаем игру под названием &quot;Клуб Меча и Магии&quot;, 
наступило время подумать и об использовании магических свитков. Однако для того, 
что воспользоваться свитком, нужно обладать еще одной характеристикой - 
интеллектом. Обычно интеллект свойственен магам, но мы для упрощения позволим 
владеть этим статом кому угодно. Единственное - поднятие интеллекта всегда 
приводит к тому, что игрок не добирает в других статах - силе, ловкости и т.д.<br>
&nbsp;&nbsp; Давайте добавим поле интеллект в нашу самую первую таблицу
</span><span lang="en-us"><b>users</b>.</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table1">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		Character_Intelligence INT DEFAULT 0, <font color="#008000">/*Интеллект 
		перса */</font><br>
		Character_Intelligence_Total INT DEFAULT 0, <font color="#008000">
		/*Интеллект перса<span lang="en-us"> </span>с учетом вещей*/</font></font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<span lang="ru">&nbsp;&nbsp; Обязательным условием использования магии сделаем 
то, что персонаж должен обладать характеристикой &quot;интеллект&quot; больше нуля.</span><span lang="en-us">
</span>Т<span lang="ru">олько в этом случае ему станут подвластны магии стихий.
<br>
&nbsp;&nbsp; Давайте создадим два свитка для огненной и воздушной магии. Вот 
они:</span></font></p>
<table border="1" width="100%" id="table2">
	<tr>
		<td width="310">
		<img border="0" src="9_1/mscroll1.jpg" width="96" height="30">&nbsp; 
		Удар огня</td>
		<td><img border="0" src="9_1/mscroll2.jpg" width="96" height="30"> Удар 
		воздуха</td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<span lang="ru">&nbsp;&nbsp; Обычно при использовании свитка тратится мана. Мана 
в компьютерных играх - очки, определяющие количество специальной магической 
энергии, расходуемой на различные заклинания и прочие магические способности. 
Таким образом, сразу возникает необходимость учитывать очки маны у нашего 
персонажа. Безусловно нам понадобятся еще пару полей в таблице
</span><span lang="en-us"><b>users</b>. </span>В<span lang="ru">от они:&nbsp;&nbsp;&nbsp;
</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table3">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		Character_CurMana INT DEFAULT 0, <font color="#008000">/* текущие очки 
		маны */</font><br>
		Character_MaxMana INT DEFAULT 0, <font color="#008000">/* максимальные 
		очки маны */</font></font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<span lang="ru">&nbsp; Наши свитки, при использовании тоже будут забирать 
какое-то количество маны персонажа, что определится в поле
</span><span lang="en-us"><font color="#000080">ManaCost</font> </span>т<span lang="ru">аблицы
</span><span lang="en-us"><b>Items_List</b> (</span>справочника предметов<span lang="en-us">)</span>.<span lang="ru"><br>
&nbsp;&nbsp; Давайте, пользуясь случаем, добавим два свитка в справочник 
предметов.</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table4">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#008080">/* немного магических свитков */</font><br>
		INSERT INTO Items_List (IL_ID,ItemType,ItemNo,ItemName,Item_StateCost,Item_Image, 
		ItemSlotName,Item_Level, Item_FullLife,<font color="#000080">ManaCost</font>,Min_Damage)
		<br>
		VALUES(14,11,1,'Удар огня',14,'mscroll1.jpg','Scroll',1,30,<span style="background-color: #FFFF99"><font color="#000080">3</font></span>,5);<br>
		<br>
		INSERT INTO Items_List (IL_ID,ItemType,ItemNo,ItemName,Item_StateCost,Item_Image, 
		ItemSlotName,Item_Level, Item_FullLife,<font color="#000080">ManaCost</font>,Min_Damage)
		<br>
		VALUES(15,12,1,'Удар воздуха',14,'mscroll2.jpg','Scroll',1,30,<span style="background-color: #FFFF99"><font color="#000080">3</font></span>,5);<br>
&nbsp;</font></td>
	</tr>
</table>
<p><font face="Courier" size="2">&nbsp;</font><font size="2" face="Arial"> Как 
Вы видите, за каждый ход игрока, будет использоваться 3 очка маны (</font><font color="#000080" face="Courier" size="2">ManaCost 
= 3</font><font size="2" face="Arial">).</font></p>
<p align="justify"><font size="2" face="Arial">
<a name="kopv0"><font color="#000080"><b>9</b></font></a><b><span lang="ru"><font face="Arial" color="#000080"><a name="kopv0"><font size="2">.2. 
</font></a></font></span><font size="2" face="Arial" color="#000080">
<span lang="ru"><a name="kopv0">Слот для свитков</a><a name="kopv1">.</a></span></font></b><span lang="ru"> <br>
<br>
&nbsp;&nbsp; Вполне естественно, что для использования свитка в бою, его нужно 
поместить в специальный слот. Ранее мы рассматривали слоты для оружия и 
доспехов, научились с ними работать, перенося в них предметы из рюкзака и 
обратно. Теперь нам нужно реализовать работу со слотом для хранения и 
использования магических свитков.<br>
&nbsp;&nbsp;&nbsp;&nbsp; Для начала дополним таблицу
</span><span lang="en-us"><b>users</b> </span>е<span lang="ru">ще одним полем -
<font color="#000080">Scroll_Slot</font>, в котором и будет располагаться 
одеваемый на время поединка свиток.</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table5">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		Scroll_Slot INT DEFAULT 0,<font color="#008080"> /*слот свитка*/</font></font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<span lang="ru"> Давайте поэкспериментируем с персонажем
</span><span lang="en-us">&quot;Defender&quot; </span>и<span lang="ru"> добавим ему 
напрямую свиток огня прямо в его рюкзак:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table6">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		INSERT INTO Items (IT_ID,<font color="#000080">IL_ID</font>,Item_Owner,Item_Position,Item_CurrentLife) 
		VALUES(4,<span style="background-color: #FFFF99"><font color="#000080">14</font></span>,2,2,0);</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<span lang="ru"> &nbsp;&nbsp; Мы добавили действительно свиток огня, потому что 
значение поля
</span><span lang="en-us"><font color="#000080">IL_ID</font> </span>е<span lang="ru">го 
равно <b>14</b>, точно как в справочнике предметов. Кроме того, персонаж с ником 
&quot;</span><span lang="en-us">Defender</span>&quot;<span lang="en-us"> </span>и<span lang="ru">меет
</span><span lang="en-us"><font color="#000080">USER_ID</font> = 2, </span>ч<span lang="ru">ему 
соответствует поле
</span></font><font face="Courier" size="2">
		Item_Owner</font><font size="2" face="Arial"><span lang="ru"> из таблицы
</span></font><b><font face="Courier" size="2">
		Items</font></b><font size="2" face="Arial"><span lang="ru">.<br>
&nbsp;&nbsp; Поместите картинки свитков
</span><span lang="en-us">(</span></font><font face="Courier" size="2">mscroll1.jpg<span lang="en-us">
</span>и mscroll2.jpg</font><font size="2" face="Arial"><span lang="en-us">)
</span><span lang="ru"> в папку
</span><span lang="en-us">Items</span>,<span lang="ru"> войдите в игру под ником
</span><span lang="en-us">&quot;Defender&quot;. </span><span lang="ru">Зайдите в 
раздел Рюкзак, чтоб посмотреть на наш свиток.<br>
&nbsp;&nbsp;&nbsp; Для того, чтоб иметь возможность узнать, содержится ли что-то 
в слоте для свитков, мы должны немного изменить наш файл, отвечающий за рюкзак -
</span>inventory.phtml. <span lang="ru">В частности изменения коснутся 
следующего:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table7">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#008080">// Узнаем, что в слотах и уровень Персонажа ?<br>
		</font>$query = &quot;SELECT * FROM users WHERE Nick_Name='$aNickName'&quot;;<br>
		$result = mysql_query($query) or die(&quot;Query failed : &quot; . mysql_error());<br>
		$aRow = mysql_fetch_array( $result);<br>
		$aHelmet_Slot = $aRow[&quot;Helmet_Slot&quot;];<br>
		$aShield_Slot = $aRow[&quot;Shield_Slot&quot;];<br>
		<span lang="ru">....<br>
		....</span><br>
		<font color="#000080">$aScroll_Slot = $aRow[&quot;Scroll_Slot&quot;]; // добавили 
		(для свитков)<br>
		<span lang="ru">.....</span></font></font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru">&nbsp;&nbsp; Слот&nbsp;
</span></font><font color="#000080" face="Courier" size="2">Scroll_Slot<span lang="ru">
</span></font><font size="2" face="Arial"><span lang="ru">работает так же само, 
как и остальные слоты для амуниции (кроме колец), поэтому других изменений кода 
не понадобится. (Ну разве что добавить еще одну глобальную переменную в функцию
<font color="#000080">DrawItem</font>)<br>
&nbsp;&nbsp;&nbsp; Кроме этого для отображения надетого свитка, понадобится 
добавить его отображение таким кодом на </span>HTML:</font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table8">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		&lt;td width=&quot;99&quot; height=&quot;34&quot; align=&quot;center&quot; valign=&quot;center&quot; colspan=&quot;2&quot;&gt;<b>&lt;?</b>
		<font color="#0000FF">echo</font> <font color="#000080">DrawItem</font>(&quot;Scroll&quot;);
		<b>?&gt;</b>&lt;/td&gt;</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">&nbsp;&nbsp; <span lang="ru">
Теперь мы можем спокойно надевать и снимать свиток. Надетый на нашем персонаже 
свиток огня на странице браузера выглядит так:<br>
<br>
<img border="0" src="scroll.jpg" width="375" height="323"></span><br>
<br>
<span lang="ru">Измененный файл </span>inventory.phtml<span lang="ru"> Вы 
найдете <a href="9_2/inventory.phtml">здесь</a>.</span><br>
<br>
</font><a name="kopv2"><b>
<font face="Arial" size="2" color="#000080">9</font></b></a><font face="Arial" size="2"><b><span lang="ru"><font face="Arial" color="#000080"><a name="kopv2"><font size="2">.3. </font>
</a></font></span></b><span lang="ru"><b>
<font size="2" face="Arial" color="#000080"><a name="kopv2">Магазин магических 
свитков</a><a name="kopv3">.</a></font></b> <br>
<br>
&nbsp;&nbsp; В предыдущем пункте 9-го урока мы напрямую добавили свиток огня 
прямо в&nbsp; рюкзак персонажа. В реальной игре это неприемлемо, поэтому игрок 
должен иметь возможность приобретения свитков.<br>
&nbsp;&nbsp; Давайте сделаем магическую лавку, которая будет поставлять игроков 
магическими свитками разных стихий. У нас уже есть опыт создания магазинов, 
поэтому создать такую лавку не должно представлять для нас никакого труда.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></font></p>
<table border="1" width="100%" id="table9">
	<tr>
		<td>
		<img border="0" src="9_3/items/TOWNS/Silluria/church.gif" width="58" height="61"><span lang="ru">&nbsp; 
		На Центральной площади наша магическая лавка будет выглядеть так.</span></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp;&nbsp;&nbsp; 
Изменив немного текст нашего файла, ответственного за отображение Центрально 
Площади, мы сможем заходить в это здание.</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table10">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		&lt;div style=&quot;position:absolute;left:160px;top:150px;width:149px; 
		height:136px; z-index:12;z-index:12&quot;&gt;&lt;IMG SRC=Items/Towns/Silluria/church.gif 
		CLASS=aFilter onmouseover=&quot;imover(this)&quot; onmouseout=&quot;imout(this)&quot; 
		onclick=&quot;<font color="#000080">gotoMagicShop</font>()&quot; ALT=&quot;Магическая 
		лавка&quot; width=&quot;58&quot; height=&quot;61&quot; &gt;&lt;/div&gt;</font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp;&nbsp; В 
вышеприведенном слое, мы отобразили картинку магической лавки и добавили функцию 
</span></font><font color="#000080" face="Courier" size="2">gotoMagicShop</font><font face="Arial" size="2"><span lang="ru">, 
которая позволит нам входить в лавку. На 
</span>JavaScript <span lang="ru">реализация этой функции выглядит так:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table11">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<b>function</b> <font color="#000080">gotoMagicShop</font>()<br>
		{<br>
		location.href='<font color="#000080">magicshop.phtml</font>?itemtype=11&amp;mode=1&amp;NickName=<b>&lt;?php</b><br>
		<font color="#000080">echo</font> &quot;$aNickName&quot;; <b>?&gt;</b>';<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp;&nbsp;
</span>&nbsp;<span lang="ru">По аналогии с кузницей, нам понадобится таблица 
товаров, которые будут продаваться в магической лавке. Вот эта таблица с 
названием 
</span><b>magicshop</b><span lang="ru">:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table12">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#008080">/*таблица предметов для продажи в магической лавке*/</font><br>
		CREATE TABLE `<font color="#000080">magicshop</font>`(<br>
		`SM_ID` BIGINT(20) unsigned NOT NULL auto_increment,
		<font color="#008080">/* идентификатор предмета в магазине */</font><br>
		`IL_ID` INT(4) unsigned NOT NULL, <font color="#008080">/* ID предмета в 
		справочнике предметов */</font><br>
		`Town` INT(2) unsigned NOT NULL, <font color="#008080">/* Город, где 
		расположено здание */</font><br>
		`QTY` INT NOT NULL, <font color="#008080"><span lang="ru">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span>/* количество предметов */</font><br>
		PRIMARY KEY (`SM_ID`),<br>
		KEY (`Town`)<br>
		) TYPE=MyISAM;</font></td>
	</tr>
</table>
<p align="justify"><font face="Arial"><font size="2">&nbsp;&nbsp; </font>
<font size="2"><span lang="ru">Давайте сразу разместим в магазине несколько 
свитков, добавив их в нашу только что созданную таблицу </span><b>magicshop</b>.</font></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table13">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		INSERT INTO <font color="#000080">magicshop</font> (Town,<font color="#000080">IL_ID</font>,QTY) 
		VALUES(1,<font color="#000080">14</font>,40); <font color="#008080">-- 
		свиток огня</font><br>
		INSERT INTO <font color="#000080">magicshop</font> (Town,<font color="#000080">IL_ID</font>,QTY) 
		VALUES(1,<font color="#000080">15</font>,50); <font color="#008080">-- 
		свиток воздуха</font></font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2">&nbsp;&nbsp;&nbsp;
<span lang="ru">Теперь нам остается создать файл 
</span>magicshop.phtml <span lang="ru">для непосредственной реализации магазина. 
Вы заметили, что при вызове скрипта 
</span>magicshop.phtml<span lang="ru"> мы передаем в него несколько параметров (</span></font><font face="Courier" size="2">itemtype=11&amp;mode=1</font><font face="Arial" size="2"><span lang="ru">). 
В справочнике предметов 11 </span>itemtype <span lang="ru">соответствует свитку 
&quot;Удар огня&quot;. То есть при входе в магическую лавку, мы сразу попадает на полку с 
этими товарами (товарами относящимися к категории огненной стихии) . </span>
mode=1 <span lang="ru">обозначает режим отображения лавки. Он будет у нас всегда 
равен единице., так как режима починки свитков не существует (хотя в дальнейшем, 
в качестве домашнего задания, можете создать режим подзарядки свитков).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Меню магазина можно реализовать так:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table14">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<b>&lt;?php<br>
		</b><font color="#0000FF">print</font>( '&lt;td width=&quot;138&quot; height=&quot;115&quot; 
		rowspan=&quot;2&quot; valign=&quot;top&quot;&gt;' );<br>
		<font color="#0000FF">print</font>( 'Оружие:&lt;br&gt;' );<br>
		<font color="#0000FF">print</font>( '&lt;a href=magicshop.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=11&gt;Свитки 
		огня&lt;/a&gt;&lt;br&gt;' );<br>
		<font color="#0000FF">print</font>( '&lt;a href=magicshop.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=12&gt;Свитки 
		воздуха&lt;/a&gt;&lt;br&gt;' );<br>
		<font color="#0000FF">print</font>( '&lt;a href=magicshop.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=13&gt;Свитки 
		воды&lt;/a&gt;&lt;br&gt;' );<br>
		<font color="#0000FF">print</font>( '&lt;a href=magicshop.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=14&gt;Свитки 
		земли&lt;/a&gt;&lt;br&gt;' );<br>
		<font color="#0000FF">print</font>('&lt;HR&gt;');<br>
		<font color="#0000FF">print</font>( '&lt;/td&gt;' );<br>
		<br>
		<b>?&gt;</b></font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp;&nbsp; 
Параметр </span></font><font face="Courier" size="2">
		<font color="#000080">&amp;itemtype</font><span lang="ru"> </span></font>
<font face="Arial" size="2"><span lang="ru">будет вызывать показ полки 
соответствующей магической стихии. Как вы знаете пока у нас представлен скудный 
ассортимент (по одному типу свитков) только в стихиях огня и воздуха.<br>
&nbsp;&nbsp;&nbsp; Давайте отобразим товары магазина. На </span>PHP
<span lang="ru">это будет выглядеть следующим образом:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table15">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		if ($aMode==1){<br>
		<font color="#008080">// Отобразим содержимое магазина <br>
		</font>$query = <font color="#008000">&quot;SELECT il.IL_ID, il.ItemName, 
		il.ItemType, il.ItemNo, il.Item_Image, il.Item_StateCost, s.QTY FROM 
		magicshop s inner join Items_List il on s.IL_ID=il.IL_ID WHERE 
		il.ItemType='$aItemType'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<font color="#0000FF">while</font> ($aRow = <font color="#0000FF">
		mysql_fetch_array</font>($result)) {<br>
		$aItem = $aRow[&quot;IL_ID&quot;];<br>
		$aItemType = $aRow[&quot;ItemType&quot;];<br>
		$aItemNo = $aRow[&quot;ItemNo&quot;];<br>
		$aItemQty = $aRow[&quot;QTY&quot;];<br>
		$aItemImage = $aRow[&quot;Item_Image&quot;];<br>
		$aStateCost = $aRow[&quot;Item_StateCost&quot;];<br>
		$aItemName = $aRow[&quot;ItemName&quot;];<br>
		<br>
		<font color="#0000FF">print</font>('&lt;tr&gt;');<br>
		<font color="#0000FF">print</font>('&lt;td width=&quot;10%&quot; valign=&quot;top&quot;&gt;&lt;img 
		src=Items/'.$aItemImage);<br>
		<font color="#0000FF">print</font>(&quot;&gt;&lt;br&gt;&lt;a href=magicshop.phtml?NickName=$aNickName&amp;itemtype=$aItemType&amp;item=$aItem&gt;<font color="#008000">купить</font>&lt;/a&gt;&lt;/td&gt;&quot;);<br>
		<font color="#0000FF">print</font>('&lt;td width=&quot;90%&quot; valign=&quot;top&quot; bgcolor=eae0e0&gt;'.$aItemName.'&lt;br&gt;Стоимость: 
		'.$aStateCost.' (количество:'.$aItemQty.')&lt;/td&gt;');<br>
		<font color="#0000FF">print</font>('&lt;/tr&gt;');<br>
		<br>
		}<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp;&nbsp; Как 
Вы заметили, мы создаем запрос к таблицам </span>magicshop <span lang="ru">и
</span>Items_List <span lang="ru">и формируем нашу витрину товаров, согласно 
выбранной стихии ( заданной параметром </span></font>
<font color="#008000" face="Courier" size="2">$aItemType</font><font face="Arial" size="2"><span lang="ru">)<br>
&nbsp;&nbsp;&nbsp; В браузере мы получим примерно такую картину:<br>
<img border="0" src="magicshop.jpg" width="444" height="106"><br>
<br>
&nbsp;&nbsp; Нажатие на ссылку <u>купить</u>, приводит к вызову этого же скрипта 
с передачей ему параметра </span></font><font face="Courier" size="2">
		&amp;item</font><font face="Arial" size="2"><span lang="ru">. Этот параметр 
представляет собой не что иное как </span><font color="#000080">IL_ID</font>
<span lang="ru">из справочника предметов. Получив этот параметр, мы должны 
создать копию предмета из справочника в нашем рюкзаке. Вот как это реализуется:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table16">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#0000FF">if</font> ($iBuy){ <font color="#008080">// Была 
		инициирована покупка<br>
		</font><br>
		<font color="#008080">// Сколько вещей этого типа?<br>
		</font>$query = <font color="#008000">&quot;SELECT 
		s.SM_ID,s.QTY,il.Item_StateCost,il.ItemName,il.ItemType,il.ItemNo FROM 
		magicshop s inner join Items_List il on s.IL_ID=il.IL_ID WHERE il.IL_ID 
		= '$aItem'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		$aRow = <font color="#0000FF">mysql_fetch_array</font>( $result);<br>
		$aSMID = $aRow[&quot;SM_ID&quot;];<br>
		$aQTY = $aRow[&quot;QTY&quot;];<br>
		$aStateCost = $aRow[&quot;Item_StateCost&quot;];<br>
		$aItemName = $aRow[&quot;ItemName&quot;];<br>
		<br>
		<font color="#0000FF">if</font> ($aQTY-- &gt; -1){ <font color="#008080">// 
		есть ли вообще эти вещи?</font><br>
		$lNoMoney=false;<br>
		<font color="#0000FF">if</font> ($aMoney &gt;= $aStateCost){
		<font color="#008080">// хватит ли денег купить вещь?</font><br>
		$aMoney = $aMoney - $aStateCost;<br>
		<font color="#008080">// Засунем в рюкзак купленную вещь!</font><br>
		$query = <font color="#008000">&quot;INSERT INTO 
		items(IL_ID,Item_Owner,Item_Position,Item_CurrentLife)&quot;;<br>
		$query .= &quot;Values ('$aItem','$aUserID','2','0')&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query,$link) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<br>
		<font color="#008080">// Уменьшим деньги</font><br>
		$query = <font color="#008000">&quot;UPDATE users SET Character_Money='$aMoney' 
		WHERE Nick_Name='$aNickName'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<br>
		<font color="#008080">// Уменьшим кол-во предметов в магазине</font><br>
		$query = <font color="#008000">&quot;UPDATE magicshop SET QTY='$aQTY' WHERE 
		SM_ID='$aSMID'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<br>
		}<font color="#0000FF">else</font><br>
		{<br>
		$lNoMoney=true;<br>
		}<br>
		}<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp;&nbsp; 
Данный фрагмент кода, уточняет есть ли покупаемый предмет на полке магазина 
(пока мы думали кто-то другой мог купить последний предмет этого типа - игра 
ведь у нас многопользовательская!) Затем мы создаем предмет такого типа в 
рюкзаке нашего игрока и не забываем уменьшить количество денег у персонажа и 
количество предметов на полке магической лавки.<br>
&nbsp;&nbsp; После покупки, мы увидим такую картину в браузере:<br>
<br>
<img border="0" src="magicshop2.jpg" width="443" height="117"><br>
<br>
Полный текст файла </span>magicshop.phtml <span lang="ru">Вы можете увидеть
<a href="9_3/magicshop.phtml">здесь</a>.&nbsp;<br>
&nbsp;&nbsp; 
<br> 
</span><a name="kopv4"><font color="#000080"><b>9</b></font></a><b><span lang="ru"><font face="Arial" color="#000080"><a name="kopv4"><font size="2">.4. </font></a></font></span></b>
<span lang="ru"><a name="kopv4"><font color="#000080"><b>Бой с использованием 
магии </b></font></a>&nbsp;<br>
<br>
&nbsp;&nbsp; Как же использовать купленный нами свиток в бою? Давайте для 
простоты реализуем удар магии, как дополнительную зону поражения. Мы займемся 
этим чуть позже, а сейчас нужно наделить какого-нибудь из персонажей магическими 
способностями. Как Вы уже знаете, за магические способности отвечает параметр 
Character_Intelligence, который должен быть больше нуля. <br>
&nbsp;&nbsp; Давайте договоримся, что 1 очко интеллекта дает 6 пунктов 
магической энергии (маны). Теперь немного изменим
</span>SQL
<span lang="ru">скрипт, добавляющий игрока
</span>Defender, <span lang="ru">так чтоб было задано значение в поле 
Character_Intelligence.</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table17">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		INSERT INTO users (Nick_Name,<br>
		User_Pass,<br>
		Character_Money,<br>
		Character_Level,<br>
		User_Birth_Day,<br>
		<font color="#000080">Character_Intelligence</font>)<br>
		VALUES('Defender','1234','200','1','2008-03-11','<font color="#000080">4</font>');</font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp;&nbsp; 
Значение этого поля равно 4, значит магической энергии у нас будет 6*4 = 24 
пункта.<br>
&nbsp;&nbsp; Теперь нам предстоит менять наш файл поединка
</span><b>battle.phtml</b><span lang="ru">, чтоб учитывать использование 
магической атаки. Для персонажей, у которых есть интеллект, кроме полоски 
здоровья, должна отображаться также полоска магической энергии. Это легко 
сделать таким образом:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table18">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<b>&lt;?php</b> <font color="#0000FF">if</font> ( ($aShowCurMana &gt; 0) &amp;&amp; ($aShowScroll_Slot 
		&lt;&gt; 0) ){ <b>?&gt;</b><br>
		<font color="#505866">&lt;!-- Тут размещены очки магии (мана) нашего 
		персонажа --&gt;<br>
		</font>&lt;table cellspacing=0 cellpadding=0 border=&quot;0&quot; bordercolor=&quot;#000080&quot;&gt;&lt;tr&gt;&lt;td&gt;<br>
		&lt;NOBR&gt;&lt;div id=<font color="#000080">MP1</font>&gt;<br>
		&lt;IMG SRC=&quot;items/mana.gif&quot; WIDTH=10 HEIGHT=10 ALT=&quot;Уровень магии&quot;&gt; &lt;IMG 
		SRC=items/1silver.gif WIDTH=1 HEIGHT=10 ALT=&quot;Уровень магии&quot; name=<font color="#000080">MP11</font>&gt;&lt;IMG 
		SRC=items/1silver.gif WIDTH=1 HEIGHT=10 ALT=&quot;Уровень магии&quot; name=<font color="#000080">MP12</font>&gt;:&lt;/div&gt;<br>
		&lt;/nobr&gt;<br>
		&lt;/table&gt;<br>
		<b>&lt;?php</b> } <b>?&gt;</b></font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp;&nbsp;&nbsp; 
Переменная </span></font><font face="Courier" size="2">
		$aShowCurMana<span lang="ru"> </span></font><font face="Arial" size="2">
<span lang="ru">отвечает за количество магической энергии, а </span></font>
<font face="Courier" size="2">
		$aShowScroll_Slot<span lang="ru"> </span></font>
<font face="Arial" size="2"><span lang="ru">- содержит информацию, о том, что у 
нас находится в слоте свитка. Если обе эти переменные отличны от нуля, мы 
отображаем полоску маны, иначе - не отображаем.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Теперь нам нужно отображать дополнительную 
радио-кнопку для удара магии:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table19">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<b>&lt;?php</b> if ( ($aShowCurMana &gt; 0) &amp;&amp; ($aShowScroll_Slot &lt;&gt; 0) ){ <b>
		?&gt;</b><br>
		&lt;input id=&quot;A15&quot; onclick=&quot;setattack(5)&quot; type=&quot;<font color="#000080">radio</font>&quot; 
		value=&quot;5&quot; name=&quot;att&quot;&gt;&lt;font color=&quot;green&quot;&gt;<font color="#008000">удар 
		магии</font>&lt;/font&gt;&lt;br&gt;<br>
		<b>&lt;?</b>php } <b>?&gt;</b></font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp;&nbsp;&nbsp; 
В окне браузера это будет выглядеть так:<br>
<br>
<img border="0" src="magic-radio.jpg" width="371" height="399"><br>
<br>
&nbsp;&nbsp; Договоримся также, что удар магии, это не блокируемый удар. При 
выборе радио-кнопки &quot;удар магии&quot; выполняется функция </span></font>
<font face="Courier" size="2">
		<font color="#000080">setattack</font><span lang="ru"> </span></font>
<font face="Arial" size="2"><span lang="ru">с аргументом 5. Давайте реализуем 
механизм нанесения повреждений при ударе магии. Применительно к первому игроку в 
записи поединка проверка, является ли наша атака магической, выполняется так:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table20">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#0000FF">if</font> ($aAttack1 == <font color="#008000">5</font>){
		<font color="#008080">// магический удар</font><br>
		<span lang="ru">&nbsp; </span>$aCurHealth2 = $aCurHealth2 -
		<font color="#000080">MagicDamage</font>($aChar1);<br>
		}else {<br>
		<span lang="ru">&nbsp;...</span></font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru"><br>
</span>PHP <span lang="ru">функция </span></font>
<font color="#000080" face="Courier" size="2">MagicDamage</font><font face="Arial" size="2"><span lang="ru"> 
рассчитывает повреждения от магической атаки. Результат отнимается от здоровья 
атакуемого игрока. Вот как выглядит ее реализация:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table21">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<span lang="ru"><font color="#008080">// посчитаем урон от магической 
		атаки</font><br>
		function MagicDamage( $aChar ){<br>
		// узнаем что за свиток в слоте<br>
		$query = <font color="#008000">&quot;SELECT * FROM users WHERE Nick_Name='$aChar'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		$aRow = <font color="#0000FF">mysql_fetch_array</font>( $result);<br>
		$aCurMana = $aRow[&quot;Character_CurMana&quot;];<br>
		$aSlotItemID = $aRow[&quot;Scroll_Slot&quot;];<br>
		$query = <font color="#008000">&quot;SELECT il.ManaCost, il.Min_Damage FROM 
		Items it inner join Items_List il on il.il_id=it.il_id WHERE it.IT_ID='$aSlotItemID'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		$aRow = mysql_fetch_array( $result);<br>
		$aManaCost = $aRow[&quot;ManaCost&quot;];<br>
		$aMin_Damage = $aRow[&quot;Min_Damage&quot;];<br>
		$aCurMana = $aCurMana - $aManaCost;<br>
		$aCurMana = $aCurMana &lt; 0 ? 0 : $aCurMana;<br>
		$query = <font color="#008000">&quot;UPDATE users set Character_CurMana=$aCurMana 
		where Nick_Name='$aChar'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<font color="#0000FF">return</font> ($aMin_Damage);<br>
		}</span></font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp;&nbsp; 
Здесь все предельно просто. Вначале мы узнаем, что содержится у игрока 
проведшего магическую атаку в слоте. Затем по полученному </span></font>
<font face="Courier" size="2">
		<span lang="ru">$<font color="#000080">aSlotItemID</font></span></font><font face="Arial" size="2"><span lang="ru"> 
свитка определяем параметры </span></font><font face="Courier" size="2">
		<span lang="ru">$<font color="#000080">aMin_Damage</font> </span></font>
<font face="Arial" size="2"><span lang="ru">и </span></font>
<font face="Courier" size="2">
		<span lang="ru">$<font color="#000080">aManaCost</font> </span></font>
<font face="Arial" size="2"><span lang="ru">из справочника предметов для этого 
типа свитка. В конце-концов, мы уменьшаем количество маны у атакующего магией 
игрока и возвращаем рассчитанный урон.<br>
<br>
&nbsp;&nbsp; Полный текст измененного файла </span>battle.phtm <span lang="ru">
Вы можете найти <a href="9_4/battle.phtml">здесь</a>.<br>
&nbsp;&nbsp;&nbsp;<br>
</span><a name="kopv6"><font color="#000080"><b>9</b></font></a><b><span lang="ru"><font face="Arial" color="#000080"><a name="kopv6"><font size="2">.5. 
</font></a></font></span></b><span lang="ru"><b>
<font size="2" face="Arial" color="#000080"><a name="kopv6">Защита от магических 
атак</a><a name="kopv7">.</a></font></b>
<br><br>
&nbsp;&nbsp; Так как магические атаки не блокируются, то просто необходимо 
отыскать хоть какие-то средства для уменьшения магических повреждений. Давайте 
создадим так называемую защитную магию, которая тоже будет продаваться в 
пузырьках в магической лавке. Назовем наш пузырек &quot;Универсальная защита&quot;, то 
есть он будет одинаково эффективно противодействовать магиям различных стихий.<br>
&nbsp;&nbsp;&nbsp; Вот как выглядит наш пузырек:</span></font></p>
<table border="1" width="100%" id="table22">
	<tr>
		<td><img border="0" src="9_5/items/vial1.jpg" width="40" height="40"><span lang="ru">&nbsp; 
		Универсальная защита.</span></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp;&nbsp; 
Добавьте картинку в папку </span>Items, <span lang="ru">где у нас хранятся 
изображения предметов игры.<br>
&nbsp;&nbsp; Само собой разумеется, что мы должны добавить ее также и в 
справочник предметов:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table23">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		INSERT INTO <font color="#000080">Items_List</font> (IL_ID,ItemType,ItemNo,ItemName,Item_StateCost,Item_Image,ItemSlotName,<span lang="ru">
		</span>Item_Level,Item_FullLife,Item_Use) VALUES(16,15,1,'<font color="#008000">Универсальная 
		защита</font>',5,'vial1.jpg','Vial',1,1,1);</font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp;&nbsp; Для 
того, чтоб продавать пузырек &quot;Универсальной защиты&quot; в магической лавке, добавим 
раздел Защита от магии в меню магазина:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table24">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#0000FF">print</font>( 'Защита:&lt;br&gt;' );<br>
		<font color="#0000FF">print</font>( '&lt;a href=magicshop.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=15&gt;<font color="#008000">Защита 
		от магии</font>&lt;/a&gt;&lt;br&gt;' );</font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">
<img border="0" src="menu.jpg" width="250" height="297"><br>
<br>
&nbsp;&nbsp; Также позаботимся о том чтоб полка с пузырьками в магической лавке 
не пустовала:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table25">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		INSERT INTO <font color="#000080">magicshop</font> (Town,IL_ID,QTY) 
		VALUES(1,16,20); <font color="#008080">-- пузырек универсальной защиты</font></font></td>
	</tr>
</table>
<p><font face="Arial" size="2"><span lang="ru">&nbsp; Теперь вперед, за 
покупками! Нажимаем на пункт меню &quot;Защита от магии&quot; и видим полку с этим видом 
товара:<br>
<img border="0" src="defence.jpg" width="447" height="117"><br>
<br>
&nbsp;&nbsp; Теперь давайте предусмотрим как нужно использовать пузырек перед 
боем для снижения эффекта магической атаки.&nbsp; <br>
&nbsp;&nbsp; Нужно заметить, что этот предмет, единственный из ранее нами 
описываемых, который не одевается в слот, а просто употребляется перед боем. Нам 
нужно немного поменять наш файл </span>inventory.phtml <span lang="ru">для того 
чтоб обработать эту ситуацию. Но перед этим давайте введем в нашу самую главную 
таблицу </span><b>users</b> <span lang="ru">поле <font color="#000080">
Character_Magic_Protection</font> которое будет хранить статус защитной магии.</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table26">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#000080">Character_Magic_Protection</font> INT DEFAULT 0,
		<font color="#008080">/*Защита от магии */</font></font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp; 
По-умолчанию это поле равно 0 - защиты от магии нет. Но если мы выпьем пузырек, 
значение поменяется на единицу. <br>
&nbsp; Как Вы могли заметить выше мы добавили новое поле <font color="#000080">
Item_Use</font> в справочнике предметов:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table27">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		`<font color="#000080">Item_Use</font>` INT DEFAULT 0,
		<font color="#008080">/*использование предмета 0-одеваем,1-в инвентаре*/</font></font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp;&nbsp; Если 
это поле принимает значение 1, значит такой предмет не надевается в слот, а 
является эликсиром (пузырьком)<br>
&nbsp;&nbsp; Теперь в файле </span>inventory.phtml <span lang="ru">мы можем 
обработать эту ситуацию: </span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table28">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		$aItemUse = $aRow[&quot;Item_Use&quot;]; <font color="#008080">// этот предмет 
		одевается или используется?</font><br>
		<span lang="ru">....<br>
		....<br>
		<font color="#0000FF">if</font> ($aItemUse &lt;&gt; 1){ <font color="#008080">
		// это одеваемые в слоты предметы</span></font><span lang="ru"><span lang="ru"><br>
		....<br>
		</span><font color="#008080">// тут одевается оружие, кольца, броня и 
		т.д.</font><br>
		....<br>
		} <font color="#0000FF">else</font> { <font color="#008080">// это 
		используемый предмет</font><br>
		<font color="#008080">// в целях упрощения такой предмет только один - 
		универсльный эликсир защиты от магии</font><br>
		<font color="#008080">// ставим поле защиты в 1</font><br>
		$query = <font color="#008000">&quot;UPDATE Users SET</font>
		<font color="#000080">Character_Magic_Protection</font>=<font color="#008000">1 
		WHERE Nick_Name='$aNickName'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<font color="#008080">// убираем пузырек из инвентаря<br>
		</font>$query = <font color="#008000">&quot;DELETE FROM Items where IT_ID='$aItemID'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		}</span></font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp;&nbsp; 
Итак, как только мы щелкаем по пузырьку универсальной защиты в рюкзаке, пузырек 
расходуется (удаляется из таблицы </span></font><font face="Courier" size="2">
		<span lang="ru"><font color="#008000">Items</font></span></font><font face="Arial" size="2"><span lang="ru">)&nbsp; 
и у персонажа устанавливается поле </span></font><font face="Courier" size="2">
		<span lang="ru"><font color="#000080">Character_Magic_Protection</font></span></font><font face="Arial" size="2"><span lang="ru"> 
в единицу. <br>
&nbsp;&nbsp;&nbsp;&nbsp; В окне браузера мы можем также отобразить уменьшенную 
картинку эликсира, для того, чтоб знать, что персонаж защищен от магических 
атак.</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table29">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<b>&lt;?</b> <font color="#0000FF">if</font> ($aMP == 1) {
		<font color="#0000FF">print</font>( &quot;Защита от магии &lt;img src='Items/vial1.jpg' 
		width=<font color="#000080">16</font> height=<font color="#000080">16</font> 
		alt='Магия причиняет половину вреда'&gt;&quot;); } <b>?&gt;</b></font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp; Выглядит 
это так:<br>
<br>
<img border="0" src="def_mag.jpg" width="384" height="310"><br>
<br>
&nbsp; Что же будет во время поединка, если персонаж находится под действием 
Универсальной защиты? Немного поменяем наш файлик </span>battle.phtml.</font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table30">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<span lang="ru">...</span><br>
		$aMP = $aRow[&quot;Character_Magic_Protection&quot;]; // <span lang="ru">Защишен 
		ли игрок?<br>
		...<br>
		$aCurHealth1 = $aCurHealth1 - <font color="#000080">MagicDamage</font>($aChar2,$aMP);</span></font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp;&nbsp; В 
функции </span></font><font face="Courier" size="2">
		<span lang="ru"><font color="#000080">MagicDamage</font></span></font><font face="Arial" size="2"><span lang="ru"> 
добавился второй аргумент, куда мы передаем ранее опредленный флаг магической 
защиты.<br>
&nbsp;&nbsp;&nbsp; В самой функции мы сделаем тоже небольшое изменение:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table31">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<span lang="ru"><b>function</b> <font color="#000080">MagicDamage</font>( 
		$aChar,$aMProt ){<br>
		....<br>
		....<br>
&nbsp;<font color="#008080">// если есть защита от магии - делим повреждение 
		пополам </font><br>
		$aMin_Damage = $aMProt==0 ? $aMin_Damage : Round($aMin_Damage/2);<br>
		....</span></font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp;&nbsp; И 
еще небольшое изменение. Магическая защита действует только на один бой. После 
завершения боя нам нужно ее убрать:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table32">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<span lang="ru"><font color="#008080">// Устанавливаем статус 3 (чтоб 
		посмотреть результаты) и убираем маг.защиту, если была<br>
		</font>$query = <font color="#008000">&quot;UPDATE users set Character_Status 
		= 3,</font><font color="#000080">Character_Magic_Protection=0</font><font color="#008000"> 
		where Nick_Name='$aChar1' or Nick_Name='$aChar2'&quot;</font>;</span></font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp;&nbsp; 
Полный текст измененного файла </span>battle.phtml<span lang="ru"> </span>
<span lang="ru">смотрите <a href="9_5/battle.phtml">здесь</a>.&nbsp; </span>
<span lang="ru"><br>
&nbsp;&nbsp; Наш </span>SQL <span lang="ru">скрипт</span> <span lang="ru">m</span>mclub.sql
<span lang="ru">со всеми изменениями смотрите <a href="9_5/db/mmclub.sql">тут</a>.<br>
&nbsp;&nbsp;&nbsp;<b><br>
В следующем уроке</b> мы создадим магазин комиссионных товаров. Мы научимся 
покупать, сдавать, переоценивать и забирать свои товары из комиссионного 
магазина.</span></font></p>
<font size="2" face="Arial">
        <p align="left">&nbsp;</font></td>
      <td width="27" height="356" background="Site/middle2.jpg">&nbsp;</td>
    </tr>
    <tr>
      <td width="740" height="38" background="Site/bottom.jpg" colspan="3">&nbsp;</td>
    </tr>
  </table>
  </center>
</div>

</body>

</html>