<html>
<head>
<meta http-equiv="Content-Language" content="ru"><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><title>Тест поединка</title>
<script>
// Доступные войска 
var sm = new Array("stroybat",2,3,  
                   "rifleman",3,5,  
                   "automan",5,8, 
                   "bazooka",5,12, 
                   "medic",3,1);
// Боец 1    1-тип войска, 2 - кол-во
var army1 = new Array(1,10,
                      2,5,
                      3,4,
                      4,1);
// Боец 2    1-тип войска, 2 - кол-во
var army2 = new Array(2,4,
                      3,5,
                      1,12,
                      4,1);

var  s_attack1 = 0;
var  s_attack2 = 0;
var  s_defend1 = 0;
var  s_defend2 = 0;
var  s_where1  = 0;
var  s_where2  = 0;
var  dam_koef1 = 1;
var  dam_koef2 = 1;
var mess1 = "";
var mess2 = "";

function ShowArmies(){
  i = 0;
  a_cnt = 1;
  while( i < army1.length ) {
     var pos = army1[i++];
     var s = sm[pos*3-3];
     var ahp = sm[pos*3-2];
     var admg = sm[pos*3-1];
     document.getElementById('i1'+a_cnt).src = 'warunits/'+s+'.jpg';
     document.getElementById('i1'+a_cnt).alt = s+' Жизнь: '+ahp+' Урон: '+admg;
     kvo = army1[i++];
     if (kvo==0){
        document.getElementById('A1'+a_cnt).disabled = true;
        document.getElementById('D1'+a_cnt).disabled = true;
        document.getElementById('W2'+a_cnt).disabled = true;
     }
     document.getElementById('kvo1'+a_cnt).innerHTML = kvo;
     a_cnt++;
  }
  i = 0;
  a_cnt = 1;
  while( i < army2.length ) {
     var pos = army2[i++];
     var s = sm[pos*3-3];
     var ahp = sm[pos*3-2];
     var admg = sm[pos*3-1];
     document.getElementById('i2'+a_cnt).src = 'warunits/'+s+'.jpg';
     document.getElementById('i2'+a_cnt).alt = s+' Жизнь: '+ahp+' Урон: '+admg;
     kvo = army2[i++];
     if (kvo==0){
        document.getElementById('A2'+a_cnt).disabled = true;
        document.getElementById('D2'+a_cnt).disabled = true;
        document.getElementById('W1'+a_cnt).disabled = true;
     }
     document.getElementById('kvo2'+a_cnt).innerHTML = kvo;
     a_cnt++;
  }
}

function setdefend1(d){
  s_defend1 = d;
}
function setdefend2(d){
  s_defend2 = d;
}
function setattack1(a){
  s_attack1 = a;
}
function setattack2(a){
  s_attack2 = a;
}
function setwhere1(w){
  s_where1 = w;
}
function setwhere2(w){
  s_where2 = w;
}

function getRandom(iMin, iMax) {   
var retV = Math.round(Math.random()*iMax);
if (retV < iMin) retV = iMin;  
return retV;
}


function CheckGo(){
  if (  (s_attack1 == 0) || (s_attack2 == 0) || (s_defend1 == 0) ||
         (s_defend2 == 0) || (s_where1 == 0) || (s_where2 == 0)) {
        alert("Определитесь со сносом :) ");
  } else SetDamage();
}

// Рассчитываем повреждения
function SetDamage(){

 // Характеристики нападающих
 var unit1 = army1[ (s_attack1*2-1)-1 ];
 var unit2 = army2[ (s_attack2*2-1)-1 ];
 var kolvo1 = army1[ (s_attack1*2-1) ];
 var kolvo2 = army2[ (s_attack2*2-1) ];
 // характеристики по ком наносится удар?
 var a_unit1 = army1[ (s_where2*2-1)-1 ];
 var a_unit2 = army2[ (s_where1*2-1)-1 ];
 var a_kolvo1 = army1[ (s_where2*2-1) ];
 var a_kolvo2 = army2[ (s_where1*2-1) ];

 // атака второго попала в защиту первого?
 var dam_koef1 = (s_where2==s_defend1) ? 0.3 : 1
 // атака первого попала в защиту второго?
 var dam_koef2 = (s_where1==s_defend2) ? 0.3 : 1

 var unit_name1 = sm[ unit1*3-3 ];
 var unit_name2 = sm[ unit2*3-3 ];
 var a_unit_name1 = sm[ a_unit1*3-3 ];
 var a_unit_name2 = sm[ a_unit2*3-3 ];
 var dam1 = sm[unit1*3-1];
 var dam2 = sm[unit2*3-1];
 var hp1  = sm[a_unit1*3-2];
 var hp2  = sm[a_unit2*3-2];

 var realdam1 = Math.round(getRandom(dam1-1,dam1+1)*dam_koef2);
 var realdam2 = Math.round(getRandom(dam2-1,dam2+1)*dam_koef1);

 if ((hp1*a_kolvo1 - realdam2*kolvo2) >=0){
     alive1 = Math.round((hp1*a_kolvo1 - realdam2*kolvo2)/hp1);
 } else alive1 = 0;

 if((hp2*a_kolvo2 - realdam1*kolvo1) >= 0){
    alive2 = Math.round((hp2*a_kolvo2 - realdam1*kolvo1)/hp2);
 } else alive2 = 0;

 // прописываем оставшихся после хода:
 army1[ (s_where2*2-1) ] = alive1; 
 army2[ (s_where1*2-1) ] = alive2; 
 ShowArmies();

 var hsh = new Date();

 mess1 = hsh.getHours()+":"+hsh.getMinutes()+":"+hsh.getSeconds()+' <b>'+unit_name1+'</b> (Боец1) нанес удар по <b>'+a_unit_name2+'</b> (Боец2), урон: '+(realdam1*kolvo1)+' hp, потери составили: '+(a_kolvo2-alive2)+' ед. <br>';
 mess2 = hsh.getHours()+":"+hsh.getMinutes()+":"+hsh.getSeconds()+' <b>'+unit_name2+'</b> (Боец2) нанес удар по <b>'+a_unit_name1+'</b> (Боец1), урон: '+(realdam2*kolvo2)+' hp, потери составили: '+(a_kolvo1-alive1)+' ед. <br>';
 mess.innerHTML = mess1+mess2+mess.innerHTML;

 TestAlive();
 s_attack1 = 0;
 s_attack2 = 0;
 s_defend1 = 0;
 s_defend2 = 0;
 s_where1  = 0;
 s_where2  = 0;
 ClearRadio();
 //alert([hp1*a_kolvo1,realdam2*kolvo2,alive1,'<>',hp2*a_kolvo2,realdam1*kolvo1,alive2]);
}

function ClearRadio(){
  var aInp = document.getElementsByTagName('input');
   for(i=0;i<aInp.length;i++){
      if (aInp[i].type == "radio"){
         aInp[i].checked = false;
      }
   }
}

function TestAlive(){
  i = 0;
  ikvo = 0;
  while( i < army1.length ) {
     i++;
     ikvo += army1[i++];
  }
  if(ikvo==0){
     document.getElementById('name1').style.backgroundColor="#F5A7AE";
     document.getElementById('bt1').disabled=true;
  }
  i = 0;
  ikvo = 0;
  while( i < army2.length ) {
     i++;
     ikvo += army2[i++];
  }
  if(ikvo==0){
     document.getElementById('name2').style.backgroundColor="#F5A7AE";
     document.getElementById('bt1').disabled=true;
  }
}


</script>

</head>

<body onLoad="ShowArmies()">
Тест поединка
<table border="0" width="70%" id="table1">
  <tr>
    <td width="144"><div id="name1" >Боец 1</div></td>
    <td width="53" bgcolor="#FFFFCC">Защита</td>
    <td width="57" bgcolor="#FFFFCC">Атака</td>
    <td bgcolor="#FFFFCC" width="53">Куда</td>
    <td bgcolor="#C0C0C0" width="101">&nbsp;</td>
    <td bgcolor="#FFFFCC" width="50">Куда</td>
    <td width="60" bgcolor="#FFFFCC">Атака</td>
    <td width="53" bgcolor="#FFFFCC">Защита</td>
    <td align=right><div id="name2">Боец 2</div></td>
  </tr>
  <tr>
    <td width="144" align="center">
    <img border="0" id="i11" src="warunits/empty.jpg" width="67" height="100"><div id="kvo11">0</div></td>
    <td width="53" align="center">
           <input type="radio" id=D11 name="defend1" value="1" onclick="setdefend1(1)">
        </td>
    <td width="57" align="center">
           <input type="radio" id=A11 name="attack1" value="V1" onclick="setattack1(1)"></td>
    <td align="center" width="53">
           <input type="radio" id=W11 name="where1" value="V1" onclick="setwhere1(1)"></td>
    <td align="center" bgcolor="#C0C0C0" width="101">&nbsp;</td>
    <td align="center" width="50">
           <input type="radio" id=W21 name="where2" value="V1" onclick="setwhere2(1)"></td>
    <td width="60" align="center">
           <input type="radio" id=A21 name="attack2" value="V1" onclick="setattack2(1)"></td>
    <td width="49" align="center">
           <input type="radio" id=D21 name="defend2" value="1" onclick="setdefend2(1)"> <br>
        </td>
    <td align="center">
    <img border="0"  id="i21" src="warunits/empty.jpg" width="67" height="100"><div id="kvo21">0</div></td>
  </tr>
  <tr>
    <td width="144" align="center">
    <img border="0" id="i12"  src="warunits/empty.jpg" width="67" height="100"><div id="kvo12">0</div></td>
    <td width="53" align="center">
           <input type="radio" id=D12 name="defend1" value="V1" onclick="setdefend1(2)"></td>
    <td width="57" align="center">
           <input type="radio" id=A12 name="attack1" value="V1" onclick="setattack1(2)"></td>
    <td align="center" width="53">
           <input type="radio" id=W12 name="where1" value="V1" onclick="setwhere1(2)"></td>
    <td align="center" bgcolor="#C0C0C0" width="101">&nbsp;</td>
    <td align="center" width="50">
           <input type="radio" id=W22 name="where2" value="V1" onclick="setwhere2(2)"></td>
    <td width="60" align="center">
           <input type="radio" id=A22 name="attack2" value="V1" onclick="setattack2(2)"></td>
    <td width="49" align="center">
           <input type="radio" id=D22 name="defend2" value="V1" onclick="setdefend2(2)"></td>
           
    <td align="center">
    <img border="0"  id="i22" src="warunits/empty.jpg" width="67" height="100"><div id="kvo22">0</div></td>
  </tr>
  <tr>
    <td width="144" align="center">
    <img border="0"  id="i13" src="warunits/empty.jpg" width="67" height="100"><div id="kvo13">0</div></td>
    <td width="53" align="center">
           <input type="radio" id=D13 name="defend1" value="V1" onclick="setdefend1(3)"></td>
    <td width="57" align="center">
           <input type="radio" id=A13 name="attack1" value="V1" onclick="setattack1(3)"></td>
    <td align="center" width="53">
           <input type="radio" id=W13 name="where1" value="V1" onclick="setwhere1(3)"></td>
    <td align="center" bgcolor="#C0C0C0" width="101">&nbsp;</td>
    <td align="center" width="50">
           <input type="radio" id=W23 name="where2" value="V1" onclick="setwhere2(3)"></td>
    <td width="60" align="center">
           <input type="radio" id=A23 name="attack2" value="V1" onclick="setattack2(3)"></td>
    <td width="49" align="center">
           <input type="radio" id=D23 name="defend2" value="V1" onclick="setdefend2(3)"></td>
    <td align="center">
    <img border="0"  id="i23" src="warunits/empty.jpg" width="67" height="100"><div id="kvo23">0</div></td>
  </tr>
  <tr>
    <td width="144" align="center">
    <img border="0"  id="i14" src="warunits/empty.jpg" width="67" height="100"><div id="kvo14">0</div></td>
    <td width="53" align="center">
           <input type="radio" id=D14 name="defend1" value="V1" onclick="setdefend1(4)"></td>
    <td width="57" align="center">
           <input type="radio" id=A14 name="attack1" value="V1" onclick="setattack1(4)"></td>
    <td align="center" width="53">
           <input type="radio" id=W14 name="where1" value="V1" onclick="setwhere1(4)"></td>
    <td align="center" bgcolor="#C0C0C0" width="101">&nbsp;</td>
    <td align="center" width="50">
           <input type="radio" id=W24 name="where2" value="V1" onclick="setwhere2(4)"></td>
    <td width="60" align="center">
           <input type="radio" id=A24 name="attack2" value="V1" onclick="setattack2(4)"></td>
    <td width="49" align="center">
           <input type="radio" id=D24 name="defend2" value="V1" onclick="setdefend2(4)"></td>
    <td align="center">
    <img border="0"  id="i24" src="warunits/empty.jpg" width="67" height="100"><div id="kvo24">0</div></td>
  </tr>
  <tr>
    <td width="144" align="center">&nbsp;</td>
    <td width="53" align="center">&nbsp;</td>
    <td width="57" align="center">&nbsp;</td>
    <td align="center" width="53">&nbsp;</td>
    <td align="center" bgcolor="#C0C0C0" width="101">
    <form method="POST" action="--WEBBOT-SELF--">
    <p><input id="bt1" type="button" value="Вперед" name="Go" onClick="CheckGo()"></td>
    <td align="center" width="50">&nbsp;</td>
    <td width="60" align="center">&nbsp;</td>
    <td width="53" align="center">&nbsp;</td>
    <td align="center">&nbsp;</td>
  </tr>
</table>
</form>

<div id=mess>Ход поединка...</div>

</body>

</html>