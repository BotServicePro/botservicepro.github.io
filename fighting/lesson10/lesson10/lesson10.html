<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<meta name="GENERATOR" content="Microsoft FrontPage 6.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>New Page 1</title>
<style>
<!--
table.MsoTableGrid
	{border:1.0pt solid windowtext;
	font-size:10.0pt;
	font-family:"Times New Roman","serif"}
-->
</style>
</head>

<body>

<div align="center">
  <center>
  <table border="0" width="740" height="350" cellspacing="0" cellpadding="0">
    <!-- MSTableType="nolayout" -->
	<tr>
      <td width="740" height="133" background="Site/top.jpg" colspan="3">&nbsp;</td>
    </tr>
    <tr>
      <td width="127" height="356" background="Site/middle1.jpg" valign="top">
        <p align="left">
        <b><font face="Arial" size="1" color="#505866">&nbsp;&nbsp;&nbsp; 
		<a href="http://www.blitz-school.info"><font color="#FFFF99">Курсы</font></a><br>
        &nbsp;&nbsp;&nbsp; </font><font face="Arial" size="1" color="#FFFF99">
		<a href="http://www.blitz-school.info/reg.html"><font color="#FFFF99">Регистрация</font></a><br>
        &nbsp;&nbsp;&nbsp;
		<a href="http://www.blitz-school.info/study_tech.html">
		<font color="#FFFF99">Методика</font></a><br>
        &nbsp;&nbsp;&nbsp; </font>
		<a href="http://www.blitz-school.info/program.html"><font face="Arial" size="1" color="#FFFF99">Оглавление</font></a><font face="Arial" size="1" color="#FFFF99"><br>
        &nbsp;&nbsp;&nbsp; <a href="http://www.blitz-school.info/login.html">
		<font color="#FFFF99">Для учащихся</font></a><br>
        &nbsp;&nbsp;&nbsp; </font></b>
		<img border="0" src="../navdiv.gif" width="80" height="4"><br>
        <b><font size="1" face="Arial" color="#505866">&nbsp;&nbsp;&nbsp;
        <a href="http://www.blitz-school.info/articles.html">
		<font color="#FFFF99">Статьи</font></a><br>
        &nbsp;&nbsp;&nbsp; </font><font size="1" face="Arial" color="#FFFF99">
		<a href="http://www.blitz-school.info/instrum.html">
		<font color="#FFFF99">Инструменты</font></a><br>
		<span lang="en-us">&nbsp;&nbsp;&nbsp; </span>
		<a href="http://www.blitz-school.info/contacts.html">
		<font color="#FFFF99">Контакты</font></a><br>
		<span lang="en-us">&nbsp;&nbsp;&nbsp; </span></font></b>&nbsp;</td>
      <td width="586" height="356" background="Site/bg.gif" valign="top">

<p align="center"><font color="#008000"><b><font size="5"><span lang="ru">Урок </span>
10<span lang="ru">. </span></font></b>
<span lang="ru"><font size="5"><b>Создание комиссионного магазина</b></font><br>
</span>
</font><b></p>
<p align="justify"><span lang="ru"><font size="2" face="Arial" color="#000080">
10<a name="kopv">.1. 
</a> 
</font></span></b><span lang="ru"><b><a name="kopv">
<font size="2" face="Arial" color="#000080">Интерфейс комиссионного магазина.</font></a></b><font size="2" face="Arial">
<br>
</font></span><font size="2" face="Arial">
&nbsp;&nbsp;&nbsp;&nbsp; <span lang="ru"><br>
&nbsp; В процессе игры очень часто возникает потребность избавиться от оружия 
или экипировки, которые по каким-то критериям уже не подходят для комфортной 
игры. Так например при переходе на более высокий уровень, игрок может купить 
оружие присущее этому уровню и ему просто необходимо продать то, чем он 
пользовался на младшем уровне.<br>
&nbsp;&nbsp; В 13 уроке мы создадим торговые ряды, где игрок сможет 
договариваться о продаже и покупке того или иного предмета.<br>
&nbsp;&nbsp;&nbsp; Однако, к примеру у игрока нет времени вести торговлю и тогда 
ему на помощь приходит такое удобное средство как комиссионный магазин. Конечно 
за удобства нужно платить и поэтому комиссионный магазин берет свой процент от 
продажи предмета.<br>
&nbsp;&nbsp;&nbsp; Еще одно удобство комиссионного магазина в том, что в нем 
можно приобрести все типы товаров. Так оружие и броню, которые можно было 
покупать в кузне и магические предметы, которые продавались в магической лавке, 
теперь можно покупать или сдавать в одном месте.<br>
&nbsp;&nbsp;&nbsp; На центральной площади наш комиссионный магазин будет 
выглядеть следующим образом:</span></font></p>
<table border="1" width="100%" id="table2">
	<tr>
		<td><span lang="ru">
		<img border="0" src="10_3/items/TOWNS/Silluria/armor.gif" width="61" height="61">&nbsp;&nbsp; 
		Комиссионный магазин</span></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<span lang="ru">&nbsp;&nbsp;&nbsp; Для входа в него мы немного модифицируем на 
наш файл описывающий центральную площадь
</span>map.phtml.</font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table3">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		&lt;div style=&quot;position:absolute;left:370px;top:70px;width:149px; 
		height:136px; z-index:12;z-index:12&quot;&gt;&lt;IMG SRC=Items/Towns/Silluria/armor.gif 
		CLASS=aFilter onmouseover=&quot;imover(this)&quot; onmouseout=&quot;imout(this)&quot; 
		onclick=&quot;<font color="#000080">gotoComissionShop</font>()&quot; ALT=&quot;Комиссионный 
		магазин&quot; width=&quot;70&quot; height=&quot;70&quot;&gt;&lt;/div&gt;</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<span lang="ru">&nbsp; </span>&nbsp; <span lang="ru">При нажатии на изображение 
комиссионного магазина, выполняется функция </span></font>
<font color="#000080" face="Courier" size="2">gotoComissionShop</font><font size="2" face="Arial"><span lang="ru"> 
и мы попадаем во внутрь.<br>
<br>
&nbsp;&nbsp;&nbsp; Функция предельно проста:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table4">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<b>function</b> <font color="#000080">gotoComissionShop</font>()<br>
		{<br>
		location.href='<font color="#000080">comission.phtml</font>?itemtype=1&amp;mode=1&amp;NickName=<b>&lt;?php</b><br>
		<font color="#0000FF">echo</font> &quot;$aNickName&quot;; <b>?&gt;</b>';<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<span lang="ru">&nbsp;&nbsp;&nbsp;&nbsp; Для создания комиссионного магазина нам 
понадобится файл с именем <b>comission.phtml</b>. <br>
&nbsp;&nbsp;&nbsp; Для начала, давайте сделаем меню магазина с учетом того, что 
в нем можно приобрести любой товар.</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table1">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<b>&lt;?php<br>
		</b><font color="#0000FF">print</font>( '&lt;td width=&quot;138&quot; height=&quot;115&quot; 
		rowspan=&quot;2&quot; valign=&quot;top&quot;&gt;' );<br>
		<font color="#0000FF">print</font>( '<font color="#000080">Оружие</font>:&lt;br&gt;' 
		);<br>
		<font color="#0000FF">print</font>( '&lt;a href=comission.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=1&gt;<font color="#008000">Булавы</font>&lt;/a&gt;&lt;br&gt;' 
		);<br>
		<font color="#0000FF">print</font>( '&lt;a href=comission.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=11&gt;<font color="#008000">Мечи</font>&lt;/a&gt;&lt;br&gt;' 
		);<br>
		<font color="#0000FF">print</font>( '&lt;a href=comission.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=12&gt;<font color="#008000">Топоры</font>&lt;/a&gt;&lt;br&gt;' 
		);<br>
		<font color="#0000FF">print</font>( '&lt;a href=comission.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=13&gt;<font color="#008000">Копья</font>&lt;/a&gt;&lt;br&gt;' 
		);<br>
		<font color="#0000FF">print</font>( '&lt;a href=comission.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=14&gt;<font color="#008000">Кинжалы</font>&lt;/a&gt;&lt;br&gt;' 
		);<br>
		<font color="#0000FF">print</font>( '&lt;a href=comission.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=2&gt;<font color="#008000">Щиты</font>&lt;/a&gt;&lt;br&gt;' 
		);<br>
		<font color="#0000FF">print</font>( '&lt;a href=comission.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=3&gt;<font color="#008000">Шлемы</font>&lt;/a&gt;&lt;br&gt;' 
		);<br>
		<font color="#0000FF">print</font>( '&lt;a href=comission.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=4&gt;<font color="#008000">Перчатки</font>&lt;/a&gt;&lt;br&gt;' 
		);<br>
		<font color="#0000FF">print</font>( '&lt;a href=comission.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=7&gt;<font color="#008000">Сапоги</font>&lt;/a&gt;&lt;br&gt;' 
		);<br>
		<font color="#0000FF">print</font>( '&lt;a href=comission.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=10&gt;<font color="#008000">Броня</font>&lt;/a&gt;&lt;br&gt;' 
		);<br>
		<font color="#0000FF">print</font>( '&lt;a href=comission.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=8&gt;<font color="#008000">Пояса</font>&lt;/a&gt;&lt;br&gt;' 
		);<br>
		<font color="#0000FF">print</font>( '&lt;HR&gt;' );<br>
		<font color="#0000FF">print</font>( '<font color="#000080">Магия</font>:&lt;br&gt;' 
		);<br>
		<font color="#0000FF">print</font>( '&lt;a href=comission.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=11&gt;<font color="#008000">Свитки 
		огня</font>&lt;/a&gt;&lt;br&gt;' );<br>
		<font color="#0000FF">print</font>( '&lt;a href=comission.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=12&gt;<font color="#008000">Свитки 
		воздуха</font>&lt;/a&gt;&lt;br&gt;' );<br>
		<font color="#0000FF">print</font>( '&lt;a href=comission.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=13&gt;<font color="#008000">Свитки 
		воды</font>&lt;/a&gt;&lt;br&gt;' );<br>
		<font color="#0000FF">print</font>( '&lt;a href=comission.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=14&gt;<font color="#008000">Свитки 
		земли</font>&lt;/a&gt;&lt;br&gt;' );<br>
		<font color="#0000FF">print</font>('&lt;HR&gt;');<br>
		<font color="#0000FF">print</font>( '<font color="#000080">Защита</font>:&lt;br&gt;' 
		);<br>
		<font color="#0000FF">print</font>( '&lt;a href=comission.phtml?NickName='.$aNickName.'&amp;mode=1&amp;itemtype=15&gt;<font color="#008000">Защита 
		от магии</font>&lt;/a&gt;&lt;br&gt;' );<br>
		<font color="#0000FF">print</font>('&lt;HR&gt;');<br>
		<font color="#0000FF">print</font>( '&lt;/td&gt;' );<br>
		<br>
		<b>?&gt;</b></font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<span lang="ru"><img border="0" src="menu.jpg" width="313" height="363"><br>
<br>
</span></font><a name="kopv0"><span lang="ru"><b>
<font face="Arial" size="2" color="#000080">10</font></b></span></a><font size="2" face="Arial"><b><span lang="ru"><font face="Arial" color="#000080"><a name="kopv0"><font size="2">.2. 
</font></a></font></span><font size="2" face="Arial" color="#000080">
<span lang="ru"><a name="kopv0">Группы комиссионных товаров</a><a name="kopv1">.</a></span></font></b><span lang="ru"> <br>
<br>
&nbsp;&nbsp;&nbsp; В отличии от магазинов, которые мы создавали ранее (кузня, 
магическая лавка)&nbsp;&nbsp;в комиссионке товары разбиты на группы. К примеру в 
типе предметов броня, могут быть такие товары &quot;</span></font><b>Рубашка воина</b><font size="2" face="Arial"><span lang="ru">&quot; 
, &quot;</span></font><b>Рубашка</b><font size="2" face="Arial"><span lang="ru">&quot; и 
другие. <br>
&nbsp;&nbsp;&nbsp;&nbsp; Таким образом, вначале мы должны показать 
сгруппированные товары, а потом по клику мышки по ссылке перейти, мы уже будем 
созерцать все предметы, содержащиеся в этой группе. <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Например зайдя в группу &quot;</span></font><b>Рубашка 
воина</b><font size="2" face="Arial"><span lang="ru">&quot; игрок увидит внутри 
несколько рубашек воина с разными ценами и разным износом и после этого 
определится с выбором - есть ли что-то интересное для покупки. <br>
&nbsp;&nbsp;&nbsp;&nbsp; Нажимая в меню на ссылку Броня, мы передаем скрипту 
такие важные параметры как &amp;mode=1&amp;itemtype=10. mode - это режим. Если режим 
равен единице, значит мы должны отображать группы сходных товаров у которых 
itemtype = 10.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Реализовать все это на
</span>PHP <span lang="ru"> можно таким образом:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table5">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#0000FF">if</font> ($aMode==1){<br>
		<font color="#008080">// Отобразим содержимое магазина комиссионного 
		магазина<br>
		</font>$query = <font color="#008000">&quot;SELECT<br>
		count(il.ItemType) AS kolvo,<br>
		min(Item_ComissionCost) minc,<br>
		max(Item_ComissionCost) maxc,<br>
		il.IL_ID,<br>
		il.ItemName,<br>
		il.ItemType,<br>
		il.ItemNo,<br>
		il.Item_Image,<br>
		il.Item_StateCost<br>
		FROM<br>
		items i<br>
		INNER JOIN Items_List il ON (i.IL_ID = il.IL_ID)<br>
		WHERE<br>
		(il.ItemType = $aItemType) AND<br>
		(i.Item_Position = 1)<br>
		GROUP BY<br>
		il.ItemName,<br>
		il.ItemType,<br>
		il.ItemNo,<br>
		il.Item_Image,<br>
		il.Item_StateCost&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<font color="#0000FF">while</font> ($aRow = <font color="#0000FF">
		mysql_fetch_array</font>($result)) {<br>
		$aKolVo = $aRow[&quot;kolvo&quot;];<br>
		$aMinCost = $aRow[&quot;minc&quot;];<br>
		$aMaxCost = $aRow[&quot;maxc&quot;];<br>
		$aItem = $aRow[&quot;IL_ID&quot;];<br>
		$aItemName = $aRow[&quot;ItemName&quot;];<br>
		$aItemType = $aRow[&quot;ItemType&quot;];<br>
		$aItemNo = $aRow[&quot;ItemNo&quot;];<br>
		$aItemImage = $aRow[&quot;Item_Image&quot;];<br>
		$aStateCost = $aRow[&quot;Item_StateCost&quot;];<br>
		<br>
		<br>
		<font color="#0000FF">print</font>('&lt;tr&gt;');<br>
		<font color="#0000FF">print</font>('&lt;td width=&quot;10%&quot; valign=&quot;top&quot;&gt;&lt;img 
		src=Items/'.$aItemImage);<br>
		<font color="#0000FF">print</font>(&quot;&gt;&lt;br&gt;&lt;a href=comission.phtml?NickName=$aNickName&amp;itemtype=$aItemType&amp;itemno=$aItemNo&gt;<font color="#000080">перейти</font>&lt;/a&gt;&lt;/td&gt;&quot;);<br>
		<font color="#0000FF">print</font>('&lt;td width=&quot;90%&quot; valign=&quot;top&quot; bgcolor=eae0e0&gt;&lt;b&gt;'.$aItemName.'&lt;/b&gt;&lt;br&gt;<font color="#008000">Мин.Стоимость:</font> 
		&lt;i&gt;'.$aMinCost.'&lt;/i&gt; <font color="#008000">Макс.Стоимость:</font> &lt;i&gt;'.$aMaxCost.'&lt;/i&gt; 
		(количество:&lt;b&gt;'.$aKolVo.'&lt;/b&gt;)&lt;/td&gt;');<br>
		<font color="#0000FF">print</font>('&lt;/tr&gt;');<br>
		<br>
		}<br>
		} </font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<span lang="ru"> &nbsp;&nbsp; Как Вы помните, комиссионными товарами являются 
те, у которых поле
</span></font><font face="Courier" size="2" color="#000080">Item_Position</font><font color="#008000" face="Courier" size="2">
</font><font size="2" face="Arial">
<span lang="ru"> в таблице
</span><b>Items</b><span lang="ru"> равно <b>1</b>. Таким образом нам не нужно 
создавать отдельную таблицу комиссионного магазина, как мы делали ранее для 
кузницы и магической лавки, нам нужно просто устанавливать поле
</span></font><font face="Courier" size="2" color="#000080">Item_Position</font><font color="#008000" face="Courier" size="2">
</font><font size="2" face="Arial">
<span lang="ru"> &nbsp;в единицу и товар считается сданным в комиссионный 
магазин.<br>
<br>
&nbsp;&nbsp; Тогда давайте добавим в таблицу
</span>Items <span lang="ru"> немного тестовых товаров игроку <b>Создатель</b>. 
разместив их от его имени в комиссионном магазине (</span></font><font face="Courier" size="2">Item_Position<span lang="ru"> 
= 1</span></font><font size="2" face="Arial"><span lang="ru">)</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table9">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		INSERT INTO Items (IT_ID,IL_ID,Item_Owner,Item_Position,Item_CurrentLife,Item_ComissionCost) 
		VALUES(4,12,1,1,10,23);<br>
		INSERT INTO Items (IT_ID,IL_ID,Item_Owner,Item_Position,Item_CurrentLife,Item_ComissionCost) 
		VALUES(5,12,1,1,10,25);<br>
		INSERT INTO Items (IT_ID,IL_ID,Item_Owner,Item_Position,Item_CurrentLife,Item_ComissionCost) 
		VALUES(6,13,1,1,12,36);<br>
		INSERT INTO Items (IT_ID,IL_ID,Item_Owner,Item_Position,Item_CurrentLife,Item_ComissionCost) 
		VALUES(7,13,1,1,9,43);<br>
		INSERT INTO Items (IT_ID,IL_ID,Item_Owner,Item_Position,Item_CurrentLife,Item_ComissionCost) 
		VALUES(8,13,1,1,10,40);<br>
		INSERT INTO Items (IT_ID,IL_ID,Item_Owner,Item_Position,Item_CurrentLife,Item_ComissionCost) 
		VALUES(9,1,1,1,10,16);</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<span lang="ru"> &nbsp;&nbsp; В
</span>SQL <span lang="ru"> запросе предваряющем вышеприведенный мы группируем 
сходные товары и показываем количество, максимальную и минимальную стоимости 
предметов, входящих в эту группу.<br>
&nbsp;&nbsp;&nbsp; Визуально, на странице браузера это выглядит так:<br>
<br>
<img border="0" src="groups.jpg" width="477" height="240"><br>
<br>
&nbsp;&nbsp;&nbsp; Группировка по типу смотрится гораздо нагляднее, чем если бы 
мы сразу показывали все предметы внутри категорий (броня, щиты, пояса и т.д.)<br>
&nbsp;&nbsp;&nbsp; Чтоб перейти непосредственно к списку предметов внутри группы 
мы должны нажать на ссылку &quot;Перейти&quot;.&nbsp; На этот раз скрипту передается 
параметр
</span></font><font face="Courier" size="2">
		&amp;<font color="#000080">itemno</font></font><font size="2" face="Arial"><span lang="ru">, 
который содержит значение из поля
</span></font><font face="Courier" size="2" color="#000080">
		ItemNo</font><font size="2" face="Arial"><span lang="ru">. <br>
&nbsp;&nbsp;&nbsp;&nbsp; Для отображения предметов внутри группы мы напишем 
следующий фрагмент скрипта на языке
</span>PHP:</font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table6">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">....}<br>
		<font color="#0000FF">elseif</font> ($aMode==2){ <font color="#008080">
		// режим просмотра отдельных товаров внутри группы</font><br>
		$query = <font color="#008000">&quot;SELECT<br>
		i.Item_ComissionCost,<br>
		i.IT_ID,<br>
		il.IL_ID,<br>
		il.ItemName,<br>
		il.ItemType,<br>
		il.ItemNo,<br>
		il.Item_Image,<br>
		il.Item_FullLife,<br>
		i.Item_CurrentLife,<br>
		il.Item_StateCost<br>
		FROM<br>
		items i<br>
		INNER JOIN Items_List il ON (i.IL_ID = il.IL_ID)<br>
		WHERE<br>
		(il.ItemType = $aItemType) AND (il.ItemNo = $aItemNo) AND<br>
		(i.Item_Position = 1)<br>
		order by i.Item_ComissionCost&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		while ($aRow = <font color="#0000FF">mysql_fetch_array</font>($result)) 
		{<br>
		$aCost = $aRow[&quot;Item_ComissionCost&quot;];<br>
		$aItem = $aRow[&quot;IL_ID&quot;];<br>
		$aItemName = $aRow[&quot;ItemName&quot;];<br>
		$aItemType = $aRow[&quot;ItemType&quot;];<br>
		$aItemNo = $aRow[&quot;ItemNo&quot;];<br>
		$aItemImage = $aRow[&quot;Item_Image&quot;];<br>
		$aStateCost = $aRow[&quot;Item_StateCost&quot;];<br>
		$aBuyItem = $aRow[&quot;IT_ID&quot;];<br>
		$aItemFullLife = $aRow[&quot;Item_FullLife&quot;];<br>
		$aItemCurLife = $aRow[&quot;Item_CurrentLife&quot;];<br>
		<font color="#0000FF">print</font>('&lt;tr&gt;');<br>
		<font color="#0000FF">print</font>('&lt;td width=&quot;10%&quot; valign=&quot;top&quot;&gt;&lt;img 
		src=Items/'.$aItemImage);<br>
		print(&quot;&gt;&lt;br&gt;&lt;a href=comission.phtml?NickName=$aNickName&amp;itemtype=$aItemType&amp;itemid=$aBuyItem&gt;<font color="#008000">купить</font>&lt;/a&gt;&lt;/td&gt;&quot;);<br>
		<font color="#0000FF">print</font>('&lt;td width=&quot;90%&quot; valign=&quot;top&quot; bgcolor=eae0e0&gt;&lt;b&gt;'.$aItemName.'&lt;/b&gt; 
		Долговечность: '.$aItemCurLife.'/'.$aItemFullLife.' &lt;br&gt;Стоимость: &lt;i&gt;'.$aCost.'&lt;/i&gt;&lt;/td&gt;');<br>
		<font color="#0000FF">print</font>('&lt;/tr&gt;');<br>
		<br>
		}<br>
		} </font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
&nbsp;&nbsp; <span lang="ru">Теперь </span>SQL <span lang="ru">запрос отбирает 
еще и только те товары, которые удовлетворяют условию группы (</span></font><font color="#008000" face="Courier" size="2">il.ItemNo 
= $aItemNo</font><font size="2" face="Arial"><span lang="ru">) <br>
&nbsp;&nbsp;&nbsp; В окне нашей игры это выглядит примерно так:<br>
<br>
<img border="0" src="detail.jpg" width="434" height="333"></span><br>
<span lang="ru"> <br>
&nbsp;&nbsp;&nbsp; Теперь нам остается выбрать интересующий нас товар и нажать 
на ссылку &quot;Купить&quot;<br>
</span>
<br>
<a name="kopv2"><span lang="ru"><font color="#000080"><b>10</b></font></span></a><b><span lang="ru"><font face="Arial" color="#000080"><a name="kopv2"><font size="2">.3. </font>
</a></font></span></b><span lang="ru"><b>
<font size="2" face="Arial" color="#000080"><a name="kopv2">Покупка комиссионных 
предметов</a><a name="kopv3">.</a></font></b> <br>
<br>
&nbsp;&nbsp; Покупка выбранного предмета осуществляется путем передачи скрипту 
магазина 
</span>comission.phtml <span lang="ru">параметра&nbsp; 
</span></font><font face="Courier" size="2">&amp;<font color="#000080">itemid</font></font><font size="2" face="Arial"><span lang="ru">, 
который содержит идентификатор предмета в таблице 
</span><b>Items</b>.<span lang="ru"> <br>
&nbsp;&nbsp;&nbsp;&nbsp; Прием этого параметра произведем стандартным образом:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table8">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#008080">// Раз передан этот параметр, значит режим покупки<br>
		</font>$iBuy = false;<br>
		<font color="#0000FF">if</font> (!<font color="#0000FF">empty</font>($<font color="#0000FF">_GET</font>['itemid']))<br>
		{<br>
		$aBuyItem = $<font color="#0000FF">_GET</font>['itemid'];<br>
		$iBuy = true;<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<span lang="ru">&nbsp;&nbsp;&nbsp;&nbsp; Сам механизм приобретения предмета 
можно описать на 
</span>PHP <span lang="ru">следующим образом:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table7">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#0000FF">if</font> ($iBuy){ <font color="#008080">// Была 
		инициирована покупка</font><br>
		<br>
		$lNoMoney=false;<br>
		$query = <font color="#008000">&quot;SELECT i.Item_ComissionCost,i.Item_Owner, 
		il.ItemName FROM items i inner join Items_List il on i.il_id=il.il_id 
		where IT_ID='$aBuyItem'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query,$link) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		$aRow = <font color="#0000FF">mysql_fetch_array</font>( $result);<br>
		$aCost = $aRow[&quot;Item_ComissionCost&quot;]; <font color="#008080">// 
		комиссионная стоимость</font><br>
		$aOwner = $aRow[&quot;Item_Owner&quot;]; <span lang="ru">&nbsp;</span><font color="#008080">// 
		бывший владелец предмета</font><br>
		$aItemName = $aRow[&quot;ItemName&quot;]; <font color="#008080">// название 
		предмета из справочника<br>
		</font><br>
		$aShowCost = $aCost; <font color="#008080">// стоимость в сообщении о 
		покупке<br>
		</font><br>
		<font color="#0000FF">if</font> ($aMoney &gt;= $aCost ){
		<font color="#008080">// хватит ли денег купить вещь в комиссионке?</font><br>
		<br>
		$aMoney = $aMoney - $aCost;<br>
		<font color="#008080">// Засуне</font><font color="#008000">м в рюкзак 
		купленную вещь и поменяем владельца!<br>
		$query = &quot;UPDATE items SET Item_Owner=$aUserID, Item_Position=2 where 
		IT_ID='$aBuyItem'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query,$link) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<br>
		<font color="#008080">// Уменьшим наши деньги</font><br>
		$query = <font color="#008000">&quot;UPDATE users SET Character_Money=Character_Money-$aMoney 
		WHERE Nick_Name='$aNickName'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<br>
		// Добавим денег предыдущему владельцу вещи с учетом комиссии 10%<br>
		$aCost = $aCost - ($aCost*10/100);<br>
		$query = <font color="#008000">&quot;UPDATE users SET Character_Money=Character_Money+$aCost 
		WHERE User_Id='$aOwner'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<br>
		}<font color="#0000FF">else</font><br>
		{<br>
		$lNoMoney=true;<br>
		}<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><span lang="ru"><font face="Arial" size="2">&nbsp;&nbsp;&nbsp; 
Вначале мы узнаем предыдущего владельца предмета, чтоб комиссионный магазин 
перевел ему деньги за купленный нами товар и комиссионную стоимость предмета. 
Если у нас хватает средств на его покупку, происходит процесс смены владельца 
путем установки поля </font></span>
<font color="#008000" face="Courier" size="2">Item_Owner<span lang="ru"> </span>
</font><font face="Arial" size="2"><span lang="ru">на </span>USER_ID
<span lang="ru">купившего персонажа. <br>
&nbsp;&nbsp;&nbsp; Естественно у него отнимаются деньги в размере комиссионной 
стоимости предмета, а бывший владелец купленного товара получает эту стоимость 
за вычетом 10% комиссионного вознаграждения (</span></font><font face="Courier" size="2">$aCost 
= $aCost - ($aCost*10/100)</font><font face="Arial" size="2"><span lang="ru">).<br>
&nbsp;&nbsp;&nbsp; Полный код файла </span>comission.phtml <span lang="ru">Вы 
можете увидеть <a href="10_3/comission.phtml">здесь</a>.<br>
</span></font><font size="2" face="Arial">
<span lang="ru"> 
<br> 
</span><a name="kopv4"><span lang="ru"><font color="#000080"><b>10</b></font></span></a><b><span lang="ru"><font face="Arial" color="#000080"><a name="kopv4"><font size="2">.4.</font></a></font></span></b><font color="#000080"><b>
<a name="kopv4"><span lang="ru">Сдача</span> <span lang="ru">предметов
</span> </b></font></a><span lang="ru">&nbsp;<br>
<br>
&nbsp;&nbsp;&nbsp; В предыдущих пунктах нашего текущего урока мы искусственно 
создали товары на полках комиссионного магазина. Сейчас нам нужно научиться 
самим сдавать собственные предметы в комиссионку.<br>
&nbsp;&nbsp;&nbsp; Давайте сходим в кузницу и купим немного товаров для того 
чтоб их потом сдать на комиссию. С точки зрения игровой логики - это неразумный 
поступок, ведь мы потеряем как минимум 10% их стоимости на оплату услуги 
комиссионного магазина (в случае если сдадим по госстоимости). Но для учебных 
целей такая бессовестная трата игровых денег вполне оправдана.<br>
&nbsp;&nbsp;&nbsp; Допустим мы купили несколько предметов в кузнице и теперь они 
лежат в рюкзаке нашего персонажа. Чтоб отобразить их для сдачи в комиссионке 
давайте кроме пункта меню &quot;Купить&quot; добавим пункт меню &quot;Сдать&quot;, который на
</span>HTML <span lang="ru">будет выглядеть так:
</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table10">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		&lt;a href=&quot;comission.phtml?<font color="#000080">sell=1</font>&amp;NickName=<b>&lt;?</b>
		<font color="#0000FF">echo</font> $aNickName <b>?&gt;</b>&quot;&gt;<span lang="ru">
		</span>Сдать&lt;/a&gt;&lt;br&gt;</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<span lang="ru">&nbsp;&nbsp; Параметр
</span></font><font face="Courier" size="2">
		<font color="#000080">sell</font></font><font size="2" face="Arial"><span lang="ru">, 
который мы передаем скрипту нашего комиссионного магазина как раз и переводит 
нас в режим показа вещей из рюкзака для дальнейшей сдачи в магазин.<br>
&nbsp;&nbsp;&nbsp; Прием этого параметра и установка режима просмотра своих (</span></font><font face="Courier" size="2">$aMode 
= 3</font><font size="2" face="Arial"><span lang="ru">) вещей выглядит так:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table11">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#008080">// Режим показа рюкзака для сдачи вещей</font><br>
		<font color="#0000FF">if</font> (!<font color="#0000FF">empty</font>($<font color="#0000FF">_GET</font>['sell']))<br>
		{<br>
		$aMode = 3;<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<span lang="ru">&nbsp;&nbsp; Теперь можно отобразить свои вещи для сдачи в 
комиссионку:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table12">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#0000FF">if</font> ($aMode==3){ <font color="#008080">// 
		режим сдачи своих вещей</font><br>
		<br>
		<font color="#008080">// Отобразим содержимое рюкзачка для сдачи</font><br>
		$query = <font color="#008000">&quot;SELECT i.IT_ID, i.Item_Position, 
		il.ItemType, il.ItemNo, il.Item_Image, il.ItemName FROM Items i inner 
		join Items_List il on il.il_id=i.il_id WHERE Item_Owner='$aUserID' and 
		Item_Position='2'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<font color="#0000FF">while</font> ($aRow = <font color="#0000FF">
		mysql_fetch_array</font>($result)) {<br>
		$aItemID = $aRow[&quot;IT_ID&quot;];<br>
		$aItemType = $aRow[&quot;ItemType&quot;];<br>
		$aItemNo = $aRow[&quot;ItemNo&quot;];<br>
		$aItemImage = $aRow[&quot;Item_Image&quot;];<br>
		$aItemName = $aRow[&quot;ItemName&quot;];<br>
		<br>
		<font color="#0000FF">echo</font> &quot;&lt;tr&gt;&lt;td&gt;&quot; . &quot;&lt;img align='left' 
		border=0 src=Items/&quot;.$aItemImage.&quot; ALT=&quot;.$aItemName.&quot;&gt;&lt;a href='#' 
		onClick=\&quot;<font color="#000080">sale</font>($aItemID,'&quot;.$aItemName.&quot;')\&quot;&gt;Сдать 
		предмет&lt;/a&gt;&quot; . &quot;&lt;/td&gt;&lt;/tr&gt;&quot;;<br>
		}<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<span lang="ru">&nbsp;&nbsp;&nbsp; Этот фрагмент очень похож на код, который мы 
использовали для показа вещей в рюкзаке (по-секрету - мы его оттуда и взяли). 
Единственное - нужно сформировать ссылку, щелкая на которую игрок может ввести 
цену на сдаваемый в комиссионку предмет. В вышеприведенном коде, при клике мышью 
на этой ссылке, вызывается функция
</span></font><font face="Courier" size="2">
		<font color="#000080">sale</font></font><font size="2" face="Arial"><span lang="ru">, 
которая на
</span><i>JavaScript</i> <span lang="ru">выглядит так:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table13">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<b>function</b> <font color="#000080">sale</font>(id, name){<br>
		var kr = 0;<br>
		var s = <font color="#000080">prompt</font>(&quot;<span lang="ru">Сдача</span> 
		товара \&quot;&quot;+name+&quot;\&quot;. Укажите цену:&quot;, kr);<br>
		if ((s != null)&amp;&amp;(s != '')) {<br>
		kr = <font color="#000080">parseInt</font>(s);<br>
		if (kr&gt;0){<br>
		location.href=&quot;comission.phtml?NickName=&lt;? echo $aNickName ?&gt;&amp;sellid=&quot;+id+&quot;&amp;kr=&quot;+s+&quot;&amp;sellname=&quot;+name;<br>
		} else {<br>
		alert(&quot;Вы не можете назначить цену: &quot;+s);<br>
		}<br>
		}<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<span lang="ru">&nbsp;&nbsp; Мы используем стандартное диалоговое окно
</span></font><font color="#000080" face="Courier" size="2">prompt<span lang="ru">
</span></font><font size="2" face="Arial">
<span lang="ru">для того чтоб игрок ввел цену сдаваемого предмета. Потом правда 
нужно проверить, ввел ли он корректные цифры при помощи функции
</span></font><font face="Courier" size="2">
		<font color="#000080">parseInt</font></font><font size="2" face="Arial"><span lang="ru">. 
Если эта сумма больше нуля мы снова отдаем управление в наш скрипт передавая 
туда параметры
</span></font><font face="Courier" size="2">
		&amp;<font color="#000080">sellid</font></font><font size="2" face="Arial"><span lang="ru"> 
(идентификатор предмета в таблице
</span><b>items</b><span lang="ru">)</span> <span lang="ru">и
</span></font><font face="Courier" size="2">
		&amp;<font color="#000080">kr</font></font><font size="2" face="Arial"><span lang="ru"> 
(введенная игроком стоимость товара)<br>
&nbsp;&nbsp; Теперь мы принять эти параметры в скрипте магазина:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table14">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#008080">// Режим сдачи предмета из рюкзака<br>
		</font><font color="#0000FF">if</font> (!<font color="#0000FF">empty</font>($_GET['sellid']))<br>
		{<br>
		$aSellItem = $<font color="#0000FF">_GET</font>['sellid'];<br>
		$aKr = $<font color="#0000FF">_GET</font>['kr'];<br>
		$aSellName = $<font color="#0000FF">_GET</font>['sellname'];<br>
		$iSell = true;<br>
		$aMode = 3;<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<span lang="ru">&nbsp;&nbsp;&nbsp; И реализуем непосредственно сдачу предмета:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table15">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#0000FF">if</font> ($iSell){ <font color="#008080">// Была 
		инициирована сдача в магазин<br>
		// Засунем вещь на полку магазина</font><br>
		$query = <font color="#008000">&quot;UPDATE items SET Item_Position=1, 
		Item_ComissionCost=$aKr where IT_ID='$aSellItem'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query,$link) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<span lang="ru">&nbsp;&nbsp;&nbsp; Сдача заключается в изменение значения поля 
на
</span></font><font color="#008000" face="Courier" size="2">Item_Position<span lang="ru">
</span></font><font size="2" face="Arial">
<span lang="ru">единицу и полю
</span></font><font color="#008000" face="Courier" size="2">Item_ComissionCost<span lang="ru">
</span></font><span lang="ru"><font face="Arial" size="2">присваивается 
стоимость предмета.</font></span><font size="2" face="Arial"><span lang="ru">
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Результат сдачи предмета может выглядеть так:<br>
<br>
<img border="0" src="sell.jpg" width="390" height="228"><br>
<br>
&nbsp;&nbsp;&nbsp;<br>
</span><a name="kopv6"><span lang="ru"><font color="#000080"><b>10</b></font></span></a><b><span lang="ru"><font face="Arial" color="#000080"><a name="kopv6"><font size="2">.5. 
</font></a></font></span></b><font color="#000080"><b><span lang="ru">
<a name="kopv8">Переоценка и возврат </a>предметов</span></b></font><span lang="ru"><b><font size="2" face="Arial" color="#000080"><a name="kopv7">.</a></font></b>
<br><br>
&nbsp;&nbsp;&nbsp; Иногда возникает ситуация, когда игроку необходимо поменять 
стоимость сданного в комиссионку предмета. Допустим ваш товар долго не продается 
и на полке появились сходные товары с меньшим износом с более конкурентной 
ценой. Чтоб Ваш предмет быстрее продался поневоле придется сбавлять стоимость.<br>
&nbsp;&nbsp;&nbsp; Иногда вообще нужно забрать свой предмет из комиссионки. К 
примеру, игрок договорился за эту же стоимость продать его в торговой зале, где 
он не потеряет 10% комиссионных услуг.<br>
&nbsp;&nbsp;&nbsp; Давайте сделаем пункт меню &quot;Забарть&quot;, который будет вызывать 
режим отображения предметов сданных в комиссионный магазин. На </span>HTML <span lang="ru">будет выглядеть так:
</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table16">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		&lt;a href=&quot;comission.phtml?<font color="#000080">take=1</font>&amp;NickName=<b>&lt;?</b>
		<font color="#0000FF">echo</font> $aNickName <b>?&gt;</b>&quot;&gt; Забрать&lt;/a&gt;&lt;br&gt;</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru">&nbsp;&nbsp; 
Параметр </span></font><font face="Courier" size="2">
		<font color="#000080">take</font></font><font size="2" face="Arial"><span lang="ru">, 
который мы передаем в файл </span><span lang="en-us">comission.phtml </span>п<span lang="ru">ереведет 
наш комиссионный магазин в режим показа наших сданных товаров. На </span>
<span lang="en-us">PHP </span>э<span lang="ru">то реализуется таким образом:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table17">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#0000FF">if</font> ($aMode==4){ <font color="#008080">// 
		режим отображения сданных вещей</font><br>
		<br>
		<font color="#008080">// Отобразим содержимое сданных вещей<br>
		</font>$query = <font color="#008000">&quot;SELECT i.IT_ID, 
		i.Item_ComissionCost, i.Item_Position, il.ItemType, il.ItemNo, 
		il.Item_Image, il.ItemName FROM Items i inner join Items_List il on 
		il.il_id=i.il_id WHERE Item_Owner='$aUserID' and Item_Position='1'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<font color="#0000FF">while</font> ($aRow = <font color="#0000FF">
		mysql_fetch_array</font>($result)) {<br>
		$aItemID = $aRow[&quot;IT_ID&quot;];<br>
		$aItemType = $aRow[&quot;ItemType&quot;];<br>
		$aItemNo = $aRow[&quot;ItemNo&quot;];<br>
		$aItemImage = $aRow[&quot;Item_Image&quot;];<br>
		$aItemName = $aRow[&quot;ItemName&quot;];<br>
		$aCost = $aRow[&quot;Item_ComissionCost&quot;];<br>
		<br>
		<font color="#0000FF">echo</font> &quot;&lt;tr&gt;&lt;td&gt;&quot; . &quot;&lt;img align='left' border=0 
		src=Items/&quot;.$aItemImage.&quot; ALT=&quot;.$aItemName.&quot;&gt;&quot;.<br>
		&quot;Стоимость: $aCost&quot;.<br>
		&quot;&lt;br&gt;&lt;a href='#' onClick=\&quot;<font color="#000080">takeback</font>($aItemID,'&quot;.$aItemName.&quot;')\&quot;&gt;Забрать 
		предмет&lt;/a&gt;&quot;.<br>
		&quot;&lt;br&gt;&lt;a href='#' onClick=\&quot;<font color="#000080">chsale</font>($aItemID,'&quot;.$aItemName.&quot;',$aCost)\&quot;&gt;Сменить 
		цену&lt;/a&gt;&quot; . &quot;&lt;/td&gt;&lt;/tr&gt;&quot;;<br>
		}<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="en-us">&nbsp;&nbsp;
</span>Н<span lang="ru">ет ничего проще чем отобразить предметы игрока, где </span></font>
<font color="#008000" face="Courier" size="2">Item_Position </font>
<font size="2" face="Arial"><span lang="ru">равно единице. На странице браузера 
это будет выглядеть так:<br>
<br>
<img border="0" src="change.jpg" width="449" height="131"><br>
<br>
&nbsp;&nbsp; Нажав на ссылку </span></font>
<font face="Courier" size="2" color="#000080">
		Сменить цену</font><font size="2" face="Arial"><span lang="ru"> игрок 
вызывает функцию </span></font><font color="#000080" face="Courier" size="2">
chsale</font><font size="2" face="Arial"><span lang="ru">, код которой на </span>
<span lang="en-us"><i>JavaScript</i> </span>в<span lang="ru">ыглядит так:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table18">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<b>function</b> <font color="#000080">chsale</font>(id, name, kr){<br>
		var s = prompt(&quot;Сменить цену для предмета \&quot;&quot;+name+&quot;\&quot;. Укажите новую 
		цену:&quot;, kr);<br>
		if ((s != null)&amp;&amp;(s != '')) {<br>
		location.href=&quot;comission.phtml?NickName=<b>&lt;?</b> <font color="#0000FF">
		echo</font> $aNickName <b>?&gt;</b> &amp;chid=&quot;+id+&quot;&amp;kr=&quot;+s+&quot;&amp;chname=&quot;+name;<br>
		}<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru">&nbsp;&nbsp;
<img border="0" src="ch_c.jpg" width="496" height="281"><br>
<br>
&nbsp;&nbsp;&nbsp; Играющий вводит новую цену и нажимает Ок. После этого в 
скрипт сценария передаются параметры </span></font>
<font face="Courier" size="2">
		&amp;<font color="#000080">chid</font></font><font size="2" face="Arial"><span lang="ru">, 
который является идентификатором предмета, </span></font>
<font face="Courier" size="2">
		&amp;<font color="#000080">kr</font></font><font face="Arial" size="2">
<span lang="ru">- новая стоимость и </span></font><font face="Courier" size="2">
		&amp;<font color="#000080">chname</font></font><font face="Arial" size="2"> 
-<span lang="ru"> название предмета<br>
&nbsp;&nbsp;&nbsp; Наш </span><span lang="en-us">PHP </span>к<span lang="ru">од 
должен обработать эту ситуацию и поменять стоимость предмета в таблице 
предметов:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table19">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#0000FF">if</font> ($iChSell){ <font color="#008080">// 
		Была инициирована переоценка предмета<br>
		// Поменям стоимость предмета в комиссионке</font><br>
		$query = <font color="#008080">&quot;UPDATE items SET Item_ComissionCost=$aKr 
		where IT_ID='$aChItem'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query,$link) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp;&nbsp; Если 
же игрок нажимает на ссылку Забрать предмет, то в этом случае срабатывает </span>
<span lang="en-us"><i>JavaScript</i> </span>ф<span lang="ru">ункция </span>
</font><font color="#000080" face="Courier" size="2">takeback</font><font face="Arial" size="2"><span lang="ru">, 
код которой также предельно прост:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table20">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<b>function</b> <font color="#000080">takeback</font>(id, name){<br>
		if ( confirm( &quot;Вы действительно хотите забрать предмет: &quot;+name) ){<br>
		location.href=&quot;comission.phtml?NickName=&lt;? echo $aNickName ?&gt;&amp;takeid=&quot;+id+&quot;&amp;takename=&quot;+name;<br>
		}<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">
<img border="0" src="take.jpg" width="444" height="262"><br>
<br>
&nbsp;&nbsp; В случае положительного решения, выполняется следующий </span>
<span lang="en-us">PHP </span>к<span lang="ru">од:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table21">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#0000FF">if</font> ($iTake){ <font color="#008080">// 
		Забираем свои товары</font><br>
		<font color="#008080">// Засунем вещь снова к себе в рюкзак</font><br>
		$query = <font color="#008000">&quot;UPDATE items SET Item_Position=2 where 
		IT_ID='$aTakeItem'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query,$link) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font face="Arial" size="2"><span lang="ru">&nbsp;&nbsp; и 
предмет снова возвращается в рюкзак игрока (</span></font><font color="#008000" face="Courier" size="2">Item_Position=2</font><font face="Arial" size="2"><span lang="ru">). 
В качестве упражнения Вы можете сделать так, чтоб переоценка и возврат предмета 
из комиссионки был платным. Например, за это взималась 1 кредитка!<br>
&nbsp;&nbsp; Полный текст файла </span><span lang="en-us">comission.phtml </span>
В<span lang="ru">ы можете найти <a href="10_4/comission.phtml">здесь</a>.<br>
<b><br>
В следующем уроке</b> мы займемся созданием клубного чата, научимся писать 
сообщения всем и отдельным игрокам, использовать смайлики.</span></font></p>
<font size="2" face="Arial">
        <p align="left">&nbsp;</font></td>
      <td width="27" height="356" background="Site/middle2.jpg">&nbsp;</td>
    </tr>
    <tr>
      <td width="740" height="38" background="Site/bottom.jpg" colspan="3">&nbsp;</td>
    </tr>
  </table>
  </center>
</div>

</body>

</html>