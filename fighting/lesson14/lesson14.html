<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<meta name="GENERATOR" content="Microsoft FrontPage 6.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>New Page 1</title>
<style>
<!--
table.MsoTableGrid
	{border:1.0pt solid windowtext;
	font-size:10.0pt;
	font-family:"Times New Roman","serif"}
-->
</style>
</head>

<body>

<div align="center">
  <center>
  <table border="0" width="740" height="350" cellspacing="0" cellpadding="0">
    <!-- MSTableType="nolayout" -->
	<tr>
      <td width="740" height="133" background="Site/top.jpg" colspan="3">&nbsp;</td>
    </tr>
    <tr>
      <td width="127" height="356" background="Site/middle1.jpg" valign="top">
        <p align="left">
        <b><font face="Arial" size="1" color="#505866">&nbsp;&nbsp;&nbsp; 
		<a href="http://www.blitz-school.info"><font color="#FFFF99">Курсы</font></a><br>
        &nbsp;&nbsp;&nbsp; </font><font face="Arial" size="1" color="#FFFF99">
		<a href="http://www.blitz-school.info/reg.html"><font color="#FFFF99">Регистрация</font></a><br>
        &nbsp;&nbsp;&nbsp;
		<a href="http://www.blitz-school.info/study_tech.html">
		<font color="#FFFF99">Методика</font></a><br>
        &nbsp;&nbsp;&nbsp; </font>
		<a href="http://www.blitz-school.info/program.html"><font face="Arial" size="1" color="#FFFF99">Оглавление</font></a><font face="Arial" size="1" color="#FFFF99"><br>
        &nbsp;&nbsp;&nbsp; <a href="http://www.blitz-school.info/login.html">
		<font color="#FFFF99">Для учащихся</font></a><br>
        &nbsp;&nbsp;&nbsp; </font></b>
		<img border="0" src="../navdiv.gif" width="80" height="4"><br>
        <b><font size="1" face="Arial" color="#505866">&nbsp;&nbsp;&nbsp;
        <a href="http://www.blitz-school.info/articles.html">
		<font color="#FFFF99">Статьи</font></a><br>
        &nbsp;&nbsp;&nbsp; </font><font size="1" face="Arial" color="#FFFF99">
		<a href="http://www.blitz-school.info/instrum.html">
		<font color="#FFFF99">Инструменты</font></a><br>
		<span lang="en-us">&nbsp;&nbsp;&nbsp; </span>
		<a href="http://www.blitz-school.info/contacts.html">
		<font color="#FFFF99">Контакты</font></a><br>
		<span lang="en-us">&nbsp;&nbsp;&nbsp; </span></font></b>&nbsp;</td>
      <td width="586" height="356" background="Site/bg.gif" valign="top">

<p align="center"><font color="#008000"><b><font size="5"><span lang="ru">Урок </span>
14<span lang="ru">.</span></font></b><span lang="ru"><font size="5"><b>&nbsp; 
Платные сервисы игры</b></font><br>
</span>
</font><b></p>
<p align="justify"><span lang="ru"><font size="2" face="Arial" color="#000080">
1</span>4<span lang="ru"><a name="kopv">.1. 
</a></span></font></b><a name="kopv"><span lang="ru"><b>
<font face="Arial" size="2" color="#000080">Особые предметы (артефакты)</font></b></span></a><span lang="ru"><b><a name="kopv"><font size="2" face="Arial" color="#000080">.</font></a></b><font size="2" face="Arial">
<br>
</font></span><font size="2" face="Arial">
&nbsp;&nbsp;&nbsp;&nbsp; <span lang="ru"><br>
</span>&nbsp; <span lang="ru">&nbsp; Что такое артефакты? Это вещи, недоступные 
большинству игроков в клубе: они не продаются в кузнице за обычные игровые 
деньги. Параметры артефактов значительно выигрывают перед стандартными 
параметрами вещей в игре, что дает обладателю артефакта преимущество перед 
остальными игроками. Артефактами может быть не только оружие, но и доспехи, 
кольца и прочие предметы в игре.<br>
&nbsp;&nbsp;&nbsp;&nbsp; Во многих он-лайн играх&nbsp; кроме обычных игровых 
денег введены еще специальные денежные средства для покупки предметов типа 
артефактов. Обычно эти деньги являются аналогом какой-то реальной валюты - евро 
или доллара. Так в игре Бойцовский Клуб (</span><span lang="en-us"><a href="http://www.combats.ru">www.combats.ru</a></span><span lang="ru">)</span><span lang="en-us">
</span>т<span lang="ru">акие деньги называются еврокредами и имеют курс обмена 1 
еврокред = 1 евро.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Введение особых предметов (артефактов) позволяет 
создателям игры получать неплохой доход от игроков, которые могут себе позволить 
покупку такого рода игровых предметов. <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Кроме артефактов, в игре могут участвовать 
несколько более дешевые предметы - валютные игровые предметы, которые тоже можно 
купить только за еврокредиты (мы тоже будем использовать это название). Это 
сделано специально, чтоб игроки, которые не могут себе позволить приобретение 
дорогостоящих артефактов, тем не менее тоже могли использовать более лучшие 
предметы, чем обычные, продаваемые в кузнице.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Безусловно обычный игрок может купить и 
валютный предмет и артефакт за обычные игровые деньги, например у торговца в 
&quot;Торговых рядах&quot; или &quot;Комиссионном магазине&quot;, которые до этого выложили за них 
определенную сумму в еврокредах (екр). <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Описать системы ввода денег.....)</span><br>
<span lang="ru"><br>
&nbsp;</span>&nbsp; <span lang="ru"> 
<br>
</span></font><a name="kopv0"><b>
<span lang="ru">
<font face="Arial" size="2" color="#000080">1</font></span><font face="Arial" size="2" color="#000080">4</font></b></a><font size="2" face="Arial"><b><span lang="ru"><font face="Arial" color="#000080"><a name="kopv0"><font size="2">.2. 
</font></a></font></span><font size="2" face="Arial" color="#000080">
<span lang="ru"><a name="kopv0">Валютный магазин</a><a name="kopv1">.</a></span></font></b><span lang="ru"> <br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp; Давайте создадим валютный магазин, в котором будут 
продаваться валютные предметы (назовем их </span><span lang="en-us">EURO-</span>п<span lang="ru">редметы) 
и артефакты. В таком магазине могут себе позволить делать покупки только игроки 
обладающие определенной суммой в екр.<br>
&nbsp;&nbsp;&nbsp;&nbsp; Давайте создадим несколько таких предметов, для 
тестирования нашего валютного магазина. Вот они:</span></font></p>
<table border="1" width="100%" id="table1">
	<tr>
		<td>
		<img border="0" src="14_2/arts/belt_euro2.jpg" width="55" height="19"><br>
		Пояс Отваги</td>
		<td>
		<img border="0" src="14_2/arts/helmet_euro2.jpg" width="55" height="49"><br>
		Шлем Солнца</td>
		<td>
		<img border="0" src="14_2/arts/mace_art2.jpg" width="55" height="78"><br>
		Молот Прозрения
		<img border="0" src="14_2/arts/artefact.gif" width="18" height="16" alt="Предмет является артефактом"></td>
		<td>
		<img border="0" src="14_2/arts/mace_euro2.jpg" width="55" height="78"><br>
		Молот Крови</td>
		<td width="12">
		<img border="0" src="14_2/arts/shield_art2.jpg" width="56" height="80"><br>
		Щит Забвения
		<img border="0" src="14_2/arts/artefact.gif" width="18" height="16" alt="Предмет является артефактом"></td>
		<td>
		<img border="0" src="14_2/arts/shoes_euro2.jpg" width="55" height="54"><br>
		Сапоги Радуги</td>
		<td>
		<img border="0" src="14_2/arts/skirt_art2.jpg" width="55" height="77"><br>
		Броня Возрождения
		<img border="0" src="14_2/arts/artefact.gif" width="18" height="16" alt="Предмет является артефактом"></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru"> <br>
&nbsp;&nbsp; Предметы, возле которых стоит значок&nbsp;
<img border="0" src="14_2/arts/artefact.gif" width="18" height="16"> являются 
артефактами. Остальные - это </span><span lang="en-us">EURO-</span>п<span lang="ru">редметы. 
Картинки всех этих вещей Вы можете найти в папке <a href="14_2/arts">14_</a></span><a href="14_2/arts"><span lang="en-us">2/arts</span></a><span lang="ru"><br>
&nbsp; </span><span lang="en-us">&nbsp; </span>Т<span lang="ru">еперь нам 
предстоит добавить эти типы предметов в нашу таблицу справочника предметов </span>
<span lang="en-us"><b>items_list</b>. </span>З<span lang="ru">делаем это 
следующими </span><span lang="en-us">SQL </span>с<span lang="ru">троками:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table2">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#008080">/* добавим несколько евро-предметов и артефактов 
		*/</font><br>
		INSERT INTO Items_List (IL_ID,ItemType,ItemNo,ItemName,Item_StateCost,Item_Image, 
		ItemSlotName,Item_Level,Item_FullLife,Item_Euro_Art) VALUES(18,120,1,'<font color="#008000">Молот 
		Крови</font>',200,'mace_euro2.jpg','Weapon',1,100,1);<br>
		INSERT INTO Items_List (IL_ID,ItemType,ItemNo,ItemName,Item_StateCost,Item_Image, 
		ItemSlotName,Item_Level,Item_FullLife,Item_Euro_Art) VALUES(19,120,2,'<font color="#008000">Молот 
		Прозрения</font>',520,'mace_art2.jpg','Weapon',1,200,2);<br>
		INSERT INTO Items_List (IL_ID,ItemType,ItemNo,ItemName,Item_StateCost,Item_Image, 
		ItemSlotName,Item_Level,Item_FullLife,Item_Euro_Art) VALUES(20,125,1,'<font color="#008000">Щит 
		Забвения</font>',720,'shield_art2.jpg','Shield',1,200,2);<br>
		INSERT INTO Items_List (IL_ID,ItemType,ItemNo,ItemName,Item_StateCost,Item_Image, 
		ItemSlotName,Item_Level,Item_FullLife,Item_Euro_Art) VALUES(21,126,1,'<font color="#008000">Шлем 
		Солнца</font>',550,'helmet_euro2.jpg','Helmet',1,100,1);<br>
		INSERT INTO Items_List (IL_ID,ItemType,ItemNo,ItemName,Item_StateCost,Item_Image, 
		ItemSlotName,Item_Level,Item_FullLife,Item_Euro_Art) VALUES(22,128,1,'<font color="#008000">Сапоги 
		Радуги</font>',450,'shoes_euro2.jpg','Shoes',1,100,1);<br>
		INSERT INTO Items_List (IL_ID,ItemType,ItemNo,ItemName,Item_StateCost,Item_Image, 
		ItemSlotName,Item_Level,Item_FullLife,Item_Euro_Art) VALUES(23,129,1,'<font color="#008000">Броня 
		Возрождения</font>',750,'skirt_art2.jpg','Armor',1,100,2);<br>
		INSERT INTO Items_List (IL_ID,ItemType,ItemNo,ItemName,Item_StateCost,Item_Image, 
		ItemSlotName,Item_Level,Item_FullLife,Item_Euro_Art) VALUES(24,130,1,'<font color="#008000">Пояс 
		Отваги</font>',350,'belt_euro2.jpg','Belt',1,200,1);<br>
&nbsp;</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru">&nbsp;&nbsp; Но 
перед этим не забудьте в таблицу </span><span lang="en-us"><b>items_list</b>
</span><span lang="ru">добавить новое поле:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table3">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">`<font color="#000080">Item_Euro_Art</font>` 
		INT DEFAULT 0, <font color="#008080">/*1 - европредмет 2 - артефакт*/</font></font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="en-us">&nbsp; </span>
К<span lang="ru">роме этого, в таблице </span><span lang="en-us"><b>users</b>
</span>н<span lang="ru">ужно добавить еще одно одно поле </span>
<font color="#000080"><span lang="en-us">Character_Euro</span></font>
<span lang="ru">которое будет содержать сумму денег нашего персонажа в екр.</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table4">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">Character_Euro FLOAT 
		DEFAULT 0, /* EURO креды */</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru">&nbsp;&nbsp; 
Давайте разместим валютный магазин во второй части Центральной Площади, 
описываемой файлом </span><span lang="en-us">map2.phtml. </span>Н<span lang="ru">а </span>
<span lang="en-us">HTML </span>о<span lang="ru">писание магазина выглядит так:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table5">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">&lt;div style=&quot;position:absolute;left:470px;top:110px;width:149px; 
		height:136px; z-index:12;z-index:12&quot;&gt;&lt;IMG SRC=Items/Towns/Silluria/euroshop.gif 
		CLASS=aFilter onmouseover=&quot;imover(this)&quot; onmouseout=&quot;imout(this)&quot; 
		onclick=&quot;<font color="#000080">gotoEuro</font>()&quot; ALT=&quot;<font color="#008000">Евромагазин</font>&quot; 
		width=&quot;78&quot; height=&quot;63&quot;&gt;&lt;/div&gt;</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru">&nbsp;&nbsp; Сам 
магазин у нас будет выглядеть так:</span></font></p>
<table border="1" width="100%" id="table6">
	<tr>
		<td>
		<img border="0" src="14_5/items/TOWNS/Silluria/euroshop.gif" width="78" height="63"> 
		Валютный магазин (позаимствовано с <span lang="en-us">www.combats.ru</span> 
		)</td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="en-us">&nbsp;&nbsp;
</span>П<span lang="ru">ри нажатии на картинку магазина, срабатывает функция </span></font>
<font color="#000080" face="Courier" size="2">gotoEuro</font><font size="2" face="Arial"><span lang="ru">, 
которая позволяет нам войти вовнутрь. <br>
&nbsp;&nbsp;&nbsp; Давайте создадим таблицу </span><span lang="en-us"><b>
euroshop</b>, </span>д<span lang="ru">ля добавления нескольких экземпляров из 
вышеописанных предметов:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table7">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#008080">/*таблица для продажи ЕВРО-товаров и Артефактов*/<br>
		</font>CREATE TABLE `euroshop`(<br>
		`EUR_ID` BIGINT(20) unsigned NOT NULL auto_increment,
		<font color="#008080">/* уник. идентификатор предмета в магазине */</font><br>
		`IL_ID` INT(4) unsigned NOT NULL, /<font color="#008080">* ID предмета в 
		справочнике предметов */</font><br>
		`Town` INT(2) unsigned NOT NULL, <font color="#008080">/* Город, где 
		расположено здание */</font><br>
		`QTY` INT NOT NULL, <font color="#008080">/* количество предметов */</font><br>
		PRIMARY KEY (`EUR_ID`),<br>
		KEY (`Town`)<br>
		) TYPE=MyISAM;</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru">&nbsp;&nbsp; 
Добавим предметы:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table8">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">INSERT INTO euroshop 
		(Town,IL_ID,QTY) VALUES(1,18,7);&nbsp; --<font color="#008000">Молот 
		Крови</font><br>
		INSERT INTO euroshop (Town,IL_ID,QTY) VALUES(1,19,2);&nbsp; --<font color="#008000">Молот 
		Прозрения</font><br>
		INSERT INTO euroshop (Town,IL_ID,QTY) VALUES(1,20,5);&nbsp; --<font color="#008000">Щит 
		Забвения</font><br>
		INSERT INTO euroshop (Town,IL_ID,QTY) VALUES(1,21,12); --<font color="#008000">Шлем 
		Солнца</font><br>
		INSERT INTO euroshop (Town,IL_ID,QTY) VALUES(1,22,10); --<font color="#008000">Сапоги 
		Радуги</font><br>
		INSERT INTO euroshop (Town,IL_ID,QTY) VALUES(1,23,4); --<font color="#008000">Броня 
		Возрождения</font><br>
		INSERT INTO euroshop (Town,IL_ID,QTY) VALUES(1,24,11); --<font color="#008000">Пояс 
		Отваги</font></font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru">&nbsp;&nbsp; 
Теперь давайте напишем код на </span><span lang="en-us">PHP </span>д<span lang="ru">ля 
файла </span><span lang="en-us">euroshop.phtml</span>,<span lang="en-us"> </span>
к<span lang="ru">оторый отобразит нам эти товары:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table9">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#0000FF">if</font> ($aMode==1){<br>
		<font color="#008080">// Отобразим содержимое магазина евро-товаров</font><br>
		$query = <font color="#008000">&quot;SELECT il.IL_ID, il.Item_Euro_Art, 
		il.ItemName, il.ItemType, il.ItemNo, il.Item_Image, il.Item_StateCost, 
		s.QTY FROM euroshop s inner join Items_List il on s.IL_ID=il.IL_ID WHERE 
		il.ItemType='$aItemType'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<font color="#0000FF">while</font> ($aRow = <font color="#0000FF">
		mysql_fetch_array</font>($result)) {<br>
		$aItem = $aRow[&quot;IL_ID&quot;];<br>
		$aItemType = $aRow[&quot;ItemType&quot;];<br>
		$aItemNo = $aRow[&quot;ItemNo&quot;];<br>
		$aItemQty = $aRow[&quot;QTY&quot;];<br>
		$aItemImage = $aRow[&quot;Item_Image&quot;];<br>
		$aStateCost = $aRow[&quot;Item_StateCost&quot;];<br>
		$aItemName = $aRow[&quot;ItemName&quot;];<br>
		$aItem_Euro_Art = $aRow[&quot;Item_Euro_Art&quot;];<br>
		<font color="#0000FF">print</font>('&lt;tr&gt;');<br>
		<font color="#0000FF">print</font>('&lt;td width=&quot;10%&quot; valign=&quot;top&quot;&gt;&lt;img 
		src=Items/'.$aItemImage);<br>
		<font color="#0000FF">print</font>(&quot;&gt;&lt;br&gt;&lt;a href=<font color="#000080">euroshop.phtml</font>?NickName=$aNickName&amp;itemtype=$aItemType&amp;item=$aItem&gt;<font color="#008000">купить</font>&lt;/a&gt;&lt;/td&gt;&quot;);<br>
		<font color="#0000FF">print</font>('&lt;td width=&quot;90%&quot; valign=&quot;top&quot; bgcolor=eae0e0&gt;'.$aItemName);<br>
		<font color="#0000FF">if</font> ( $aItem_Euro_Art == 2 )
		<font color="#0000FF">print</font>(' &lt;img src=&quot;Items/artefact.gif&quot; alt=&quot;Предмет 
		является артефактом&quot;&gt;');<br>
		print('&lt;br&gt;Стоимость: '.$aStateCost.' екр (количество:'.$aItemQty.')&lt;/td&gt;');<br>
		<font color="#0000FF">print</font>('&lt;/tr&gt;');<br>
		}<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru">&nbsp;&nbsp; В 
окне браузера это (в данном случае - полка с молотами) выглядит следующим 
образом:<br>
<img border="0" src="euroshop1.jpg" width="521" height="276"><br>
<br>
&nbsp;&nbsp; При нажатии на ссылку &quot;<u>купить</u>&quot;&nbsp; мы передаем нашему 
скрипту два важных параметра </span></font>
<font face="Courier" size="2" color="#000080">&amp;itemtype</font><font size="2" face="Arial"><span lang="ru"> 
и </span></font><font face="Courier" size="2" color="#000080">&amp;item</font><font size="2" face="Arial"><span lang="ru">, 
для того чтоб создать в рюкзаке у покупателя вещь на основе информации из 
справочника. Собственно процесс покупки реализуем так:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table10">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#0000FF">if</font> ($iBuy){ <font color="#008080">// Была 
		инициирована покупка</font><br>
		<br>
		<font color="#008080">// Сколько вещей этого типа?</font><br>
		$query = <font color="#008000">&quot;SELECT 
		s.EUR_ID,s.QTY,il.Item_StateCost,il.ItemName,il.ItemType,il.ItemNo FROM 
		euroshop s inner join Items_List il on s.IL_ID=il.IL_ID WHERE il.IL_ID = 
		'$aItem'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		$aRow = <font color="#0000FF">mysql_fetch_array</font>( $result);<br>
		$aEURID = $aRow[&quot;EUR_ID&quot;];<br>
		$aQTY = $aRow[&quot;QTY&quot;];<br>
		$aStateCost = $aRow[&quot;Item_StateCost&quot;];<br>
		$aItemName = $aRow[&quot;ItemName&quot;];<br>
		<br>
		<font color="#0000FF">if</font> ($aQTY-- &gt; -1){ <font color="#008080">// 
		есть ли вообще эти вещи?</font><br>
		$lNoMoney=false;<br>
		<font color="#0000FF">if</font> ($aMoney &gt;= $aStateCost){
		<font color="#008080">// хватит ли денег купить вещь?</font><br>
		$aMoney = $aMoney - $aStateCost;<br>
		<font color="#008080">// Засунем в рюкзак купленную вещь!<br>
		</font>$query = <font color="#008000">&quot;INSERT INTO items(IL_ID,Item_Owner,Item_Position,Item_CurrentLife)&quot;;<br>
		$query .= &quot;Values ('$aItem','$aUserID','2','0')&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query,$link) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<br>
		<font color="#008080">// Уменьшим деньги</font><br>
		$query = <font color="#008000">&quot;UPDATE users SET Character_Euro='$aMoney' 
		WHERE Nick_Name='$aNickName'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<br>
		<font color="#008080">// Уменьшим кол-во предметов в магазине</font><br>
		$query = <font color="#008000">&quot;UPDATE euroshop SET QTY='$aQTY' WHERE 
		EUR_ID='$aEURID'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<br>
		}<font color="#0000FF">else</font><br>
		{<br>
		$lNoMoney=true;<br>
		}<br>
		}<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru">&nbsp; Тут все 
стандартно. Единственное, покупка осуществляется за екр, а не за обычные деньги, 
поэтому переменная </span></font><font face="Courier" size="2">$aMoney </font>
<font size="2" face="Arial"><span lang="ru">это:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table11">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">$aMoney = $aRow[&quot;Character_Euro&quot;];</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<font color="#000080"><span lang="ru">
<b><a name="kopv2">1</a></b></span><b><a name="kopv2">4</a></b></font><b><span lang="ru"><font face="Arial" color="#000080"><a name="kopv2"><font size="2">.3. 
Банк, </font></a></font></span></b><a name="kopv2"><font color="#000080"><b>
открытие счетов</b></font></a><span lang="ru"><b><font size="2" face="Arial" color="#000080"><a name="kopv3">.</a></font></b> <br>
<br>
&nbsp;&nbsp;&nbsp; Для того, чтоб еврокредиты появились в наличном обороте, они 
вначале помещаются на валютном счете игрового персонажа. К примеру, игрок решил 
купить еврокредиты и перевел деньги на счет онлайн игры (или одного из дилеров 
игры) через систему  
</span><span lang="en-us">WebMoney </span>и<span lang="ru">ли Яндекс.Деньги. <br>
&nbsp;&nbsp;&nbsp; Ответственный работник сервиса поместил эквивалент этих денег 
на евро-счет игрока и тот может отправляться в валютный магазин за товарами.<br>
&nbsp;&nbsp;&nbsp;&nbsp; Давайте расположим здание банка также на западной части 
Центральной Площади. Картинка банка будет выглядеть так:</span></font></p>
<table border="1" width="100%" id="table12">
	<tr>
		<td>
		<img border="0" src="14_5/items/TOWNS/Silluria/bank.gif" width="106" height="73"> 
		Банк</td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<span lang="ru"><br>
&nbsp;&nbsp; Вот как выглядит его описание на  
</span><span lang="en-us">HTML </span>в<span lang="ru"> файле  
</span><span lang="en-us">map2.phtml:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table13">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">&lt;div style=&quot;position:absolute;left:120px;top:250px;width:149px; 
		height:136px; z-index:12;z-index:12&quot;&gt;&lt;IMG SRC=Items/Towns/Silluria/bank.gif 
		CLASS=aFilter onmouseover=&quot;imover(this)&quot; onmouseout=&quot;imout(this)&quot; 
		onclick=&quot;<font color="#000080">gotoBank</font>()&quot; ALT=&quot;<font color="#008000">Банк</font>&quot; 
		width=&quot;106&quot; height=&quot;73&quot;&gt;&lt;/div&gt;</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">
<span lang="en-us">&nbsp;&nbsp;&nbsp; </span>Теперь наступила очередь создать 
файл <span lang="en-us">bank.phtml</span>, который будет отображаться при 
нажатии на картинку банка и выполнения функции <span lang="en-us">JavaScript
</span></font><font color="#000080" face="Courier" size="2">gotoBank<span lang="en-us">.<br>
&nbsp;&nbsp; </span></font><font size="2" face="Arial"><span lang="en-us">&nbsp;</span>Но<span lang="en-us">
</span>для начала нам не помешает таблица счетов, в которой будет содержать 
информация по валютным и обычным счетам игровых персонажей<span lang="en-us">.</span> 
Вот эта таблица:</font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table14">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#008080">/* Таблица банковских счетов */<br>
		</font>CREATE TABLE `accounts`(<br>
		`ACC_ID` BIGINT(20) unsigned NOT NULL auto_increment,
		<font color="#008080">/* ID - номер счета*/</font><br>
		`USER_ID` bigint(20) unsigned NOT NULL,<font color="#008080"> /* ID 
		игрока */</font><br>
		`ACC_Pass` CHAR(32), <font color="#008080">/* пароль ко счету */</font><br>
		`DateOpen` TIMESTAMP NOT NULL, <font color="#008080">/* дата открытия 
		счета */</font><br>
		`Money_KR` INT NOT NULL default 0, <font color="#008080">/* 
		внутриигровые деньги */</font><br>
		`Money_EKR` INT NOT NULL default 0, <font color="#008080">/* 
		внутриигровая валюта - для покупок в валютном магазине */</font><br>
		`Notes` BLOB, <font color="#008080">/* Записи */</font><br>
		PRIMARY KEY (`ACC_ID`)<br>
		) TYPE=MyISAM;</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">&nbsp;&nbsp;&nbsp; Вы можете в 
качестве домашнего задания сделать сразу открытие нового счета для персонажа, 
регистрирующегося в игре<span lang="en-us">,</span> а мы пока что просто добавим 
два счета для<span lang="en-us"> </span>игроков <span lang="en-us">Defender (user_id=2)
</span>и <span lang="en-us">Stranger (user_id=3)</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table15">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">INSERT INTO accounts 
		(ACC_ID,USER_ID,ACC_Pass,DateOpen,Money_KR,Money_EKR) values (<font color="#000080">10023</font>,2,'1234','2008-0<span lang="en-us">8</span>-29 
		10:00',50,100);<br>
		INSERT INTO accounts (ACC_ID,USER_ID,ACC_Pass,DateOpen,Money_KR,Money_EKR) 
		values (<font color="#000080">10024</font>,3,'1234','2008-0<span lang="en-us">8</span>-29 
		10:00',100,20);</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="en-us">&nbsp;&nbsp;
</span><span lang="ru">Давайте, по умолчанию сделаем режим входа в режим 
управления счетом для игрока при первом входу в банк. Реализуем это таким 
образом:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table16">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2"><b>&lt;?php</b><br>
		<font color="#0000FF">if</font>($lBankMode == 0){<br>
		<b>?&gt;</b><br>
		<br>
		Мы предоставляем следующие услуги:<br>
		&lt;OL&gt;<br>
		&lt;LI&gt;Открытие счета&lt;LI&gt;Возможность положить/снять кредиты/еврокредиты со 
		счета<br>
		&lt;LI&gt;Перевести кредиты/еврокредиты с одного счета на другой<br>
		&lt;LI&gt;Обменный пункт. Обмен еврокредитов на кредиты<br>
		&lt;/OL&gt;<br>
		&lt;FORM action=&quot;bank.phtml?newacc=1&quot; name=accnew method=POST&quot;&gt;<br>
		Хотите открыть свой счет? Услуга платная: 3.00 кр.&lt;/B&gt; &lt;INPUT 
		TYPE=button value=&quot;Открыть счет&quot; name=open onClick=&quot;OpenAcc()&quot;&gt;<br>
		&lt;INPUT TYPE=hidden value=&quot;<b>&lt;?php</b> echo $aNickName; <b>?&gt;</b>&quot; name=NickName&gt;&lt;/td&gt;<br>
		&lt;INPUT TYPE=hidden value=&quot;&quot; name=newacc&gt;&lt;/td&gt;<br>
		&lt;/FORM&gt;<br>
		<br>
		&lt;TABLE&gt;&lt;TR&gt;&lt;FORM action=&quot;bank.phtml&quot; name=accopen method=POST onSubmit=&quot;feedbackAccOpen()&quot;&gt;&lt;TD&gt;<br>
		&lt;FIELDSET&gt;&lt;LEGEND&gt;&lt;B&gt;Управление счетом&lt;/B&gt; &lt;/LEGEND&gt;<br>
		&lt;TABLE&gt;<br>
		&lt;TR&gt;&lt;TD valign=top&gt;<br>
		&lt;TABLE&gt;<br>
		&lt;TR&gt;&lt;TD&gt;Номер счета&lt;/td&gt; &lt;TD colspan=2&gt;&lt;<font color="#000080">select</font> 
		name=&quot;num&quot; size=0 style=&quot;width: 90px&quot;&gt;<br>
		<br>
		<b>&lt;?php</b><br>
		<font color="#008080">// Узнаем какие счета открыты у игрока</font><br>
		$query = <font color="#008000">&quot;SELECT ACC_ID from accounts WHERE 
		USER_ID='$aUserID'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<font color="#0000FF">while</font> ($aRow = <font color="#0000FF">
		mysql_fetch_array</font>($result)) {<br>
		<font color="#0000FF">print</font>('&lt;option value=&quot;'.$aRow[&quot;ACC_ID&quot;].'&quot;&gt;'.$aRow[&quot;ACC_ID&quot;].'&lt;/option&gt;');<br>
		}<br>
		<b>?&gt;<br>
		</b>&lt;/<font color="#000080">select</font>&gt;&lt;/td&gt;&lt;/tr&gt;<br>
		&lt;TR&gt;&lt;TD&gt;Пароль&lt;/td&gt;&lt;td&gt; &lt;INPUT style='width:90;' type=password value=&quot;&quot; 
		name=psw&gt;&lt;/td&gt;&lt;TD style='padding: 0, 0, 3, 5'&gt;&lt;/TD&gt;&lt;/tr&gt;<br>
		&lt;TR&gt;&lt;TD colspan=3 align=center&gt;&lt;INPUT TYPE=button value=&quot;Войти&quot; 
		name=enter onClick=&quot;<font color="#000080">feedbackAccOpen</font>()&quot;&gt;&lt;/td&gt;<br>
		&lt;INPUT TYPE=hidden value=&quot;<b>&lt;?php</b> <font color="#0000FF">echo</font> 
		$aNickName; <b>?&gt;</b>&quot; name=NickName&gt;&lt;/td&gt;<br>
		&lt;/tr&gt;<br>
		&lt;/TABLE&gt;<br>
		&lt;/TD&gt;<br>
		&lt;TD&gt;&lt;/TD&gt;&lt;/TR&gt;<br>
		&lt;/TABLE&gt;<br>
		&lt;/FIELDSET&gt;<br>
		&lt;/TD&gt;&lt;/TR&gt;&lt;/TABLE&gt;<br>
		&lt;br&gt;&lt;br&gt;<br>
		&lt;/FORM&gt;</font></td>
	</tr>
</table>
<p align="justify"><span lang="ru">&nbsp;&nbsp; <font size="2" face="Arial">
Итак, вышеприведенный фрагмент содержит в себе две </font></span>
<font size="2" face="Arial">HTML <span lang="ru">формы</span>. <span lang="ru">
Первая (</span></font><font face="Courier" size="2">name=accnew</font><font size="2" face="Arial"><span lang="ru">) 
будет позволять открыть для игрока новый счет, вторая (</span></font><font face="Courier" size="2">name=accopen</font><font size="2" face="Arial"><span lang="ru">) 
даст возможность войти в существующий у пользователя счет, выбрав его из списка 
имеющихся и введя пароль. Список имеющихся у пользователя счетов мы создаем 
динамически на </span>PHP, <span lang="ru">делая запрос к таблице </span><b>
accounts</b>.<br>
&nbsp; <span lang="ru">Внешне наша страница выглядит так:</span></font></p>
<p align="justify"><font size="2" face="Arial"><span lang="ru">
<img border="0" src="bank_start.jpg" width="523" height="321"><br>
<br>
&nbsp;&nbsp; При нажатии на кнопку &quot;Открыть счет&quot; игрок заставляет выполниться
</span><i>JavaScript</i> <span lang="ru">функцию</span> </font>
<font face="Courier" size="2">OpenAcc</font><font size="2" face="Arial">,<span lang="en-us">
</span><span lang="ru">код которой выглядит следующим образом:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table17">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2"><b>function</b>
		<font color="#000080">OpenAcc</font>(){<br>
		if( confirm('Хотите открыть счет за 3 кр ?') ){<br>
		document.getElementById('newacc').value = 1;<br>
		document.accnew.submit();<br>
		}<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru">&nbsp;&nbsp; 
Функция устанавливает скрытый (</span></font><font face="Courier" size="2">TYPE=hidden</font><font size="2" face="Arial"><span lang="ru">) 
элемент формы в единицу и выполняет операцию </span>submit <span lang="ru">
формы. На стороне скрипта в файле </span>bank.phtml <span lang="ru">происходит 
следующее:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table18">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#008080">// Открываем новый счет<br>
		</font><font color="#0000FF">if</font> ( !<font color="#0000FF">empty</font>($<font color="#0000FF">_GET</font>['newacc']) 
		){<br>
		$query = <font color="#008000">&quot;INSERT INTO 
		accounts(USER_ID,ACC_Pass,DateOpen) values ($aUserID,'1111',Now())&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		$aNewAcc = <font color="#0000FF">mysql_insert_id</font>();<br>
		<font color="#0000FF">printf</font> (&quot;&lt;font color=red&gt;Вы удачно открыли 
		новый счет %d\n. Новому счету назначен временный пароль 1111. &lt;/font&gt;&quot;, 
		$aNewAcc);<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru">&nbsp;&nbsp;&nbsp; 
Если параметр </span></font><font face="Courier" size="2"><font color="#000080">
newacc</font><span lang="ru"> </span></font><font size="2" face="Arial">
<span lang="ru">установлен, значит игрок инициировал открытие счета и мы создаем 
ему счет с очередным порядковым номером и паролем 1111, который он может 
поменять (это мы сделаем чуть позже)</span><span lang="en-us"><br>
</span><span lang="ru">
&nbsp;&nbsp;&nbsp; Давайте сделаем вход в режим управления счетом, при вводе 
пароля к уже имеющемуся счету.&nbsp; Давайте зайдем, к примеру игроком  
</span>Defender<span lang="ru">
у которого открыт счет 10023 с паролем 1234. При нажатии кнопки &quot;Войти&quot; 
срабатывает функция  
</span></font><font color="#000080" face="Courier" size="2">feedbackAccOpen</font><font size="2" face="Arial"><span lang="ru">, 
которая на  
</span><i>JavaScript</i> <span lang="ru">
выглядит так</span>:</font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table19">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2"><b>function</b>
		<font color="#000080">feedbackAccOpen</font>(){<br>
		if (document.accopen.psw.value==&quot;&quot;) {<br>
		alert(&quot;Вы не ввели пароль ко счету!&quot;);<br>
		document.accopen.psw.focus();<br>
		return false;<br>
		}<br>
		document.accopen.submit();<br>
		}</font></td>
	</tr>
</table>
<p><font face="Arial"><span lang="ru"><font size="2">&nbsp;&nbsp;&nbsp; При 
входе в режим отображения информации по счету, мы принимаем данные о номере 
счета и пароле к нему методом </span>POST <span lang="ru">следующим образом:</span></font></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table20">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#008080">// Пытаемся войти с паролем в счет<br>
		</font><font color="#0000FF">if</font> (!<font color="#0000FF">empty</font>($<font color="#0000FF">_POST</font>['num']) 
		&amp;&amp; !<font color="#0000FF">empty</font>($<font color="#0000FF">_POST</font>['psw'])){<br>
		$aAccNum = $<font color="#0000FF">_POST</font>['num'];<br>
		$aPsw = $<font color="#0000FF">_POST</font>['psw'];<br>
		<font color="#000080">checkAccInfo</font>();<br>
		}</font></td>
	</tr>
</table>
<p><font face="Arial"><span lang="ru"><font size="2">&nbsp;&nbsp; Функция </font>
</span></font><font color="#000080" face="Courier" size="2">checkAccInfo<span lang="ru">
</span></font><span lang="ru"><font face="Arial" size="2">считывает данные о 
счете игрока, если был введен правильный пароль:</font></span></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table21">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#0000FF">function</font> <font color="#000080">checkAccInfo</font>( 
		){<br>
		global $aAccMoneyKR, $aAccMoneyEKR, $lBankMode, $aUserID, $aPsw, $aAccNum, 
		$aNotes;<br>
		<font color="#008080">// найдем, есть ли такой счет с паролем у этого 
		персонажа<br>
		</font>$query = <font color="#008000">&quot;select 
		ACC_ID,Money_KR,Money_EKR,Notes from accounts where USER_ID='$aUserID' 
		and ACC_Pass='$aPsw' and ACC_ID='$aAccNum'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<font color="#0000FF">if</font>( <font color="#0000FF">mysql_num_rows</font>($result) 
		&lt;&gt; 0 ){<br>
		$aRow = <font color="#0000FF">mysql_fetch_array</font>($result);<br>
		$aAccMoneyKR = $aRow[&quot;Money_KR&quot;];<br>
		$aAccMoneyEKR = $aRow[&quot;Money_EKR&quot;];<br>
		$aNotes = $aRow[&quot;Notes&quot;];<br>
		$lBankMode = 1;<br>
		} <font color="#0000FF">else</font> {<br>
		<font color="#0000FF">print</font>(&quot;&lt;font size=2 color=red&gt;Вы ввели 
		неверный пароль к счету $aAccNum !&lt;/font&gt;&quot;);<br>
		}<br>
		}</font></td>
	</tr>
</table>
<p><font size="2" face="Arial"><span lang="ru">
&nbsp;&nbsp; В браузере пользователь увидит следующую картинку:<br>
<br>
<img border="0" src="bank_all_sm.jpg" width="550" height="333"><br>
<br>
</span>&nbsp; <span lang="ru">
Чтоб увидеть эту картинку в полном масштабе, нажмите <a href="bank_all.jpg">
здесь</a>.&nbsp;&nbsp;
&nbsp;  
</span></font></p>
<p align="justify"><font size="2" face="Arial"><a name="kopv4"><font color="#000080"><span lang="ru"><b>1</b></span><b>4</b></font></a><b><span lang="ru"><font face="Arial" color="#000080"><a name="kopv4"><font size="2">.4.</font></a></font></span></b><font color="#000080"><b>
<span lang="ru">Банковские услуги обмена<a name="kopv4"> </a>
</span> </b></font><span lang="ru">&nbsp;<br>
<br>
&nbsp;&nbsp; Как Вы могли заметить, находясь в режиме управления счетом, игрок 
может проводить несколько основных денежных операций:<br>
1. Пополнить кредитный счет - это операция нужна для перевода наличных денег на 
собственный счет в банке (обычно это нужно для дальнейшего перевода денег на 
счет другого игрока)<br>
2. Снять с кредитного счета - эта операция заключается в переводе денег со счета 
на наличные деньги игрока в обычной игровой валюте.<br>
3. Пополнить евро-кредитный счет - это операция нужна для перевода наличных 
денег в екр на собственный счет в банке.<br>
4. Снять с евро-кредитного счета - эта операция заключается в переводе екр со 
счета на наличные екр-деньги игрока (обычно для нанесения визита в валютный 
магазин за ЕВРО-вещами и артефактами).<br>
<br>
&nbsp;&nbsp;&nbsp; Информация по текущим остаткам выводится в верхней части 
экрана управления счетом:<br>
<br>
<img border="0" src="acc_info.jpg" width="508" height="175"><br>
&nbsp;<br>
&nbsp;&nbsp; 
Рассмотрим пополнение кредитного счета:<br>
<br>
<img border="0" src="add_kr_acc.jpg" width="423" height="58"><br>
<br>
&nbsp;&nbsp; Описание на </span><span lang="en-us">HTML </span><span lang="ru">
выглядит так:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table22">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		&lt;TD valign=top width=50%&gt;&lt;FIELDSET&gt;&lt;LEGEND&gt;&lt;B&gt;Пополнить кредитный счет&lt;/B&gt; 
		&lt;/LEGEND&gt;<br>
		Сумма &lt;INPUT TYPE=text NAME=add_sum size=6 maxlength=10&gt; кр. &lt;INPUT TYPE=button 
		name=add_kredit value=&quot;<font color="#008000">Положить кредиты на счет</font>&quot; 
		onclick=&quot;<font color="#000080">f_add_kred()</font>&quot;&gt;&lt;BR&gt;</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru">&nbsp;&nbsp; При вводе необходимой 
суммы и нажатии на кнопку &quot;Положить кредиты на счет&quot; срабатывает </span>
<span lang="en-us"><i>JavaScript</i> </span><span lang="ru">функция </span></font>
<font color="#000080" face="Courier" size="2">f_add_kred</font><font size="2" face="Arial">, 
описание которой смотрите ниже:</font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table23">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		function f_add_kred(){<br>
		if (isNaN(parseFloat(document.bankactions.add_sum.value))) {<br>
		alert('Укажите сумму');<br>
		return false;<br>
		} else {<br>
		if( confirm('Вы хотите положить на свой счет '+parseFloat(document.bankactions.add_sum.value)+' 
		кр. ?') ){<br>
		document.getElementById('operation').value = 1;<br>
		document.bankactions.submit();<br>
		}<br>
		}<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial">&nbsp;&nbsp; Функция проверяет 
корректность ввода суммы и устанавливает скрытое поле <span lang="en-us">
<font color="#000080">operation</font> </span>в единицу. Затем происходит 
операция <span lang="en-us">submit </span>формы </font>
<font face="Courier" size="2">
		bankactions</font><font size="2" face="Arial">.<br>
&nbsp;&nbsp;&nbsp; На стороне скрипта, для пополнения нашего счета в обычной 
валюте мы делаем следующее:</font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table24">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#0000FF">if</font> ( !<font color="#0000FF">empty</font>($<font color="#0000FF">_POST</font>['operation']) 
		){<br>
		$aOperation = $<font color="#0000FF">_POST</font>['operation'];<br>
		<font color="#008080">// положить наличные на кр счет<br>
		</font><font color="#0000FF">if</font> ($aOperation==1) {<br>
		$aSumm = $<font color="#0000FF">_POST</font>['add_sum'];<br>
		<font color="#0000FF">if</font> ($aSumm &lt;= $aMoney){<br>
		<font color="#008080">// Уменьшим наличные деньги<br>
		</font>$query = <font color="#008080">&quot;UPDATE users SET Character_Money=Character_Money-'$aSumm' 
		WHERE Nick_Name='$aNickName'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		// Пополним банковский счет кредитов<br>
		$query = <font color="#008080">&quot;UPDATE accounts SET Money_KR=Money_KR+'$aSumm' 
		WHERE ACC_ID='$aAccNum' and USER_ID='$aUserID'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<font color="#000080">getPlayerInfo</font>();<br>
		<font color="#000080">checkAccInfo</font>();<br>
		} <font color="#0000FF">else</font> {<br>
		<font color="#0000FF">print</font>(&quot;&lt;font size=2 color=red&gt;У вас 
		недостаточно наличных денег!&lt;/font&gt;&quot;);<br>
		}<br>
		}</font></td>
	</tr>
</table>
<p><font face="Arial" size="2">&nbsp; Тут все очень просто! Отнимаем от нашей 
суммы наличных денег из таблицы <span lang="en-us"><b>users</b> </span>и кладем 
на счет<span lang="en-us"> </span>в таблице <b><span lang="en-us">accounts</span></b>.<span lang="en-us">
</span>Видим как изменяется суммы на нашем счету и в кошельке:<br>
<br>
<img border="0" src="new_summ.jpg" width="487" height="160"></font></p>
<p align="justify"><font size="2" face="Arial">&nbsp;&nbsp; Операция по снятию 
некоторой суммы денег со счета выполняется в обратном порядке:<br>
<br>
<img border="0" src="back.jpg" width="422" height="62"></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table25">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#008080">// снять наличные с кр счета</font><br>
		<font color="#0000FF">if</font> ($aOperation==2) {<br>
		$aSumm = $<font color="#0000FF">_POST</font>['get_sum'];<br>
		<font color="#0000FF">if</font> ($aSumm &lt;= $aAccMoneyKR){<br>
		<font color="#008080">// Увеличим наличные деньги</font><br>
		$query = <font color="#008000">&quot;UPDATE users SET Character_Money=Character_Money+'$aSumm' 
		WHERE Nick_Name='$aNickName'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<font color="#008080">// Уменьшим банковский счет кредитов</font><br>
		$query = <font color="#008000">&quot;UPDATE accounts SET Money_KR=Money_KR-'$aSumm' 
		WHERE ACC_ID='$aAccNum' and USER_ID='$aUserID'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<font color="#000080">getPlayerInfo</font>();<br>
		<font color="#000080">checkAccInfo</font>();<br>
		} <font color="#0000FF">else</font> {<br>
		<font color="#0000FF">print</font>(&quot;&lt;font size=2 color=red&gt;У Вас 
		недостаточно денег на кредитном счете!&lt;/font&gt;&quot;);<br>
		}<br>
		}</font></td>
	</tr>
</table>
<p><font face="Arial" size="2">&nbsp; Если сумма снятия не превышает суммы 
обычных денег на счету игрока, то мы добавляем ее к наличным деньгам и 
соответственно уменьшаем количество денег на счете.</font></p>
<p align="justify"><font size="2" face="Arial">&nbsp; Для екр счетов все тоже 
самое:<br>
&nbsp; Пополнение<br>
<img border="0" src="ekr1.jpg" width="423" height="55"><br>
<br>
&nbsp; и снятие:<br>
<br>
<img border="0" src="ekr2.jpg" width="451" height="57"><br>
<br>
<a name="kopv6"><font color="#000080"><span lang="ru"><b>1</b></span><b>4</b></font></a><b><span lang="ru"><font face="Arial" color="#000080"><a name="kopv6"><font size="2">.5. 
</font></a></font></span></b><span lang="ru"><b>
<font size="2" face="Arial" color="#000080"><a name="kopv6">Другие  
услуги</a> банка<a name="kopv7">.</a></font></b>
<br>
<br>
&nbsp;&nbsp; Иногда возникает необходимость помочь какому-то игроку материально 
и поэтому в режиму управления счетом есть необходимость перевести денежные 
средства на счет другого персонажа. Впрочем также можно и перемещать деньги 
между разными счетами одного и того же игрока.<br> </span>&nbsp;&nbsp;&nbsp; <span lang="ru">
Следующий интерфейс режима управления счетом, как раз и реализует передачу 
денежных средств на другой счет:<br>
<br>
<img border="0" src="transfer.jpg" width="413" height="91"><br>
&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; На </span>HTML <span lang="ru">эта форма описывается так:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table26">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		&lt;TD valign=top&gt;&lt;FIELDSET&gt;&lt;LEGEND&gt;&lt;B&gt;<font color="#008000">Перевести 
		кредиты на другой счет</font>&lt;/B&gt; &lt;/LEGEND&gt;<br>
		Сумма &lt;INPUT TYPE=text NAME=tansfer_sum size=6 maxlength=10&gt; кр.&lt;BR&gt;<br>
		Номер счета куда перевести кредиты &lt;INPUT TYPE=text NAME=num2 size=12 
		maxlength=15&gt;&lt;BR&gt;<br>
		&lt;INPUT TYPE=button name=transfer_kredit value=&quot;Перевести кредиты на 
		другой счет&quot; onclick=&quot;<font color="#000080">transfer_kr()</font>&quot;&gt;&lt;BR&gt;<br>
		&lt;/FIELDSET&gt;&lt;/TD&gt;</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru">При вводе 
необходимой суммы и номера счета и нажатии на кнопку &quot;Перевести кредиты на 
другой счет&quot; срабатывает </span>
<span lang="en-us"><i>JavaScript</i> </span><span lang="ru">функция 
<font color="#000080">transfer_kr</font></span>, 
описание которой смотрите <span lang="ru">далее</span>:</font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table27">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<b>function</b> <font color="#000080">transfer_kr</font>(){<br>
		if (isNaN(parseFloat(document.bankactions.tansfer_sum.value)) || 
		isNaN(parseInt(document.bankactions.num2.value)) ) {<br>
		alert('Укажите сумму и номер счета'); return false;<br>
		} else {<br>
		if( confirm('Вы хотите перевести со своего счета '+parseFloat(document.bankactions.tansfer_sum.value)+' 
		кр. на счет номер '+parseInt(document.bankactions.num2.value)+' ?') ){<br>
		document.getElementById('operation').value = 5;<br>
		document.bankactions.submit();<br>
		}<br>
		}<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru">&nbsp;&nbsp; В 
нашем </span>PHP <span lang="ru">скрипте </span>bank.phtml <span lang="ru">куда 
передается управление из вышеописанной функции мы делаем осуществляем перевод 
денег:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table28">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#008080">// перевод кредитов на другой счет<br>
		</font><font color="#0000FF">if</font> ($aOperation==5) {<br>
		$aSumm = $<font color="#0000FF">_POST</font>['tansfer_sum'];<br>
		$aNum2 = $<font color="#0000FF">_POST</font>['num2'];<br>
		<br>
		<font color="#008080">// найдем, есть ли такой счет куда переводить 
		кредиты</font><br>
		$query = <font color="#008000">&quot;select ACC_ID,Money_KR,Money_EKR from 
		accounts where ACC_ID='$aNum2'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<font color="#0000FF">if</font>( <font color="#0000FF">mysql_num_rows</font>($result) 
		&lt;&gt; 0 ){<br>
		$aRow = <font color="#0000FF">mysql_fetch_array</font>($result);<br>
		$aAccMoneyKR = $aRow[&quot;Money_KR&quot;];<br>
		$lBankMode = 1;<br>
		<font color="#000080">checkAccInfo</font>();<br>
		<font color="#0000FF">if</font> ($aSumm &lt;= $aAccMoneyKR){<br>
		<font color="#008080">// Уменьшим <span lang="ru">наш </span>банковский 
		счет кредитов</font><br>
		$query = <font color="#008000">&quot;UPDATE accounts SET Money_KR=Money_KR-'$aSumm' 
		WHERE ACC_ID='$aAccNum' and USER_ID='$aUserID'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<font color="#008080">// Добавим на другой </font><br>
		$query = <font color="#008000">&quot;UPDATE accounts SET Money_KR=Money_KR+'$aSumm' 
		WHERE ACC_ID='$aNum2'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<font color="#0000FF">print</font>(&quot;&lt;font size=2 color=red&gt;Вы удачно 
		перевели $aSumm кр на счет $aNum2!&lt;/font&gt;&quot;);<br>
		<font color="#000080">getPlayerInfo</font>();<br>
		<font color="#000080">checkAccInfo</font>();<br>
		} <font color="#0000FF">else</font> {<br>
		<font color="#0000FF">print</font>(&quot;&lt;font size=2 color=red&gt;У Вас 
		недостаточно денег для перевода!&lt;/font&gt;&quot;);<br>
		}<br>
		} <font color="#0000FF">else</font> {<br>
		<font color="#0000FF">print</font>(&quot;&lt;font size=2 color=red&gt;Такой номер 
		счета не найден!&lt;/font&gt;&quot;);<br>
		}<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru">&nbsp;&nbsp; 
Здесь мы определяем, существует ли такой счет, которые мы указали в форме 
перевода денег и наличие у нас необходимой для осуществления перевода средств. 
Затем уменьшаем количество денег на нашем кредитном счете и увеличиваем у того, 
кому переводим денежные средства.<br>
&nbsp;&nbsp;&nbsp; Кроме перевода у нас также еще есть возможность обмена 
введенных в игру еврокредитов на обычные кредиты (екр на&nbsp; кр). Следующий 
интерфейс позволяет сделать этот обмен:<br>
<br>
<img border="0" src="exchange.jpg" width="312" height="83"><br>
<br>
&nbsp;&nbsp; На </span>HTML <span lang="ru">эта форма описывается так:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table29">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		&lt;FIELDSET&gt;&lt;LEGEND&gt;&lt;B&gt;<font color="#008000">Обменный пункт</font>&lt;/B&gt; 
		&lt;/LEGEND&gt;<br>
		Обменять еврокредиты на кредиты.&lt;BR&gt;<br>
		Курс &lt;B&gt;1 екр.&lt;/B&gt; = &lt;B&gt;20.00 кр.&lt;/B&gt;&lt;BR&gt;<br>
		Сумма &lt;INPUT TYPE=text NAME=convert_sum size=6 maxlength=10&gt; екр.<br>
		&lt;INPUT TYPE=button name=convert_ekredit value=&quot;Обменять&quot; onclick=&quot;<font color="#000080">exChange</font>()&quot;&gt;<br>
		&lt;/FIELDSET&gt;</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru">&nbsp;&nbsp;&nbsp; 
После ввода нужной суммы и нажатия кнопки</span> <span lang="ru">&quot;Обменять&quot; 
функция </span></font><font color="#000080" face="Courier" size="2">exChange</font><font size="2" face="Arial"><span lang="ru">, 
передает необходимые параметры в скрипт </span>bank.html <span lang="ru">и там 
выполняются действия по обмену денежных средств, с помощью следующего </span>PHP
<span lang="ru">кода:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table30">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#008080">// обмен <span lang="ru">евро</span>кредитов на 
		кредиты<br>
		</font><font color="#0000FF">if</font> ($aOperation==6) {<br>
		$aSumm = $<font color="#0000FF">_POST</font>['convert_sum'];<br>
		<font color="#0000FF">if</font> ($aSumm &lt;= $aAccMoneyEKR){<br>
		<font color="#008080">// Изменим суммы на кредитном и еврокредитном 
		счете</font><br>
		$query = <font color="#008000">&quot;UPDATE accounts SET Money_EKR=Money_EKR-'$aSumm', 
		Money_KR=Money_KR+('$aSumm'*20) WHERE ACC_ID='$aAccNum' and USER_ID='$aUserID'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<font color="#0000FF">print</font>(&quot;&lt;font size=2 color=red&gt;Вы удачно 
		обменяли $aSumm екр на &quot;.($aSumm*20).&quot; кр!&lt;/font&gt;&quot;);<br>
		<font color="#000080">getPlayerInfo</font>();<br>
		<font color="#000080">checkAccInfo</font>();<br>
		} <font color="#0000FF">else</font> {<br>
		<font color="#0000FF">print</font>(&quot;&lt;font size=2 color=red&gt;У Вас 
		недостаточно денег на &amp;euro; кредитном счете!&lt;/font&gt;&quot;);<br>
		}<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru">&nbsp;&nbsp; 
Здесь мы определяем доступность еврокредитных средств на счете и после этого 
уменьшаем кол-во екр на счете, на выбранную при обмене сумму и соответственно 
увеличиваем кредитную часть счета в соответствии с курсом обмена.<br>
<br>
&nbsp;&nbsp;&nbsp; Для надежности, мы может также предложить игрокам 
периодически сменять пароль к своим банковским счетам. Создадим следующий 
простой интерфейс для смены пароля к счету:<br>
<br>
<img border="0" src="chp.jpg" width="410" height="121"><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; На </span>HTML <span lang="ru">эта форма 
описывается так:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table31">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		&lt;FIELDSET&gt;&lt;LEGEND&gt;&lt;B&gt;Настройки&lt;/B&gt; &lt;/LEGEND&gt;<br>
		&lt;B&gt;<font color="#008000">Сменить пароль</font>&lt;/B&gt;&lt;BR&gt;<br>
		&lt;table id=&quot;table1&quot;&gt;<br>
		&lt;tr&gt;&lt;TD&gt;Новый пароль&lt;/TD&gt;&lt;TD&gt;&lt;INPUT TYPE=password name=new_psw&gt;&lt;/TD&gt;&lt;TD&gt;&lt;/TD&gt;&lt;/tr&gt;<br>
		&lt;tr&gt;&lt;TD&gt;Введите новый пароль повторно&lt;/TD&gt;&lt;TD&gt;&lt;INPUT TYPE=password 
		name=new_psw2&gt;&lt;/TD&gt;&lt;TD&gt;&lt;/TD&gt;&lt;/tr&gt;<br>
		&lt;/table&gt;<br>
		&lt;INPUT TYPE=button name=change_psw value=&quot;Сменить пароль&quot; onClick=&quot;<font color="#000080">ChangePass</font>()&quot;&gt;&lt;BR&gt;<br>
		<br>
		&lt;/FIELDSET&gt;</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru">&nbsp;&nbsp; При 
вводе нового пароля два раза инажатии на кнопку &quot;Сменить пароль&quot; срабатывает </span>
<span lang="en-us"><i>JavaScript</i> </span><span lang="ru">функция </span></font>
<font color="#000080" face="Courier" size="2">ChangePass</font><font size="2" face="Arial">, 
описание которой смотрите ниже:</font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table32">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<b>function</b> <font color="#000080">ChangePass</font>(){<br>
		if ( document.bankactions.new_psw.value == &quot;&quot; || 
		document.bankactions.new_psw2.value == &quot;&quot; ) {<br>
		alert('Введите дважды новый пароль для счета!'); return false;<br>
		} else {<br>
		if ( document.bankactions.new_psw.value == 
		document.bankactions.new_psw2.value ) {<br>
		if( confirm('Вы действительно хотите сменить пароль для счета?') ){<br>
		document.getElementById('operation').value = 7;<br>
		document.bankactions.submit();<br>
		}<br>
		}<br>
		}<br>
		}</font></td>
	</tr>
</table>
<p><font face="Arial" size="2"><span lang="ru">&nbsp; Функция проверяет 
заполнение обоих полей и идентичность введения обоих паролей и выполняет </span>
submit <span lang="ru">формы, перед этим установив флаг </span></font>
<font face="Courier" size="2">
		<font color="#000080">operation</font><span lang="ru"> </span></font>
<font face="Arial" size="2"><span lang="ru">в значение 7. На стороне скрипта мы 
выполняем следующие простые действия:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table33">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#008080">// Смена пароля<br>
		</font><font color="#0000FF">if</font> ($aOperation==7) {<br>
		$aNewPsw = $<font color="#0000FF">_POST</font>['new_psw'];<br>
		<font color="#008080">// Изменим <span lang="ru">пароль к счету</span></font><br>
		$query = <font color="#008000">&quot;UPDATE accounts SET ACC_Pass = '$aNewPsw' 
		WHERE ACC_ID='$aAccNum' and USER_ID='$aUserID'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<font color="#0000FF">print</font>(&quot;&lt;font size=2 color=red&gt;Пароль удачно 
		сменен! (запомните его: $aNewPsw )&lt;/font&gt;&quot;);<br>
		}</font></td>
	</tr>
</table>
<p><font face="Arial" size="2"><span lang="ru">&nbsp;&nbsp; И последнее - 
добавим записную книжку, чтоб игрок записывал необходимые действия со счетом 
(кому что перечислил, когда произвел какие обменные операции и т.д.) Это будет 
обычное поле </span>TEXTAREA.<span lang="ru"><br>
<br>
<img border="0" src="notepad.jpg" width="572" height="242"></span></font></p>
<p align="justify"><font size="2" face="Arial">&nbsp;&nbsp; <span lang="ru">При 
нажатии на кнопку &quot;Сохранить изменения&quot; на стороне скрипта выполняется такой 
код:</span></font></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0" id="table34">
	<tr>
		<td bgcolor="#FFFFCC"><font face="Courier" size="2">
		<font color="#008080">// Сохранение записной книжки<br>
		</font>if ($aOperation==8) {<br>
		$aNotes = $<font color="#0000FF">_POST</font>['notepad'];<br>
		<font color="#008080">// Изменим данные в записной книжке</font><br>
		$query = <font color="#008000">&quot;UPDATE accounts SET Notes = '$aNotes' 
		WHERE ACC_ID='$aAccNum' and USER_ID='$aUserID'&quot;</font>;<br>
		$result = <font color="#0000FF">mysql_query</font>($query) or
		<font color="#0000FF">die</font>(&quot;Query failed : &quot; .
		<font color="#0000FF">mysql_error</font>());<br>
		<font color="#0000FF">print</font>(&quot;&lt;font size=2 color=red&gt;Запись 
		сохранена! &lt;/font&gt;&quot;);<br>
		}</font></td>
	</tr>
</table>
<p align="justify"><font size="2" face="Arial"><span lang="ru">Поле </span></font>
<font color="#008000" face="Courier" size="2">Notes<span lang="ru"> </span>
</font><font size="2" face="Arial"><span lang="ru">в таблице </span>accounts
<span lang="ru">у нас</span> <span lang="ru">является типом BLOB, так что 
пользователь может ввести достаточно много текстовой информации.<br>
<br>
Полный текст файла&nbsp; </span>bank.phtml <span lang="ru">вы можете найти
<a href="14_5/bank.phtml">здесь</a>.<br>
<br>
<br>
<b>В следующем завершающем уроке</b> мы познакомимся со стражами порядка в 
бойцовском клубе - паладинами и их возможными действиями в отношении других 
игроков, нарушающими законы клуба </span>Might and Magic.</font></p>
<font size="2" face="Arial">
        <p align="left">&nbsp;</font></td>
      <td width="27" height="356" background="Site/middle2.jpg">&nbsp;</td>
    </tr>
    <tr>
      <td width="740" height="38" background="Site/bottom.jpg" colspan="3">&nbsp;</td>
    </tr>
  </table>
  </center>
</div>

</body>

</html>