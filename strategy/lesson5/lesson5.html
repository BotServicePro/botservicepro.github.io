<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
  
  <meta http-equiv="Content-Language" content="ru">
  
  <title>Центр обучения созданию компьютерных игр</title>
  <meta name="description" content="Blitz-School - Школа создателей компьютерных игр на языке Blitz3D. Если вы хотите быстро научиться делать компьютерные игры или интересуетесь их созданием, то этот сайт будет вам полезен">
  <meta name="keywords" content="программирование, создание игр, курсы создания игр, школа создателей компьютерных игр, blitzbasic, компьютерные игры, как написать игру, как создать игру, программирование компьютерных игр, Blitz3D, программирование игр, разработка игр, создание 3d игр, аудио, графика, дизайн, 3D">
  <link rel="stylesheet" type="text/css" href="main.css">
  <script language="JavaScript" src="index_files/script.js" type="text/javascript"></script>
  <script type="text/javascript" src="scripts/shCore.js"></script>
  <script type="text/javascript" src="scripts/shBrushBash.js"></script>
  <script type="text/javascript" src="scripts/shBrushCpp.js"></script>
  <script type="text/javascript" src="scripts/shBrushCSharp.js"></script>
  <script type="text/javascript" src="scripts/shBrushCss.js"></script>
  <script type="text/javascript" src="scripts/shBrushDelphi.js"></script>
  <script type="text/javascript" src="scripts/shBrushDiff.js"></script>
  <script type="text/javascript" src="scripts/shBrushGroovy.js"></script>
  <script type="text/javascript" src="scripts/shBrushJava.js"></script>
  <script type="text/javascript" src="scripts/shBrushJScript.js"></script>
  <script type="text/javascript" src="scripts/shBrushPhp.js"></script>
  <script type="text/javascript" src="scripts/shBrushPlain.js"></script>
  <script type="text/javascript" src="scripts/shBrushPython.js"></script>
  <script type="text/javascript" src="scripts/shBrushRuby.js"></script>
  <script type="text/javascript" src="scripts/shBrushScala.js"></script>
  <script type="text/javascript" src="scripts/shBrushSql.js"></script>
  <script type="text/javascript" src="scripts/shBrushVb.js"></script>
  <script type="text/javascript" src="scripts/shBrushXml.js"></script>
  <script type="text/javascript" src="scripts/shBrushBlitz3D.js"></script>
  <link type="text/css" rel="stylesheet" href="styles/shCore.css">
  <link type="text/css" rel="stylesheet" href="styles/shThemeDefault.css">
  <script type="text/javascript">
SyntaxHighlighter.config.clipboardSwf = 'scripts/clipboard.swf';
SyntaxHighlighter.all();
  </script>
  <meta content="MSHTML 6.00.6000.20772" name="GENERATOR"></head>

<body topmargin="0" leftmargin="0" style="BACKGROUND-COLOR: rgb(255,255,255)" marginheight  ="0" marginwidth="0">
<table cellpadding="0" cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td rowspan="2" height="197" width="21"><img height="197" src="index_files/ltoptable.png" width="21" border="0"></td>
      <td colspan="5" valign="top">
      <table cellpadding="0" cellspacing="0" width="100%">
        <tbody>
          <tr>
            <td height="49" width="231"><img height="49" src="index_files/topmenu.png" width="231" usemap="#ImageMap1" border="0"></td>
            <td background="index_files/mtop.gif"><map name="ImageMap1"><area onclick="this.style.behavior='url(#default#homepage)';this.setHomePage('http://www.blitz-school.info'); return false;" shape="RECT" coords="17,26,71,40" href="index.phtml"><area shape="RECT" coords="91,27,149,39" href="javascript:window.external.AddFavorite('http://www.blitz-school.info', 'GameSchool - Центр обучения созданию компьютерных игр!')"></map>
            <div class="searchform" align="right">
            <form method="post"><input value="search" name="do" type="hidden">&nbsp;</form>
            </div>
            </td>
            <td height="49" width="13"><img height="49" src="index_files/mlefttop.png" width="13" border="0"></td>
          </tr>
        </tbody>
      </table>
      </td>
    </tr>
    <tr>
      <td height="148" valign="top" width="225">
      <table cellpadding="0" cellspacing="0" height="148" width="100%">
        <tbody>
          <tr>
            <td height="119" width="225"><a title="Центр обучения созданию компьютерных игр" href="index.phtml"><img height="119" src="index_files/title.png" width="225" border="0"></a></td>
          </tr>
          <tr>
            <td background="index_files/date_b.png" valign="bottom">
            <div class="date" style="FONT-SIZE: 11px; MARGIN-BOTTOM: 10px; MARGIN-LEFT: 12px">
            <script language="JavaScript1.2">
<!-- Begin
var months=new Array(13);
months[1]="января";
months[2]="февраля";
months[3]="марта";
months[4]="апреля";
months[5]="мая";
months[6]="июня";
months[7]="июля";
months[8]="августа";
months[9]="сентября";
months[10]="октября";
months[11]="ноября";
months[12]="декабря";
var time=new Date();
var lmonth=months[time.getMonth() + 1];
var date=time.getDate();
var year=time.getYear();
var hours=time.getHours();
var minutes=time.getMinutes();
if (eval(hours) <10) {hours="0"+hours}
if (eval(minutes) < 10) {minutes="0"+minutes}
if (year < 2000)
year = year + 1900;
document.write("Сейчас: " + date + " ");
document.write(lmonth + " " + year + ", " + hours + ":" + minutes + " ");

// End -->

           </script>
            </div>
            </td>
          </tr>
        </tbody>
      </table>
      </td>
      <td width="296"><img height="148" src="index_files/mainleft.jpg" width="296" border="0"></td>
      <td width="205"><img height="148" src="index_files/mainright.jpg" width="205" border="0"></td>
      <td background="index_files/mback.png">&nbsp;</td>
      <td height="148" width="58"><img height="148" src="index_files/mltopr.png" width="58" border="0"></td>
    </tr>
  </tbody>
</table>
<table bordercolordark="black" bordercolorlight="black" cellpadding="0" cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td background="index_files/anek_tb.png" height="27" valign="top" width="254">
      <div class="lefttext"><b>Меню:</b></div>
      </td><?php include 'menu_top.php'; ?> <td background="index_files/nav_back.gif">&nbsp;</td>
      <td width="17"><img height="27" src="index_files/nav_end.png" width="17" border="0"></td>
    </tr>
  </tbody>
</table>
<table cellpadding="0" cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td background="index_files/lefttable.gif" valign="top" width="254"><!-- Menu -------->
      <div style="MARGIN-LEFT: 21px">
      <table cellpadding="0" cellspacing="0">
        <tbody>
          <tr>
            <td background="index_files/tb_back.gif">
            <div class="style3"><img src="index_files/home.gif"><a href="http://www.blitz-school.info/index.phtml">Главная</a><br>

        <img src="index_files/pages.gif"> <b>Перечень курсов</b><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/blitzindex.phtml">Создание 3D игр на Blitz3D</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/ogindex.phtml">Создание браузерной РПГ</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/egindex.phtml">Создание экономической браузерки</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/mgindex.phtml">Создание мобильных игр</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/cppindex.phtml">Создание 3D игр на С++</a><br>
        <img src="index_files/group.gif"> <a href="http://www.blitz-school.info/begin_study.phtml">Как стать слушателем</a><br>
        <img src="index_files/recom.gif"> <a href="http://www.blitz-school.info/study_tech.phtml">Технология обучения</a><br>
        <img src="index_files/loyalty_sm.jpg"> <a href="http://www.blitz-school.info/loyalty.phtml">Программа лояльности</a>
        <br>
&nbsp;&nbsp;&nbsp;&nbsp;
    <img border="0" src="index_files/navdiv.gif" width="80" height="4">
        <br><img src="index_files/newuser.gif"> <b>Регистрация</b><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/reg.phtml">Курс 3D игр на Blitz3D</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/reg2.phtml">Курс браузерной RPG</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/reg3.phtml">Экономическая браузерка</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/reg4.phtml">Курс мобильных игр</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/reg5.phtml">3D игры на С++</a><img src="index_files/new.gif"><br>
        <img src="index_files/admin.gif"> <a href="http://www.blitz-school.info/login.phtml">Вход для слушателей</a><br>
        <img src="index_files/study.gif"> <a href="http://www.blitz-school.info/program.phtml">Учебные программы курсов</a><br>
        <img src="index_files/society.gif"> <a href="http://www.blitz-school.info/response.phtml">Отзывы</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;
    <img border="0" src="index_files/navdiv.gif" width="80" height="4">
        
        <br><img src="index_files/media.gif"> <a href="http://www.blitz-school.info/distant.phtml">О дистанционном образовании</a><br>
        <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/articles.phtml">Статьи</a><br>
        <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/less_ex.phtml">Изложение материала</a><br>
        <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/gallery.phtml">Галерея</a><br> 
        <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/links.phtml">Полезные ссылки</a><br>
        <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/contacts.phtml">Контакты</a><br>
       <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/friends.phtml">Обмен ссылками</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;

            </div>
            </td>
          </tr>
          <tr>
            <td width="222"><img height="8" src="index_files/tb_b.gif" width="222" border="0"></td>
          </tr>
        </tbody>
      </table>
      </div><!-- ------------------ end of menu ------------------- --> </td>
      <td class="news" valign="top">
      <script language="javascript" type="text/javascript">
      </script>
      <div style="MARGIN-TOP: 7px">
      <table cellpadding="0" cellspacing="0" width="100%">
        <tbody>
          <tr>
            <td width="13"><img height="24" src="index_files/m_left.gif" width="13" border="0"></td>
            <td class="newstitle" background="index_files/m_center.gif">
            <b>Занятие
<span lang="en-us">5</span></b></td>
            <td class="newstitle" align="right" background="index_files/m_center.gif">&nbsp;</td>
            <td width="9"><img height="24" src="index_files/m_right.gif" width="9" border="0"></td>
          </tr>
        </tbody>
      </table>
      <table cellpadding="0" cellspacing="0" width="100%">
        <tbody>
          <tr>
            <td background="index_files/m_left_m.gif" width="4">&nbsp;</td>
            <td class="newsbody" bgcolor="#fdfdfd">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <font size="3"><b>Поселок ч.1. Ресурсные постройки<br>
			</b></font>
            <br>
            <b><font color="#4775a5"><span lang="en-us">5</span>.1. 
			</font><font color="#4775A5">Таблицы построек поселка </font><br>
            <br>
&nbsp;</b><span lang="en-us">&nbsp;</span>Здравствуйте! Сегодня мы продолжим 
			курс занятий по созданию стратегической браузерной игры и начнем 
			потихоньку застраивать наш поселок необходимыми для его 
			функционирования зданиями. Целью нашей сегодняшней совместной работы 
			будет постройка и улучшение зданий, связанных с хранением добываемых 
			ресурсов. Так, для хранения зерна нам понадобится возвести амбар, а 
			для хранения остальных ресурсов (древесина, руда и глина), мы 
			построим склад. Апгрейд этих двух зданий будут приводить к 
			увеличению их вместимости. То есть, чем выше уровень (левел) здания, 
			тем больше ресурсов оно может хранить. А сейчас давайте создадим 
			справочную таблицу в нашей с Вами базе <b><span lang="en-us">
			travgame</span></b>, которая будет описывать разные типы зданий. Вот 
			эта таблица и назовем мы ее <b>building_types</b>.<br>
<pre class="brush: sql;">/* Справочник зданий поселка */
CREATE TABLE `building_types` (
bt_id bigint(20) unsigned NOT NULL auto_increment, /*ID*/
bt_name char(50), /*название постройки*/ 
bt_image char(50), /*картинка готового здания*/
bt_image_not_ready char(50), /*картинка строящегося здания*/ 
bt_description char(255), /*описание постройки*/
bt_ycoord_dif int, /*коррекция по Y размещения строения*/ 
bt_template char(20), /*шаблон здания*/
PRIMARY KEY (`bt_id`)
) ENGINE=MyISAM DEFAULT CHARSET=cp1251;
</pre>Фрагмент 5.1.1<br>
			<br>
			<b>bt_id</b> - идентификатор типа здания<br>
			<b>bt_name</b> - название здания ( например: конюшня )<br>
			<b>bt_image</b> - картинка построенного здания <br>
			<b>bt_image_not_ready</b> - картинка строящегося здания <br>
			<b>bt_description</b> - описание назначения этого здания <br>
			<b>bt_ycoord_dif</b> - это смещение по <span lang="en-us">Y </span>
			для размещения здания на карте поселка (разные здания - разные 
			размеры картинок) <br>
			<b>bt_template</b> - шаблон (<span lang="en-us">php-</span>файл) 
			который описывает присущую только этому зданию функциональность.<br>
			<br>
			Давайте добавим немного данных в эту таблицу:<br>
<pre class="brush: sql;">insert into building_types (bt_id,bt_name,bt_image,bt_image_not_ready,bt_description,bt_ycoord_dif,bt_template) 
values (1,'Стройплощадка','img/vill/iso.gif','img/vill/iso.gif','',0,'tpl_iso.php'); 
insert into building_types (bt_id,bt_name,bt_image,bt_image_not_ready,bt_description,bt_ycoord_dif,bt_template) 
values (2,'Главное здание','img/vill/g15.gif','img/vill/g15b.gif','В главном здании живут строители деревни...',20,'tpl_g15.php');
insert into building_types (bt_id,bt_name,bt_image,bt_image_not_ready,bt_description,bt_ycoord_dif,bt_template) 
values (3,'Амбар','img/vill/g11.gif','img/vill/g11b.gif','В амбаре хранятся излишки зерна...',35,'tpl_g11.php');
insert into building_types (bt_id,bt_name,bt_image,bt_image_not_ready,bt_description,bt_ycoord_dif,bt_template) 
values (4,'Склад','img/vill/g10.gif','img/vill/g10b.gif','На складе хранится сырье: древесина, глина и железо...',22,'tpl_g10.php');
</pre>Фрагмент 5.1.2<p>Тут все ясно, единственное, Вы наверно заметили в поле <b>
			bt_template</b> для разных типов зданий указаны какие-то файлы (tpl_iso.php, 
			tpl_g15.php ....). Это как раз и есть шаблоны. Для разных зданий 
			характерны какие-то общие данные, но есть и присущие каждому зданию 
			индивидуальные - вот они то и будут описаны в этих шаблонах. Это мы 
			рассмотрим чуть позже.<br>
			<br>
			Итак, это был справочник, а теперь нам нужно где-то хранить все 
			здания, которые будут строить отдельные игроки в своих поселках. Нам 
			понадобится таблица с именем - <b>buildings</b>.<br>
			</p>
<pre class="brush: sql;">/* таблица зданий/стройплощадок поселка игрока */
CREATE TABLE `buildings` (
bid bigint(20) unsigned NOT NULL auto_increment, /*ID*/
bnum char(50), /*номер размещения постройки*/ 
bt_id char(50), /*связь с building_types (тип здания)*/
b_xcoord int, 
b_ycoord int,
b_level int default 0, /* уровень здания */
fid int default 0, /*связан с принадлежащим игроку полем общей карты*/
PRIMARY KEY (`bid`)
) ENGINE=MyISAM DEFAULT CHARSET=cp1251;
</pre>Фрагмент 5.1.3<br>
			<br>
			<b>bid</b> - уникальный идентификатор каждого построенного здания 
			(или стройплощадки)<br>
			<b>bnum</b> - номер этого здания <br>
			<b>bt_id</b> -&nbsp; поле связывающее здание с его типом из таблицы
			<b>building_types</b> <br>
			<b>b_xcoord</b> - координата по <span lang="en-us">X </span>
			размещения здания (стройплощадки) на карте поселка <br>
			<b>b_ycoord</b>&nbsp; - координата по У<span lang="en-us"> </span>
			размещения здания (стройплощадки) на карте поселка <br>
			<b>b_level</b> - уровень здания <br>
			<b>fid</b> -&nbsp; поле связывающее здание с поселком, которому оно 
			принадлежит. <br>
			<br>
			Давайте придумаем следующее - когда игрок регистрируется в игре, ему 
			нужно сразу сформировать поселок со строительными площадками, на 
			которых он сможет возводить необходимые ему здания. Для этого 
			предлагается сделать процедуру по генерации стройплощадок для 
			поселка. По сути, эта процедура должна будет вносить данные в 
			таблицу <b>buildings</b> для указанного поселка.<br>
			Вот как выглядит эта процедура:<pre class="brush: sql;">/*------- процедура по генерированию стройплощадок ----------*/
create procedure makebuildplaces (p_fid int)
BEGIN
 /*сразу вставляем главное здание*/ 
 insert into `buildings` (bnum,bt_id,b_xcoord,b_ycoord,b_level,fid) VALUES (1,2,255,139,1,p_fid);
 /*и еще 19 стройплощадок*/
 insert into `buildings` (bnum,bt_id,b_xcoord,b_ycoord,b_level,fid) VALUES (2,1,210,89,0,p_fid);
 insert into `buildings` (bnum,bt_id,b_xcoord,b_ycoord,b_level,fid) VALUES (3,1,269,83,0,p_fid);
 insert into `buildings` (bnum,bt_id,b_xcoord,b_ycoord,b_level,fid) VALUES (4,1,345,94,0,p_fid);
 insert into `buildings` (bnum,bt_id,b_xcoord,b_ycoord,b_level,fid) VALUES (5,1,125,115,0,p_fid);
 insert into `buildings` (bnum,bt_id,b_xcoord,b_ycoord,b_level,fid) VALUES (6,1,89,154,0,p_fid);
 insert into `buildings` (bnum,bt_id,b_xcoord,b_ycoord,b_level,fid) VALUES (7,1,75,224,0,p_fid);
 insert into `buildings` (bnum,bt_id,b_xcoord,b_ycoord,b_level,fid) VALUES (8,1,93,263,0,p_fid);
 insert into `buildings` (bnum,bt_id,b_xcoord,b_ycoord,b_level,fid) VALUES (9,1,172,303,0,p_fid);
 insert into `buildings` (bnum,bt_id,b_xcoord,b_ycoord,b_level,fid) VALUES (10,1,151,340,0,p_fid);
 insert into `buildings` (bnum,bt_id,b_xcoord,b_ycoord,b_level,fid) VALUES (11,1,282,344,0,p_fid);
 insert into `buildings` (bnum,bt_id,b_xcoord,b_ycoord,b_level,fid) VALUES (12,1,298,314,0,p_fid);
 insert into `buildings` (bnum,bt_id,b_xcoord,b_ycoord,b_level,fid) VALUES (13,1,369,276,0,p_fid);
 insert into `buildings` (bnum,bt_id,b_xcoord,b_ycoord,b_level,fid) VALUES (14,1,417,242,0,p_fid);
 insert into `buildings` (bnum,bt_id,b_xcoord,b_ycoord,b_level,fid) VALUES (15,1,408,186,0,p_fid);
 insert into `buildings` (bnum,bt_id,b_xcoord,b_ycoord,b_level,fid) VALUES (16,1,402,145,0,p_fid);
 insert into `buildings` (bnum,bt_id,b_xcoord,b_ycoord,b_level,fid) VALUES (17,1,235,260,0,p_fid);
 insert into `buildings` (bnum,bt_id,b_xcoord,b_ycoord,b_level,fid) VALUES (18,1,164,214,0,p_fid);
 insert into `buildings` (bnum,bt_id,b_xcoord,b_ycoord,b_level,fid) VALUES (19,1,204,189,0,p_fid);
 insert into `buildings` (bnum,bt_id,b_xcoord,b_ycoord,b_level,fid) VALUES (20,1,176,161,0,p_fid);
END; 
</pre>Фрагмент 5.1.3<p>Как Вы видите из вышеприведенного фрагмента - в поселка 
			находится 20 мест под строительство зданий, а одно здание уже 
			построено - это Главное здание 1 уровня (<b>b_level</b>=1). <b>
			b_xcoord</b> и <b>b_ycoord</b> мы прописываем по аналогии с 
			кружочками для вывода уровней ресурсных полей (помните предыдущее 
			занятие?) Ну и для каждого здания прописан идентификатор поселка 
			(поле <b>fid</b>), куда мы вставляем значение из аргумента, 
			переданного этой процедуре.<br>
			Как Вы уже наверно догадались, чтоб вызвать эту процедуру и создать 
			стройплощадки и главное здание для поселка игрока с именем test, 
			нужно сделать так:</p><pre class="brush: sql;">CALL makebuildplaces(49); /* для нашего игрока &quot;test&quot; */ 
</pre>Фрагмент 5.1.4<br>
			<br>
			В результате таблица <b>buildings</b> заполнится данными, примерно 
			так:<br>
			<br>
			<img border="0" src="pics/bld.png" width="594" height="437"> 
			<p>Рисунок 5.1.1<br>
			<br>
			Итак, Вы видите 19 записей с <span lang="en-us">bt_id = 1 - </span>
			это стройплощадки и одна запись с <span lang="en-us">bt_id = 2 -
			</span>это главное здание и <span lang="en-us">b_level </span>у него 
			равен 1 (здание сразу 1 уровня). <br>
			Давайте взглянем как выглядит карта поселка, на которой мы вскоре 
			разместим наши строительные объекты:<br>
			<br>
			<img border="0" src="www/img/village.jpg" width="540" height="448"><br>
			<br>
			Рисунок 5.1.2<br>
			<br>
			И сейчас настало время создать страничку с названием
			<span lang="en-us"><b>village.php</b> </span>которая будет 
			отображать наш поселок. Для этого нам понадобятся еще картинки 
			зданий (пока что одна - главное здание) и картинка стройплощадки:<br>
			<img border="0" src="www/img/vill/g15.gif" width="75" height="70"><img border="0" src="www/img/vill/iso.gif" width="57" height="31"><br>
			<br>
			Теперь точно все готово для создания файла <span lang="en-us"><b>
			village.php</b></span>. Приведем фрагмент этого фала, который будет 
			визуализировать поселок и строения на нем:</p>


<pre class="brush: php;">
&lt;div class=&quot;resdiv&quot; style=&quot;padding:0px 0px 0px 0px; position:absolute;left:220px;top:170px; z-index:0&quot;&gt;
&lt;img src=&quot;img/village.jpg&quot;&gt; 

&lt;?
$res = mysql_query(&quot;SELECT b.bid, b.bnum, bt.bt_name,bt.bt_image, bt.bt_image_not_ready, bt.bt_description, bt.bt_ycoord_dif,
b.b_xcoord, b.b_ycoord, b.b_level
FROM buildings b
inner join building_types bt on bt.bt_id = b.bt_id
WHERE b.fid = $fid&quot;, $link )
or die(&quot;Query failed : &quot; . mysql_error());

while ($row = mysql_fetch_array( $res )) {
 $b_x = $row[&quot;b_xcoord&quot;]-10; // небольшое смещение в Х координате
 $b_y = $row[&quot;b_ycoord&quot;];
 $coord_dif = $row[&quot;bt_ycoord_dif&quot;];
 $bt_image = $row[&quot;bt_image&quot;];
 $bt_image_not_ready = $row[&quot;bt_image_not_ready&quot;];
 $bt_name = $row[&quot;bt_name&quot;];
 $b_level = $row[&quot;b_level&quot;];
 $bnum = $row[&quot;bnum&quot;];
 if ($b_level &gt; 0 )
   echo '&lt;div class=&quot;bilding_pos&quot; style=&quot;position:absolute;left:'.$b_x.'px;top:'.($b_y-$coord_dif).'px; z-index:0&quot;&gt;
&lt;img src=&quot;'.$bt_image.'&quot; title=&quot;'.$bt_name.' уровень '.$b_level.'&quot; onclick=&quot;go_build('.$bnum.')&quot;&gt;&lt;/div&gt;';
 else
   echo '&lt;div class=&quot;bilding_pos&quot; style=&quot;position:absolute;left:'.$b_x.'px;top:'.($b_y-$coord_dif).'px; z-index:0&quot;&gt;
&lt;img src=&quot;'.$bt_image_not_ready.'&quot; title=&quot;'.$bt_name.' уровень '.$b_level.'&quot; onclick=&quot;go_build('.$bnum.')&quot;&gt;&lt;/div&gt;';
}

?&gt;

&lt;/div&gt;
</pre>
			Фрагмент 5.1.5<br>
			<br>
			В строках 1-2 вышеприведенного фрагмента мы создаем слой (<span lang="en-us">&lt;div&gt;</span>)<span lang="en-us">
			</span>для хранения картинки карты поселка (village.jpg) и всех 
			объектов (стройплощадок и зданий). В запросе (строки 5-10) мы 
			объединяем две таблицы (<b>buildings</b> и <b>building_types</b>), 
			чтоб получить данные - картинки зданий и их названия, координаты их 
			размещения, уровни и т.д. В строках 21-23 мы проверяем, если уровень 
			здания равен единице - выводим картинку готового здания, если нулю - 
			строящегося (хотя для стройплощадок это не имеет разницы). Вы также 
			могли заметить, что при клике мышью на картинке здания сработает 
			событие и вызовет <span lang="en-us">JavaScript </span>функцию<span lang="en-us">
			</span><font color="#3B84D0">go_build</font><span lang="en-us">.
			</span>Но это уже тема для следующего пункта.<br>
			Вот как выглядит результат выполнения скрипта из фрагмента 5.1.5.<br>
			<br>
			<img border="0" src="pics/vlg1.png" width="563" height="474"><br>
			Рисунок 5.1.3<br>
			<br>
			Вы видите, что по всему поселку разместились стройплощадки, а 
			главное здание уже построено. Давайте научимся в него заходить.<span lang="en-us"><font color="#4775A5"><b><br>
			<br>
			<br>
			5</b></font></span><b><font color="#4775a5">.2. 
			</font></b><font color="#4775A5"><b>Главное здание<br>
			<br>
			</b></font>&nbsp;&nbsp; Перед тем, как научиться входить в здание, 
			давайте сделаем еще одну таблицу в нашей базе. Она понадобится нам 
			для апгрейдов зданий. Название этой таблицы - <b>build_levels_cost</b>.<br>
<pre class="brush: sql;">/*------------ справочник уровней, стоимости апгрейдов, потребления ресурсных полей ---------------*/
CREATE TABLE `build_levels_cost` (
blc_id bigint(20) unsigned NOT NULL auto_increment, /*ID*/
bt_id int, /*свзяь с building_types (тип здания)*/
blc_level int, /*уровень ресурсного поля*/ 
blc_grain int, /* сколько зерна для перехода на этот уровень */ 
blc_ore int, /* сколько руды для перехода на этот уровень */ 
blc_wood int, /* сколько леса для перехода на этот уровень */ 
blc_clay int, /* сколько глины для перехода на этот уровень */ 
blc_cons int, /* потребление */ 
blc_space INT, /* вместимость, для склада,амбара*/ 
blc_build_speed INT, /* скорость строительства (для гл. здания)*/
blc_time_upgrade CHAR(10), /* время апгрейда до след. уровня */
PRIMARY KEY (`blc_id`)
) ENGINE=MyISAM DEFAULT CHARSET=cp1251;
</pre>Фрагмент 5.2.1<br>
			<br>
			Она чем-то напоминает таблицу затрат на апгрейды ресурсных полей -
			<b>res_levels_cost</b>, но в ней есть и отличия. Например поля:<br>
			<b>blc_space</b>&nbsp; - вместимость для склада или амбара<br>
			<b>blc_build_speed</b> - скорость строительства (характерно для 
			главного здания) 
			<p>Давайте заполним парочку уровней апгрейдов для трех зданий в этой 
			таблице:<br>
			</p>
<pre class="brush: sql;">/*--------------------------- первые 5 уровней развития некоторых зданий ----------------------*/
/*склад*/
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_space, blc_time_upgrade) 
values (4,0,0,0,0,0,0,800,'0:00:00');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_space, blc_time_upgrade) 
values (4,1,130,160,90,40,1,1200,'0:25:50');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_space, blc_time_upgrade) 
values (4,2,165,205,115,50,1,1700,'0:33:50');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_space, blc_time_upgrade) 
values (4,3,215,260,145,65,2,2300,'0:43:00');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_space, blc_time_upgrade) 
values (4,4,275,335,190,85,2,3100,'0:53:50');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_space, blc_time_upgrade) 
values (4,5,350,430,240,105,2,4000,'1:06:20');
/*амбар*/
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_space, blc_time_upgrade) 
values (3,0,0,0,0,0,0,800,'0:00:00');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_space, blc_time_upgrade) 
values (3,1,80,100,70,20,1,1200,'0:20:40');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_space, blc_time_upgrade) 
values (3,2,100,130,90,25,1,1700,'0:27:50');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_space, blc_time_upgrade) 
values (3,3,130,165,115,35,2,2300,'0:36:10');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_space, blc_time_upgrade) 
values (3,4,170,210,145,40,2,3100,'0:45:50');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_space, blc_time_upgrade) 
values (3,5,215,270,190,155,2,4000,'0:57:00');
/*главное здание*/
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_build_speed, blc_time_upgrade) 
values (2,0,0,0,0,0,0,100,'0:00:00');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_build_speed, blc_time_upgrade) 
values (2,1,70,40,160,20,2,100,'0:27:50');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_build_speed, blc_time_upgrade) 
values (2,2,90,50,75,25,1,96,'0:33:20');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_build_speed, blc_time_upgrade) 
values (2,3,115,65,100,35,1,93,'0:43:00');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_build_speed, blc_time_upgrade) 
values (2,4,145,85,125,40,1,90,'0:53:50');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_build_speed, blc_time_upgrade) 
values (2,5,190,105,160,55,1,86,'1:06:20');
</pre>Фрагмент 5.2.2<p>Как Вы видите, с ростом уровня - растет вместительность 
			склада и амбара, а процент от скорости постройки на нулевом уровне 
			(для главного здания) падает. Остальные поля стандартны - ресурсы, 
			затрачиваемые на переход на более высокий уровень стабильно растут, 
			так же как и время на эти переходы.<br>
			<br>
			Давайте сейчас сделаем процедуру, которая возвратит нам необходимые 
			данные из таблицы <b>build_levels_cost</b> для указанного типа 
			здания в нашем поселке. То есть, как только мы захотим, например 
			узнать, сколько потребуется для апгрейда главного здания - эта 
			процедура нам предоставит эту информацию.<br>
			Назовем эту процедуру <font color="#3B84D0">building_upgrade_cost</font> 
			и представим ее Вам на рассмотрение:</p>


<pre class="brush: php;">
///////////////////////////////////////////////////////////////////////////
// Сколько нужно для апгрейда здания в поселке
// $bid - идентификатор здания
///////////////////////////////////////////////////////////////////////////
function building_upgrade_cost( $bid ){
global $link;
$fid = $_SESSION['fid']; // id поселка
$retv = false;
// Узнаем сколько ресурсов нужно для след.левела этого ресурсного поля
$query = &quot;SELECT blc_grain, 
blc_ore, 
blc_wood, 
blc_clay,
blc_cons,
blc_time_upgrade
from buildings b
inner join build_levels_cost blc on b.bt_id=blc.bt_id 
and (b.b_level+1) = blc.blc_level 
where fid=$fid and bid=$bid&quot;;
$res = mysql_query( $query, $link ) or die(&quot;Query failed : &quot; .mysql_error());
// это - сколько нужно ресов и времени, чтоб сделать апгрейд 
$row = mysql_fetch_array( $res );

$a_res['grain'] = $row[&quot;blc_grain&quot;];
$a_res['ore'] = $row[&quot;blc_ore&quot;];
$a_res['wood'] = $row[&quot;blc_wood&quot;];
$a_res['clay'] = $row[&quot;blc_clay&quot;];
$a_res['cons'] = $row[&quot;blc_cons&quot;];
$a_res['time_upgrade'] = $row[&quot;blc_time_upgrade&quot;];

return ( $a_res );
}
</pre>
			Фрагмент 5.2.<span lang="en-us">3</span>.<p>Эта процедура получает в 
			качестве аргумента идентификатор здания из таблицы <b>buildings</b>, 
			который она использует в запросе (строки 10-19). Это запрос 
			объединяет две таблицы (<b>buildings</b> и <b>build_levels_cost</b> 
			). Объединение идет по двум параметрам (типу здания и уровню 
			здания). b_level+1 - означает, что мы хоти узнать информацию о 
			следующем уровне, на который может перейти наше здание при апгрейде. 
			Данные, возвращаемые запросом мы складируем в массив $a_res и 
			возвращаем оператором return.<br>
            <br>
			&nbsp; Теперь перейдем к визуализации на стороне браузера и воспользуемся <span lang="en-us">JavaScript
			</span> функцией <font color="#3B84D0">go_build </font>
			<span lang="en-us">с</span> помощью которой научимся &quot;входить&quot;<span lang="en-us">
			</span> в любое здание поселка. Под термином входить нужно понимать 
			получение расширенной информации по указанному зданию и возможность 
			управления его свойствами и сервисами, которое это здание 
			предоставляет. Сервисы индивидуальны для каждого здания и описаны в 
			его шаблонах (это вы помните из прошлого пункта текущего занятия)<span lang="en-us">.<br>
			</span> Вот как выглядит <span lang="en-us">JavaScript
			</span> функция <font color="#3B84D0">go_build</font>.<br>
            </p>
<pre class="brush: js;">function go_build( bnum ){
location.href=&quot;build.php?bnum=&quot;+bnum;
}
</pre>Фрагмент 5.<span lang="en-us">2</span>.<span lang="en-us">4</span><p>Вы 
			видите, что она передает управление в файл <b>build.php</b> и 
			передает ему параметр - номер здания в который мы заходим (кликнув 
			по картинке здания мышью)<span lang="en-us">.</span> Давайте сделаем 
			этот файл.<span lang="en-us">
			</span>Как&nbsp; и положено в этом файле будет секция проверки 
			авторизации (в этом занятии мы вынесли ее в отдельный файл - <b>
			<span lang="en-us">config.auth.php</span></b>), меню, а дальше уже 
			идет&nbsp; скрипт, который нам понадобится чтоб рассказать, что же 
			мы увидим щелкнув на картинке здания.<span lang="en-us"><br>
			</span>Вот фрагмент этого кода:</p>
			<pre class="brush: php;">
$res = mysql_query(&quot;SELECT b.bid, bt.bt_id, b.bnum, bt.bt_name,bt.bt_image, bt.bt_image_not_ready, 
bt.bt_description, bt.bt_ycoord_dif, b.b_level,bt_template
FROM buildings b
inner join building_types bt on bt.bt_id = b.bt_id
WHERE b.fid = $fid and bnum = $bnum&quot;, $link )
or die(&quot;Query failed : &quot; . mysql_error());

$num_rows = mysql_num_rows( $result );
if( $num_rows == 0 ) die(&quot;Ошибка номера постройки!&quot;);

$row = mysql_fetch_array( $res );
$bid = $row[&quot;bid&quot;];
$bt_id = $row[&quot;bt_id&quot;];
$bt_name = $row[&quot;bt_name&quot;];
$b_level = $row[&quot;b_level&quot;];
$bt_image = $row[&quot;bt_image&quot;];
$bt_description = $row[&quot;bt_description&quot;];
$bt_template = $row[&quot;bt_template&quot;];

if ($bt_id &lt;&gt; 1){ // не стройплощадка!
echo '&lt;br&gt;&lt;img src=&quot;'.$bt_image.'&quot; align=&quot;right&quot;&gt;'; 
echo &quot;&lt;span class='res_header'&gt;&quot;.$bt_name.&quot; Уровень &quot;.$b_level.&quot;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&quot;;
echo $bt_description.&quot;&lt;br&gt;&lt;br&gt;&quot;;
} else {
echo &quot;&lt;br&gt;&lt;span class='res_header'&gt;Построить новое здание&lt;/span&gt;&lt;br&gt;&lt;br&gt;&quot;;
}

@include(&quot;tpl/&quot;.$bt_template);

if ($bt_id &lt;&gt; 1){ // не стройплощадка!
// узнаем расходы на строительство
$a_res = building_upgrade_cost( $bid );
$a_grain = $a_res['grain'];
$a_ore = $a_res['ore'];
$a_wood = $a_res['wood'];
$a_clay = $a_res['clay'];
$a_cons = $a_res['cons'];
$a_time_up = $a_res['time_upgrade'];

echo &quot;&lt;br&gt;Расходы на строительство до уровня &quot;.($b_level+1).&quot;:&lt;br&gt;&quot;;
echo '&lt;img src=&quot;img/res/grain.png&quot;&gt;'.$a_grain.' | &lt;img src=&quot;img/res/ore.png&quot;&gt;'.$a_ore.' | &lt;img src=&quot;img/res/wood.png&quot;&gt;'.$a_wood.' |
 &lt;img src=&quot;img/res/clay.png&quot;&gt;'.$a_clay.' | &lt;img src=&quot;img/res/cons.png&quot;&gt;'.$a_cons.' | &lt;img src=&quot;img/res/time.png&quot;&gt; '.$a_time_up.'&lt;br&gt;&lt;br&gt;';

if( allow_upgrade_buildings( $bid ) ){
if( !build_upgrade_in_progress( $fid ) )
echo '&lt;a class=&quot;build&quot; href=&quot;village.php?bid='.$bid.'&quot;&gt;Улучшить до уровня '.($b_level+1).'&lt;/a&gt;'; 
else echo '&lt;font color=&quot;#CCCCCC&quot;&gt;Строители сейчас заняты!&lt;/font&gt;';
} else {
echo '&lt;font color=&quot;#CCCCCC&quot;&gt;Не хватает ресурсов!&lt;/font&gt;';
}
}

</pre>
			Фрагмент 5.2.5<p>Слегка напоминает вход в детализацию ресурсного 
			поля, если Вы заметили. Ну конечно есть и свои нюансы. После 
			получения данных по зданию (название, картинки, подключаемый файл 
			шаблона и т.д.) из запроса (строки 1-18), проверяем тип здания в 
			строке 20. А не стройплощадка ли это? Если нет - то выводим картинку 
			здания, пишем его название, уровень <span lang="en-us">и</span> 
			краткое описание<span lang="en-us">
			</span>(строки 21-23), Если стройплощадка - просто выводим надпись - 
			&quot;Построить новое здание&quot;.<span lang="en-us"><br>
			</span>Далее мы подключаем шаблон строка 28. Все шаблоны будем 
			хранить в папке <span lang="en-us"><b><a href="www/tpl">tpl</a></b>.
			</span>Далее, если не стройплощадка - выводим информацию по 
			ресурсам, которые нужно затратить<span lang="en-us">
			</span>для перехода здания на новый уровень<span lang="en-us">
			</span>(эти данные нам дает функцию, которую мы только что сделали -
			<font color="#3B84D0">building_upgrade_cost</font>)<span lang="en-us">
			</span>В строках 44-51 - стандартные проверки на возможность 
			апгрейда (хватает ли ресурсов?)<span lang="en-us">
			</span>и не апгрейдится ли что-то в данный момент. Как Вы догадались 
			в каждый конкретный момент времени можно апгрейдить 1 здание и 1 
			ресурсное поле (это было рассмотрено на прошлом занятии)<span lang="en-us">
			</span>Самостоятельно рассмотрите функции <font color="#3B84D0">allow_upgrade_buildings</font>
			<span lang="en-us">и</span> <font color="#3B84D0">build_upgrade_in_progress</font> 
			после завершения изучения текущего занятия.<span lang="en-us"><br>
			</span>&nbsp; А мы пока что рассмотрим подключаемые шаблоны<span lang="en-us">.</span> 
			Предположим игрок щелкнул мышью на главном здании<span lang="en-us">.</span> 
			Кроме<span lang="en-us">
			</span>информации, которую выдаст на экран браузера фрагмент 5.2.5 
			мы ожидаем что-то еще от (@include(&quot;tpl/&quot;.$bt_template);) 
			. Для главного здания $bt_template содержит строку &quot;tpl_g15.php&quot; 
			(это значение взято из таблицы <b>building_types</b>). Итак что же 
			мы поместили в tpl/tpl_g15.php<span lang="en-us">
			</span>? А вот что:</p>


<pre class="brush: php;">
&lt;?
// Шаблон для главного здания!

echo '&lt;table cellpadding=&quot;5&quot; cellspacing=&quot;1&quot; id=&quot;build_value&quot;&gt;&lt;tr&gt;
&lt;td &gt;Время строительства:&lt;/td&gt;
&lt;td &gt;&lt;b&gt;'.get_build_speed( $b_level ).'&lt;/b&gt; % &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td &gt;Время строительства на уровне '.($b_level+1).':&lt;/td&gt;
&lt;td &gt;&lt;b&gt;'.get_build_speed( $b_level + 1 ).'&lt;/b&gt; %&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;';
?&gt;
</pre>
			Фрагмент 5.2.6.<br>
			<br>
			Это один из самых простых шаблонов для зданий поселка. В дальнейших 
			занятиях, когда мы будем рассматривать &quot;рынок&quot; или &quot;пункт сбора&quot;<span lang="en-us">
			</span>эти шаблоны будут сложнее и даже содержать несколько страниц 
			на одно здание.<span lang="en-us"><br>
			</span>А тут все просто - мы создали <span lang="en-us">HTML </span>
			таблицу <span lang="en-us">(</span>&lt;table<span lang="en-us">&gt;</span>)<span lang="en-us">
			</span>в ячейки которой поместили некую информацию, возвращаемую 
			функцией <font color="#3B84D0">get_build_speed</font><span lang="en-us">.</span> 
			Эта функция очень проста:<pre class="brush: php;">
///// функция возвращает скорость строительства в % //////////
function get_build_speed( $p_level ){
// это только для главного здания 
$query = &quot;SELECT blc_build_speed from build_levels_cost
where blc_level=$p_level and bt_id=2&quot;;
$res = mysql_query( $query ) or die(&quot;Query failed : &quot; .$query);
$row = mysql_fetch_array( $res );
return( $row[&quot;blc_build_speed&quot;] );
}

</pre>
			Фрагмент 5.2.7<p>Она возвращает нам значение из поля blc_build_speed
			<span lang="en-us">т</span>аблицы build_levels_cost
			<span lang="en-us">п</span>о уровню, который мы передали в качестве 
			аргумента для этой функции. <span lang="en-us">К</span>роме того в 
			запросе (строки 4-5) жестко<span lang="en-us">
			</span>задано условие bt_id=2<span lang="en-us">,</span> это тип 
			здания - главное здание.<span lang="en-us">
			</span>Таким образом - передаем в функцию уровень, а получаем 
			скорость строительства при этом уровне главного здания.<span lang="en-us"><br>
			<br>
			</span>Теперь можно продемонстрировать, что же выведет на файл
			<span lang="en-us"><b>build.php</b>
			</span>на экран:<span lang="en-us"><br>
			<br>
			<img border="0" src="pics/buld_det.png" width="517" height="333"><br>
			</span>Рисунок 5.2.1<span lang="en-us"><br>
			<br>
			</span>С улучшениями мы разберемся в пункте 5.5, а пока что займемся 
			складированием нашего зерна.<span lang="en-us"><br>
			</span> <br>
            <br><span lang="en-us"><font color="#4775A5"><b>5</b></font></span><font color="#4775a5"><font ><b>.3. 
			Амбар&nbsp;
     </b></font><br></font>
            <br>
&nbsp;&nbsp; Наше зерно требует хранения и для этих целей нам понадобится амбар. 
			И если главное здание уже было нам любезно предоставлено, то амбар 
			нам придется построить с самого начала на любой из доступных 
			стройплощадок. <br>
&nbsp;&nbsp; Картинки построенного и строящегося амбара будем использовать 
			следующие:<br>
			<img border="0" src="www/img/vill/g11.gif" width="75" height="72"><img border="0" src="www/img/vill/g11b.gif" width="75" height="72"><br>
			<br>
&nbsp; Как же нам заказать нужное здание для постройки? Вы помните, что у нас 
			есть справочник типов зданий (<b>building_types</b>). Таким образом 
			нужно сделать следующее - при нажатии игрока мышью на любую 
			стройплощадку, выводить список доступных строений и ресурсов, 
			требующихся на их постройку. В этом списке не нужно выводить те 
			здания, которые уже построены в поселке игрока. Как Вы догадались, 
			это мы сейчас реализуем в шаблоне <b>tpl_iso.php</b>, который 
			вызывается при нажатии на стройплощадку.</p>


<pre class="brush: php;">
 // Стройплощадка!

$res = mysql_query(&quot;SELECT bt.bt_id,bt.bt_name,bt.bt_image,bt_description,
blc_grain, blc_ore, blc_wood, blc_clay, blc_cons, blc_time_upgrade
FROM building_types bt
inner join build_levels_cost blc on blc.bt_id = bt.bt_id
WHERE blc_level = 1 and bt.bt_id not in (select bt_id from
buildings b WHERE b.fid = $fid) and bt.bt_id &lt;&gt; 1&quot;, $link )
or die(&quot;Query failed : &quot; . mysql_error());

while ($row = mysql_fetch_array( $res )) {
 $btype = $row[&quot;bt_id&quot;]; // какой тип здания?
 $bt_name = $row[&quot;bt_name&quot;];
 $bt_image = $row[&quot;bt_image&quot;];
 $bt_description = $row[&quot;bt_description&quot;];
 $a_grain = $row[&quot;blc_grain&quot;];
 $a_ore = $row[&quot;blc_ore&quot;];
 $a_wood = $row[&quot;blc_gwood&quot;];
 $a_clay = $row[&quot;blc_clay&quot;];
 $a_cons = $row[&quot;blc_cons&quot;];
 $a_time_up = $row[&quot;blc_time_upgrade&quot;];

 echo '&lt;br&gt;&lt;img src=&quot;../'.$bt_image.'&quot; align=&quot;right&quot;&gt;'; 
 echo &quot;&lt;span class='res_header'&gt;&quot;.$bt_name.&quot; &lt;/span&gt;&lt;br&gt;&lt;br&gt;&quot;;
 echo $bt_description.&quot;&lt;br&gt;&lt;br&gt;&quot;;

 echo '&lt;img src=&quot;img/res/grain.png&quot;&gt;'.$a_grain.' | &lt;img src=&quot;img/res/ore.png&quot;&gt;'.$a_ore.' | 
&lt;img src=&quot;img/res/wood.png&quot;&gt;'.$a_wood.' | &lt;img src=&quot;img/res/clay.png&quot;&gt;'.$a_clay.' | &lt;img src=&quot;img/res/cons.png&quot;&gt;'.$a_cons.' |
 &lt;img src=&quot;img/res/time.png&quot;&gt; '.$a_time_up.'&lt;br&gt;';
 echo '&lt;a class=&quot;build&quot; href=&quot;village.php?bnum='.$bnum.'&amp;bt='.$btype.'&quot;&gt;Построить здание &lt;/a&gt;&lt;br&gt;&lt;br&gt;'; 
}
</pre>
			Фрагмент 5.3.1<p>Как Вы можете заметить, запрос в строках 3-9 
			вышеприведенного фрагмента, отбирает из объединенных по критерию ( blc.bt_id = bt.bt_id 
			- то есть типу здания) таблиц (building_types и build_levels_cost ) 
			только те строения, которые еще не построены в поселке игрока 
			(подзапрос - not in ( select bt_id from buildings b WHERE b.fid = $fid 
			)&nbsp; ) . Так как в справочной таблице у нас пока 4 вида зданий, 
			то выдаваться будут только два типа - амбар и склад. В строках 23-30 
			мы выведем картинки и информацию по этим объектам и выведем ссылку 
			&quot;Построить здание&quot;, которая передает управление снова в файл поселка village.php 
			вместе с параметрами - номер стройплощадки и тип здания, которое мы 
			хотим построить! (Прежде чем давать игроку возможность нажать на 
			ссылку &quot;Построить здание&quot;, неплохо было бы узнать, а хватит ли нам 
			ресурсов для этого? - оставляем Вам это в качестве домашнего 
			задания)<br>
			Давайте прежде чем жать на эту ссылку, посмотрим как выглядит 
			результат работы описываемого в фрагменте 5.3.1 шаблона.<br>
			<br>
			<img border="0" src="pics/new_bld.png" width="513" height="445"><br>
			Рисунок 5.3.1<br>
			<br>
			&nbsp;Признаемся Вам по секрету, что постройка нового здания, это 
			тоже самое что и апгрейд существующего, только там идет увеличение 
			уровня, например с 1 по 2, 2 по 3 и т.д., а при постройке с 0 по 1 
			при этом на карте поселка должна отображаться картинка строящегося 
			здания из поля <font color="#3B84D0">bt_image_not_ready</font> 
			таблицы <b>building_types</b>. И все это мы рассмотрим в пункте 5 
			текущего занятия. Правда есть еще один момент! Помните таблицу <b>
			job_res_upgrade</b> из прошлого занятия, которая нужна была для 
			очереди апгрейда ресурсных полей? Мы решили ее использовать и для 
			очереди апгрейдов зданий в поселке и поэтому убрали из ее имени
			<span lang="en-us">_res - </span>теперь эта таблица называется <b>
			job_upgrade</b> и мы добавим в нее еще одно поле.<br>
			</p>
<pre class="brush: sql;">/*Таблица очереди апгрейдов ресурсных полей и зданий поселка*/
CREATE TABLE `job_upgrade` (
jr_id bigint(20) unsigned NOT NULL auto_increment, /*ID задания на апгрейд*/
rf_id bigint(20) unsigned NOT NULL, /*ID поля из таблицы res_fields*/ 
time_s bigint DEFAULT 0, /*время начала апгрейда в сек. Эпохи. (php time) */
time_e bigint DEFAULT 0, /*расссчитанное время завершения апгрейда в сек. Эпохи. (php time) */
jr_type int default 0, /*тип апгрейда: 0-ресурсное поле, 1-здание в поселке*/ 
PRIMARY KEY (`jr_id`)
) ENGINE=MyISAM DEFAULT CHARSET=cp1251;

</pre>Фрагмент 5.3.2<p>Как Вы догадались это поле - <b>jr_type</b>. Если оно 
			равно нулю - это будет ресурсное поле в поселке, а если 1 - здание в 
			поселке игрока. Так и будем отличать очереди апгрейдов. Напомним, 
			что параллельно можно апгрейдить 1 ресурсное поле и 1 здание. 
			Апгрейд двух зданий одновременно запрещается проверкой функцией <font color="#3B84D0">build_upgrade_in_progress</font> 
			как вы помните.<strong><span lang="en-us"><font color="#4775A5"><br>
			<br>
			<br>
			5</font></span></strong><font color="#4775a5"><strong>.4. 
			Склад</strong>
      
            </font><br>
			<br>
			&nbsp;&nbsp; Кроме зерна, которое, как мы выяснили хранится в 
			амбаре, все остальные ресурсы должны содержаться на складе. Картинки 
			построенного и строящегося склада будем использовать следующие:<br>
			<img border="0" src="www/img/vill/g10.gif" width="75" height="63"><img border="0" src="www/img/vill/g10b.gif" width="75" height="63"><br>
			<br>
			Вы помните из фрагмента 5.1.5, что картинка строящегося здания 
			отображается тогда, когда уровень этого здания равен 0. Таким&nbsp; 
			образом, когда мы выбираем стройплощадку и затем выбрав новое 
			здание, нажимаем кнопку &quot;Построить здание&quot; - в таблице
			<span lang="en-us"><b>fields</b> - </span>тип стройплощадки (поле
			<font color="#3B84D0"><span lang="en-us">bt_id</span></font>) 
			меняется на тип заказанного здания<span lang="en-us"> </span>
			нулевого уровня и фрагмент кода приведенного в 5.1.5 отобразит нам 
			именно картинку строящегося здания. <br>
			Склад мы тоже строим с нуля, выбрав любую свободную площадку для 
			строительства.<br>
			<br>
			Давайте на минутку представим, что склад у нас уже построен (можно 
			кстати изменить любую строку функции <font color="#3B84D0">
			makebuildplaces</font>, которая создает стройплощадку: в частности в 
			bt_id вместо 1 поставить 4, и в уровне b_level поставить вместо 0 
			единицу, перекомпилировать скрипт <span lang="en-us">travgame.sql -
			</span>и склад готов!) . Давайте посмотрим, что отобразит нам 
			страничка
			<span lang="en-us"><b>build.php</b>
			</span>для склада. По сути она должна подключить шаблон <b>
			tpl_g10.php</b>, который мы с удовольствием представим сейчас Вашему 
			вниманию:
			</p><pre class="brush: php;">
// Склад
echo '&lt;table cellpadding=&quot;5&quot; cellspacing=&quot;1&quot; id=&quot;build_value&quot;&gt;&lt;tr&gt;
&lt;td &gt;Вместимость:&lt;/td&gt;
&lt;td &gt;&lt;b&gt;'.get_res_space( $b_level, 4 ).'&lt;/b&gt; ед.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td &gt;Вместимость на уровне '.($b_level+1).':&lt;/td&gt;
&lt;td &gt;&lt;b&gt;'.get_res_space( $b_level + 1, 4 ).'&lt;/b&gt; ед.&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;'; 

</pre>
			Фрагмент 5.4.1<p>Как и в шаблоне для главного здания, этот шаблон 
			для склада предельно прост - создается <span lang="en-us">HTML
			</span>табличка и функция <font color="#3B84D0">get_res_space</font> 
			выводит нам вместимости склада на текущем уровне и на следующем, 
			после возможного апгрейда.<span lang="en-us"> </span>Вот эта 
			функция:</p><pre class="brush: php;">
///// функция возвращает вместимость склада или амбара указаного уровня //////////
function get_res_space( $p_level, $btype ){
 $query = &quot;SELECT blc_space from build_levels_cost
 where blc_level=$p_level and bt_id=$btype&quot;;
 $res = mysql_query( $query ) or die(&quot;Query failed : &quot; .$query);
 $row = mysql_fetch_array( $res );
 return( $row[&quot;blc_space&quot;] );
} 

</pre>
			Фрагмент 5.4.2<p>Здесь все просто, функция получает на входе 
			аргументы - уровень здания и тип здания. Далее в запросе к таблице
			<b>build_levels_cost</b> мы узнаем значение в поле
			<font color="#3B84D0">blc_space</font> и возвращаем его оператором return.<br>
			<br>
			Тогда страничка <b>
			<span lang="en-us">build.php</span> </b>с подключенным шаблоном для 
			склада <b>
			tpl_g10.php</b> покажет нам следующее для строящегося склада, 
			например:<br>
			<br>
			<img border="0" src="pics/sklad.png" width="511" height="302"><br>
			<br>
			Рисунок 5.4.1<br>
			<br>
			Как же происходит строительство или апгрейд? Читайте наш следующий 
			пункт текущего занятия.<br>
			<br>
<br><span lang="en-us"><font color="#4775A5"><b>5</b></font></span><font color="#4775A5"><b>.5. 
			Апгрейды и строительство ресурсных зданий </b></font> <br>
            <br>
            &nbsp;&nbsp; Давайте рассмотрим тот момент, когда игрок выбирает 
			стройплощадку и кликает затем на нужное здание из списка, чтоб 
			построить его. Например это будет у нас амбар. Итак щелкаем на 
			ссылке &quot;Построить здание&quot;<span lang="en-us">. </span>Вы помните, что 
			после этого вызывается скрипт <b>village.php</b> вместе с 
			параметрами - номер стройплощадки и тип здания. Что же происходит в 
			нем, когда ему передаются эти два параметра? А вот что:</p><pre class="brush: php;">
 // задали строительство нового здания
if( isset( $_GET['bnum'] ) &amp;&amp; isset( $_GET['bt'] )){
$bnum = $_GET['bnum']; // номер стройплощадки
$bt = $_GET['bt']; // тип здания

build_new( $fid, $bnum, $bt ); 
}

</pre>
			Фрагмент 5.5.1<br>
			<br>
			Здесь принимаются эти параметры, если они установлены и затем 
			передаются в функцию <font color="#3B84D0">build_new</font>, которая 
			кроме них принимает еще один параметр - идентификатор поселка.&nbsp; 
			Вот эта функция:<pre class="brush: php;">
//////////////////////////////////////////////////////////////////////////
///////// Строим новое здание ////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
function build_new( $fid, $bnum, $btype ){
// Узнаем идентификатор стройплощадки
$query = &quot;SELECT bid
from buildings where bnum = $bnum and fid = $fid&quot;;
$res = mysql_query( $query ) or die(&quot;Query failed : &quot; .mysql_error());
$row = mysql_fetch_array( $res );
$bid = $row[&quot;bid&quot;] ; 

// Узнаем затраты на строительство для здания типа $btype 1 уровня
$query = &quot;SELECT blc_grain, 
blc_ore, 
blc_wood, 
blc_clay,
blc_time_upgrade
from build_levels_cost where blc_level = 1
and bt_id=$btype&quot;;
$res = mysql_query( $query ) or die(&quot;Query failed : &quot; .mysql_error());
// сколько нужно ресов? 
$row = mysql_fetch_array( $res );

$a_grain = $row[&quot;blc_grain&quot;];
$a_ore = $row[&quot;blc_ore&quot;];
$a_wood = $row[&quot;blc_wood&quot;];
$a_clay = $row[&quot;blc_clay&quot;];
$a_time_up = $row['blc_time_upgrade'];

// Уменьшим кол-во ресурсов игрока в связи со строительством
$query = &quot;update fields set f_grain=f_grain-$a_grain,
f_ore=f_ore-$a_ore, 
f_wood=f_wood-$a_wood,
f_clay=f_clay-$a_clay where fid=$fid&quot;;
$result = mysql_query($query) or die(&quot;Query failed : &quot; . mysql_error());

// вставим этот тип здания в наш поселок на нужную стройплощадку
$query = &quot;update buildings set bt_id = $btype, b_level = 0 where bnum = $bnum and fid = $fid&quot;;
$result = mysql_query($query) or die(&quot;Query failed : &quot; . mysql_error());

// в очередь на апрейд до 1 уровня
$time_e = time()+h2s( $a_time_up );
// не забываем установить jr_type = 1 (тип: апгрейд здания)
$query = &quot;insert into job_upgrade(rf_id,time_s,time_e,jr_type) values($bid, &quot;.time().&quot;,$time_e,1)&quot;;
$result = mysql_query($query) or die(&quot;Query failed : &quot; . mysql_error());

}

</pre>
			Фрагмент 5.5.2<p>Функция эта, на самом деле очень проста. В строках 
			6-10 запроса к таблице <b>buildings</b> по номеру стройплощадки мы 
			узнаем ее идентификатор. Затем в строках 12-28 мы из запроса к 
			таблице build_levels_cost&nbsp; узнаем затраты ресурсов и времени на 
			апгрейд здания с уровня 0 до уровня 1 (апгрейд здания с уровня 0 до 
			уровня 1, это как вы понимаете и есть строительство). В строках 
			30-35 мы уменьшаем у нашего игрока количество ресурсов, 
			затрачиваемых на апгрейд (мы уже делали это в прошлом занятии при 
			апгрейде ресурсного поля). В строках 38-39 мы заменяем параметры 
			стройплощадки (bt_id с единицы на нужный ), то есть меняя 
			стройплощадку на здание нулевого уровня. Затем, как обычно узнаем 
			время завершения строительства и вставляем строку в очередь, т.е. в 
			таблицу <b>job_upgrade</b> (строки 42-45). Не правда ли просто?<br>
&nbsp;&nbsp; Теперь настал черед создания визуализации очереди постройки здания, 
			как это было в прошлом уроке с апгрейдом ресурсного поля и тут мы 
			столкнулись с одной проблемой! То что мы сделали в прошлом уроке нас 
			не удовлетворяет, так как с помощью <span lang="en-us">JavaScript
			</span>функции <font color="#3B84D0">updateClock ( ) </font>мы может 
			отобразить только одну очередь постройки или апгрейда. А если у нас 
			одновременно апгрейдится ресурсное поле и строится, к примеру амбар 
			и все это мы хотим увидеть на одной странице, например на странице<b>
			</b><span lang="en-us"><b>res.php</b>? <br>
&nbsp;&nbsp;&nbsp; </span>В общем нам нужно переделать <span lang="en-us">
			JavaScript </span>функцию <font color="#3B84D0">updateClock ( )
			</font>чтоб она могла показывать несколько апгрейдов или 
			строительств. Конечно же мы сделаем это при помощи массивов. А как 
			мы это сделали смотрите в файле <span lang="en-us">
			<a href="www/main.js">main.js</a>. <br>
&nbsp;&nbsp;&nbsp;&nbsp; </span>А сейчас мы перепишем функцию визуализации 
			очереди постройки здания или апгрейда ресурсного поля. Вы помните ее 
			название <font color="#3B84D0">show_res_upgrade</font>. Теперь она 
			выглядит так:</p>
			<pre class="brush: php;">
/////////// показывает - что в данный момент апгрейдится //////////
function show_res_upgrade( $p_fid ){
$cnt = 0;
$result = mysql_query(&quot;SELECT jru.time_s, jru.time_e, rft.rft_name as name, rf.rf_level as level from job_upgrade jru
inner join res_fields rf on rf.rf_id=jru.rf_id
inner join res_fields_types rft on rft.rft_id = rf.rft_id
where jr_type=0 and rf.fid=$p_fid

union 

SELECT jru.time_s, jru.time_e, bt.bt_name as name, b.b_level as level from job_upgrade jru
inner join buildings b on b.bid=jru.rf_id
inner join building_types bt on bt.bt_id = b.bt_id
where jr_type=1 and b.fid=$p_fid&quot; ) 
or die(&quot;Query failed : &quot; . mysql_error());

$num_rows = mysql_num_rows( $result );
if( $num_rows &gt; 0 ){

$script = &quot;&quot;;
while ($row = mysql_fetch_array( $result )) {
$time_s = $row[&quot;time_s&quot;];
$time_e = $row[&quot;time_e&quot;];
$bt_name = $row[&quot;name&quot;];
$b_level = $row[&quot;level&quot;];
echo '&lt;b&gt;Строительство:&lt;/b&gt; &lt;img src=&quot;img/res/time.png&quot;&gt;&lt;br&gt;'.$bt_name.' ( Уровень '.($b_level+1).' ) &amp;nbsp;&amp;nbsp;
&lt;span id=&quot;restimer'.$cnt.'&quot;&gt;&lt;/span&gt; &amp;nbsp;&amp;nbsp;Готово в '.date('H:i',$time_e).'&lt;br&gt;';
$rest = s2h($time_e-time());
$hms = explode(':', $rest); 
$script .= &quot;atimers[$cnt] = [ $hms[0], $hms[1], $hms[2] ]; &quot;; 
$cnt ++;

}
echo '&lt;script&gt;';
echo $script;
echo 'updateClock(); setInterval(&quot;updateClock()&quot;, 1000 );';
echo '&lt;/script&gt;';
}
}

</pre>
			Фрагмент 5.5.3<p>Вы видите, что изменения коснулись даже
			<span lang="en-us">sql-</span>запроса<span lang="en-us"> (</span>строки<span lang="en-us"> 
			4-14)</span>. В этом запросе объединяются два запроса. Первый, это 
			соединение таблиц&nbsp; job_upgrade,&nbsp; res_fields&nbsp; и 
			res_fields_types , второй - соединение таблиц job_upgrade, buildings 
			и building_types. Становится понятно, что основной источник данных 
			это таблица&nbsp; job_upgrade, фигурирующая в обоих запросах, просто 
			в первом из нее берутся данные для очереди апгрейда ресурсного поля 
			(условие jr_type=0), а во втором - данные по апгрейду или постройке 
			здания (условие jr_type=1). Далее, на основании полученных из нашего 
			составного запроса данных формируются строки очереди апгрейдов или 
			построек на экране браузера. Естественно, что их теперь может быть 
			больше чем одна. Даже идентификатор объекта <span lang="en-us">
			&lt;span&gt; </span>теперь формируется динамически (id=&quot;restimer'.$cnt). И 
			что самое интересное - данные для таймеров сохраняются в двумерный 
			массив <font color="#339933">atimers</font>.&nbsp;
			<span lang="en-us">JavaScript </span>функция <font color="#3B84D0">
			updateClock ( ) </font>уже оперирует данными из этого массива при 
			формировании таймеров обратного отсчета.<br>
			<br>
			Выглядит одновременный апгрейд примерно так:<br>
			<br>
			<img border="0" src="pics/upgr2.png" width="535" height="453"><br>
			Рисунок 5.5.1<br>
			<br>
			Вы видите, как одновременно строится амбар и апгрейдится ферма!<br>
			<br>
			И последнее - мы должны модифицировать процедуру
			<font color="#0000FF">check_end_upgrade</font>, которая будет 
			следить, не закончилась уже какая-нибудь очередь как для ресурсных 
			полей, так и для зданий? Вот эта функция с учетом модификаций:</p>
			<pre class="brush: php;">
///// Проверим, не пора ли заканчивать апгрейды ресурсных полей или зданий? ////////
function check_end_upgrade( $p_fid ){
$result = mysql_query(&quot;SELECT jru.jr_id, rf.rf_id as id, jru.time_s, jru.time_e, rf.rf_level as level, jru.jr_type from job_upgrade jru
inner join res_fields rf on rf.rf_id=jru.rf_id
where jr_type=0 and rf.fid=$p_fid

union 

SELECT jru.jr_id, b.bid as id, jru.time_s, jru.time_e, b.b_level as level, jru.jr_type from job_upgrade jru
inner join buildings b on b.bid=jru.rf_id
where jr_type=1 and b.fid=$p_fid&quot; ) 
or die(&quot;Query failed : &quot; . mysql_error());
$num_rows = mysql_num_rows( $result );
if( $num_rows &gt; 0 ){
  while ($row = mysql_fetch_array( $result )) {
    $jr_id = $row[&quot;jr_id&quot;];
    $id = $row[&quot;id&quot;];
    $time_e = $row[&quot;time_e&quot;];
    $rf_level = $row[&quot;level&quot;];
    $jr_type = $row[&quot;jr_type&quot;];

    $curtime = time();
    if( $time_e &lt;= $curtime ){ // Если время апгрейда завершилось ...
      $res = mysql_query(&quot;DELETE from job_upgrade where jr_id=$jr_id&quot; ) 
             or die(&quot;Query failed : &quot; . mysql_error());
       if ($jr_type == 0){
          $res = mysql_query(&quot;update res_fields set rf_level=rf_level+1 where rf_id=$id&quot; ) 
              or die(&quot;Query failed : &quot; . mysql_error());
       } else {
          $res = mysql_query(&quot;update buildings set b_level=b_level+1 where bid=$id&quot; ) 
              or die(&quot;Query failed : &quot; . mysql_error());
       }
   } 
  } 
}
}

</pre>
			Фрагмент 5.5.4<p>Здесь тоже составной запрос, как для ресурсных 
			полей, так и для зданий поселка. Возвращаемое запросом значение $id = $row[&quot;id&quot;]; 
			может быть как идентификатором здания, так и идентификатором 
			ресурсного поля. Распознать что есть что можно только анализируя 
			значение поля $jr_type = $row[&quot;jr_type&quot;]; (Вы помните, что 
			если это значение ноль - это апгрейд ресурсного поля, если 1 - 
			строительство ил апгрейд здания). И если время апгрейда завершилось 
			(текущее время больше чем значение в поле time_e из таблицы <b>job_upgrade</b> 
			) значит мы удаляем эту очередь (строки 25-25 ), а зетем, в 
			зависимости от того, поле это или здание - увеличиваем их уровень 
			(строки 26-32). <br>
			<br>
			Вызов процедур
			<font color="#0000FF">check_end_upgrade </font>и
			<font color="#0000FF">show_res_upgrade</font> можно вставить в файлы
			<span lang="en-us"><b>res.php</b> </span>и <span lang="en-us"><b>
			village.php</b>.</span></p>
			<p>На этом сегодняшнее занятие завершено, как всегда все файлы и 
			картинки, которые мы применили на нем Вы можете найти в папке
			<span lang="en-us"><a href="www">www</a></span>, а скрипт базы - в 
			папке <span lang="en-us"><a href="sql">sql</a></span>.<br>
			<br>
			<b>В следующем уроке</b> мы <span lang="ru">с Вами займемся 
			подготовкой к военным действиям и начнем строить в поселке, здания 
			причастные к созданию 
			</span>боевых юнитов для нападения и защиты наших владений от 
			посягательств недружелюбных соседей.<br>
            <br>
            </p>
            <p></p>
            <p></p></font>
            </td>
            <td background="index_files/m_right_m.gif" width="9"><img height="4" src="index_files/m_right_m.gif" width="9" border="0"></td>
          </tr>
        </tbody>
      </table>
      <table cellpadding="0" cellspacing="0" width="100%">
        <tbody>
          <tr>
            <td background="index_files/m_left_m.gif" width="9"></td>
            <td class="newsbody" bgcolor="#fdfdfd">&nbsp;</td>
            <td class="newsbody" bgcolor="#fdfdfd">
            <div class="nav" align="right">Blitz-School© </div>
            </td>
            <td background="index_files/m_right_m.gif" width="9"><img height="4" src="index_files/m_right_m.gif" width="9" border="0"></td>
          </tr>
        </tbody>
      </table>
      <table cellpadding="0" cellspacing="0" height="7" width="100%">
        <tbody>
          <tr>
            <td background="index_files/m_left_b.gif" width="13"><img height="7" src="index_files/m_left_b.gif" width="13" border="0"></td>
            <td background="index_files/m_center_b.gif"><img height="1" src="index_files/spacer.gif" width="1"></td>
            <td width="13"><img height="7" src="index_files/m_right_b.gif" width="13" border="0"></td>
          </tr>
        </tbody>
      </table>
      </div>
      </td>
      <td background="index_files/right_back.gif" valign="top" width="13">&nbsp;</td>
    </tr>
  </tbody>
</table>
<table cellpadding="0" cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td background="index_files/bottom_left.png" height="51" valign="top" width="254">
      <div class="date" style="MARGIN-TOP: 12px; FONT-SIZE: 10px; MARGIN-LEFT: 45px; COLOR: white"><a style="COLOR: rgb(255,255,255)" href  ="index.phtml">Copyright</a>©
2005-2009.
GameSchool</div>
      </td>
      <td background="index_files/bottom.gif" valign="top">
      <div class="date" style="MARGIN-TOP: 12px; FONT-SIZE: 10px; MARGIN-LEFT: 20px; COLOR: rgb(143,145,147)" 
      ><!-- Bottom menu --><a title="Главная страница" style="COLOR: rgb(143,145,147)" href  ="http://www.blitz-school.info/index.phtml">Главная</a><img height="1" src="index_files/spacer.gif" width="22" align="middle">:<img height="1" src="index_files/spacer.gif" width="22" align="middle"><a href="http://www.blitz-school.info/login.phtml"><span style="COLOR: rgb(143,145,147)"  >Вход</span></a><img height="1" src="index_files/spacer.gif" width="22" align="middle">:<img height="1" src="index_files/spacer.gif" width="22" align="middle"><a href="http://www.blitz-school.info/response.phtml"><span style="COLOR: rgb(143,145,147)" 
      >Отзывы</span></a><img height="1" src="index_files/spacer.gif" width="22" align="middle">:<img height="1" src="index_files/spacer.gif" width="22" align="middle"><a href="http://www.blitz-school.info/contacts.phtml"><span style="COLOR: rgb(143,145,147)" 
      >Контакты</span></a><img height="1" src="index_files/spacer.gif" width="22" align="middle">:<img height="1" src="index_files/spacer.gif" width="22" align="middle"><a href="http://www.blitz-school.info/friends.phtml"><span style="COLOR: rgb(143,145,147)" 
      >Обмен ссылками</span></a> </div>
      </td>
      <td width="19"><img height="51" src="index_files/bottom_right.png" width="19" border="0"></td>
    </tr>
  </tbody>
</table>
<div id="menu" onmouseover="showLayer('menu'); Change('products', 'menu2')" onmouseout="hiddenLayer('menu'); Change('products', 'menu1')">
<table border="0" cellpadding="0" cellspacing="0">
  <tbody>
    <tr>
      <td style="WIDTH: 7px; HEIGHT: 7px"><img height="7" alt="" src="index_files/corner1.gif" width="7"></td>
      <td class="top"></td>
      <td style="WIDTH: 7px; HEIGHT: 7px"><img height="7" alt="" src="index_files/corner2.gif" width="7"></td>
    </tr>
    <tr>
      <td class="left"></td>
      <td class="text"><a href="reg.phtml">Курс обучения созданию игр
на Blitz3D</a><br>
      <a href="reg2.phtml">Курс
обучения созданию браузерных онлайновых игр</a> </td>
      <td class="right"></td>
    </tr>
    <tr>
      <td style="BACKGROUND: 0% 50%; WIDTH: 7px; HEIGHT: 7px; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial" 
      ><img height="7" alt="" src="index_files/corner4.gif" width="7"></td>
      <td class="bottom"></td>
      <td style="WIDTH: 7px; HEIGHT: 7px"><img height="7" alt="" src="index_files/corner3.gif" width="7"></td>
    </tr>
  </tbody>
</table>
</div>

</body></html>
