<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
  
  <meta http-equiv="Content-Language" content="ru">
  
  <title>Центр обучения созданию компьютерных игр</title>
  <meta name="description" content="Blitz-School - Школа создателей компьютерных игр на языке Blitz3D. Если вы хотите быстро научиться делать компьютерные игры или интересуетесь их созданием, то этот сайт будет вам полезен">
  <meta name="keywords" content="программирование, создание игр, курсы создания игр, школа создателей компьютерных игр, blitzbasic, компьютерные игры, как написать игру, как создать игру, программирование компьютерных игр, Blitz3D, программирование игр, разработка игр, создание 3d игр, аудио, графика, дизайн, 3D">
  <link rel="stylesheet" type="text/css" href="main.css">
  <script language="JavaScript" src="index_files/script.js" type="text/javascript"></script>
  <script type="text/javascript" src="scripts/shCore.js"></script>
  <script type="text/javascript" src="scripts/shBrushBash.js"></script>
  <script type="text/javascript" src="scripts/shBrushCpp.js"></script>
  <script type="text/javascript" src="scripts/shBrushCSharp.js"></script>
  <script type="text/javascript" src="scripts/shBrushCss.js"></script>
  <script type="text/javascript" src="scripts/shBrushDelphi.js"></script>
  <script type="text/javascript" src="scripts/shBrushDiff.js"></script>
  <script type="text/javascript" src="scripts/shBrushGroovy.js"></script>
  <script type="text/javascript" src="scripts/shBrushJava.js"></script>
  <script type="text/javascript" src="scripts/shBrushJScript.js"></script>
  <script type="text/javascript" src="scripts/shBrushPhp.js"></script>
  <script type="text/javascript" src="scripts/shBrushPlain.js"></script>
  <script type="text/javascript" src="scripts/shBrushPython.js"></script>
  <script type="text/javascript" src="scripts/shBrushRuby.js"></script>
  <script type="text/javascript" src="scripts/shBrushScala.js"></script>
  <script type="text/javascript" src="scripts/shBrushSql.js"></script>
  <script type="text/javascript" src="scripts/shBrushVb.js"></script>
  <script type="text/javascript" src="scripts/shBrushXml.js"></script>
  <script type="text/javascript" src="scripts/shBrushBlitz3D.js"></script>
  <link type="text/css" rel="stylesheet" href="styles/shCore.css">
  <link type="text/css" rel="stylesheet" href="styles/shThemeDefault.css">
  <script type="text/javascript">
SyntaxHighlighter.config.clipboardSwf = 'scripts/clipboard.swf';
SyntaxHighlighter.all();
  </script>
  <meta content="MSHTML 6.00.6000.20772" name="GENERATOR"></head>

<body topmargin="0" leftmargin="0" style="BACKGROUND-COLOR: rgb(255,255,255)" marginheight  ="0" marginwidth="0">
<table cellpadding="0" cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td rowspan="2" height="197" width="21"><img height="197" src="index_files/ltoptable.png" width="21" border="0"></td>
      <td colspan="5" valign="top">
      <table cellpadding="0" cellspacing="0" width="100%">
        <tbody>
          <tr>
            <td height="49" width="231"><img height="49" src="index_files/topmenu.png" width="231" usemap="#ImageMap1" border="0"></td>
            <td background="index_files/mtop.gif"><map name="ImageMap1"><area onclick="this.style.behavior='url(#default#homepage)';this.setHomePage('http://www.blitz-school.info'); return false;" shape="RECT" coords="17,26,71,40" href="index.phtml"><area shape="RECT" coords="91,27,149,39" href="javascript:window.external.AddFavorite('http://www.blitz-school.info', 'GameSchool - Центр обучения созданию компьютерных игр!')"></map>
            <div class="searchform" align="right">
            <form method="post"><input value="search" name="do" type="hidden">&nbsp;</form>
            </div>
            </td>
            <td height="49" width="13"><img height="49" src="index_files/mlefttop.png" width="13" border="0"></td>
          </tr>
        </tbody>
      </table>
      </td>
    </tr>
    <tr>
      <td height="148" valign="top" width="225">
      <table cellpadding="0" cellspacing="0" height="148" width="100%">
        <tbody>
          <tr>
            <td height="119" width="225"><a title="Центр обучения созданию компьютерных игр" href="index.phtml"><img height="119" src="index_files/title.png" width="225" border="0"></a></td>
          </tr>
          <tr>
            <td background="index_files/date_b.png" valign="bottom">
            <div class="date" style="FONT-SIZE: 11px; MARGIN-BOTTOM: 10px; MARGIN-LEFT: 12px">
            <script language="JavaScript1.2">
<!-- Begin
var months=new Array(13);
months[1]="января";
months[2]="февраля";
months[3]="марта";
months[4]="апреля";
months[5]="мая";
months[6]="июня";
months[7]="июля";
months[8]="августа";
months[9]="сентября";
months[10]="октября";
months[11]="ноября";
months[12]="декабря";
var time=new Date();
var lmonth=months[time.getMonth() + 1];
var date=time.getDate();
var year=time.getYear();
var hours=time.getHours();
var minutes=time.getMinutes();
if (eval(hours) <10) {hours="0"+hours}
if (eval(minutes) < 10) {minutes="0"+minutes}
if (year < 2000)
year = year + 1900;
document.write("Сейчас: " + date + " ");
document.write(lmonth + " " + year + ", " + hours + ":" + minutes + " ");
// End -->
            </script></div>
            </td>
          </tr>
        </tbody>
      </table>
      </td>
      <td width="296"><img height="148" src="index_files/mainleft.jpg" width="296" border="0"></td>
      <td width="205"><img height="148" src="index_files/mainright.jpg" width="205" border="0"></td>
      <td background="index_files/mback.png">&nbsp;</td>
      <td height="148" width="58"><img height="148" src="index_files/mltopr.png" width="58" border="0"></td>
    </tr>
  </tbody>
</table>
<table bordercolordark="black" bordercolorlight="black" cellpadding="0" cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td background="index_files/anek_tb.png" height="27" valign="top" width="254">
      <div class="lefttext"><b>Меню:</b></div>
      </td><?php include 'menu_top.php'; ?> <td background="index_files/nav_back.gif">&nbsp;</td>
      <td width="17"><img height="27" src="index_files/nav_end.png" width="17" border="0"></td>
    </tr>
  </tbody>
</table>
<table cellpadding="0" cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td background="index_files/lefttable.gif" valign="top" width="254"><!-- Menu -------->
      <div style="MARGIN-LEFT: 21px">
      <table cellpadding="0" cellspacing="0">
        <tbody>
          <tr>
            <td background="index_files/tb_back.gif">
            <div class="style3"><img src="index_files/home.gif"><a href="http://www.blitz-school.info/index.phtml">Главная</a><br>

        <img src="index_files/pages.gif"> <b>Перечень курсов</b><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/blitzindex.phtml">Создание 3D игр на Blitz3D</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/ogindex.phtml">Создание браузерной РПГ</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/egindex.phtml">Создание экономической браузерки</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/mgindex.phtml">Создание мобильных игр</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/cppindex.phtml">Создание 3D игр на С++</a><br>
        <img src="index_files/group.gif"> <a href="http://www.blitz-school.info/begin_study.phtml">Как стать слушателем</a><br>
        <img src="index_files/recom.gif"> <a href="http://www.blitz-school.info/study_tech.phtml">Технология обучения</a><br>
        <img src="index_files/loyalty_sm.jpg"> <a href="http://www.blitz-school.info/loyalty.phtml">Программа лояльности</a>
        <br>
&nbsp;&nbsp;&nbsp;&nbsp;
    <img border="0" src="index_files/navdiv.gif" width="80" height="4">
        <br><img src="index_files/newuser.gif"> <b>Регистрация</b><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/reg.phtml">Курс 3D игр на Blitz3D</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/reg2.phtml">Курс браузерной RPG</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/reg3.phtml">Экономическая браузерка</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/reg4.phtml">Курс мобильных игр</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/reg5.phtml">3D игры на С++</a><img src="index_files/new.gif"><br>
        <img src="index_files/admin.gif"> <a href="http://www.blitz-school.info/login.phtml">Вход для слушателей</a><br>
        <img src="index_files/study.gif"> <a href="http://www.blitz-school.info/program.phtml">Учебные программы курсов</a><br>
        <img src="index_files/society.gif"> <a href="http://www.blitz-school.info/response.phtml">Отзывы</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;
    <img border="0" src="index_files/navdiv.gif" width="80" height="4">
        
        <br><img src="index_files/media.gif"> <a href="http://www.blitz-school.info/distant.phtml">О дистанционном образовании</a><br>
        <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/articles.phtml">Статьи</a><br>
        <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/less_ex.phtml">Изложение материала</a><br>
        <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/gallery.phtml">Галерея</a><br> 
        <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/links.phtml">Полезные ссылки</a><br>
        <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/contacts.phtml">Контакты</a><br>
       <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/friends.phtml">Обмен ссылками</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;

            </div>
            </td>
          </tr>
          <tr>
            <td width="222"><img height="8" src="index_files/tb_b.gif" width="222" border="0"></td>
          </tr>
        </tbody>
      </table>
      </div><!-- ------------------ end of menu ------------------- --> </td>
      <td class="news" valign="top">
      <script language="javascript" type="text/javascript">
      </script>
      <div style="MARGIN-TOP: 7px">
      <table cellpadding="0" cellspacing="0" width="100%">
        <tbody>
          <tr>
            <td width="13"><img height="24" src="index_files/m_left.gif" width="13" border="0"></td>
            <td class="newstitle" background="index_files/m_center.gif">
            <b>Занятие
<span lang="en-us">3</span></b></td>
            <td class="newstitle" align="right" background="index_files/m_center.gif">&nbsp;</td>
            <td width="9"><img height="24" src="index_files/m_right.gif" width="9" border="0"></td>
          </tr>
        </tbody>
      </table>
      <table cellpadding="0" cellspacing="0" width="100%">
        <tbody>
          <tr>
            <td background="index_files/m_left_m.gif" width="4">&nbsp;</td>
            <td class="newsbody" bgcolor="#fdfdfd">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <font size="3"><b>Глобальная карта мира</b></font><br>
            <br>
            <span lang="en-us"><font color="#4775A5"><b>3</b></font></span><b><font color="#4775a5">.1. 
			Таблица участков карты </font><br>
            <br>
&nbsp;</b><span lang="en-us">&nbsp;</span>Мы снова рады приветствовать Вас, дорогой коллега! 
			На нашем третьем с Вами занятии мы рассмотрим вопрос глобальной 
			карты мира.<span lang="en-us">&nbsp; </span>Безусловно мы не станет 
			ее делать столь масштабной, как в игре <span lang="en-us">Travian</span>, 
			потому что у нас в учебных целях в нашем мире живет пока совсем 
			немного персонажей и чтоб обеспечить их тесное соседство, создадим 
			карту - 15<span lang="en-us">x</span>15. То есть у нас будет 15<span lang="en-us">x</span>15=225 
			зон для организации поселков наших персонажей из таблицы
			<span lang="en-us"><b>users</b>.<br>
&nbsp; </span>В прошлом уроке Вы научились регистрировать новых игроков в нашей 
			с Вами игре, а так как наш проект игры учебный и базу часто 
			приходится пересоздавать с нуля, то есть предложения - сразу, в 
			скрипте создать в таблице <span lang="en-us">users</span> парочку 
			персонажей, чтоб каждый раз не проходить утомительную процедуру 
			регистрации после изменения структуры базы. <br>
&nbsp; Теперь вспомните&nbsp; фрагмент 2.1.1 из прошлого урока и сейчас мы 
			добавим в него пару строк (теперь это будет фрагмент 3.1.1):<br>
<pre class="brush: sql;">/*Таблица персонажей*/
CREATE TABLE `users` (
   usr_id                        bigint(20) unsigned NOT NULL auto_increment, /*ID игрока*/
   nick                          CHAR(32) UNIQUE,                             /*ник игрока (уникальный, при регистрации)*/
   pass                          CHAR(32),                                    /*пароль игрока (задается при регистрации)*/
   uniq_id                       varchar(50) NOT NULL default '',             /*уникальный идентификатор сессии*/
   stat                          int(1) not null default 0,                   /*подтверждена регистрация 0/1*/
   email                         CHAR(64),                                    /*почтовый ящик игрока*/
   full_name                     CHAR(50),                                    /*реальное имя игрока*/
   regdate                       timestamp,                                   /*дата регистрации*/
   user_gender                   SMALLINT(1),                                 /*пол игрока и перса*/
   gold                          FLOAT DEFAULT 0,                             /*золотых монет*/
  PRIMARY KEY  (`usr_id`)
) ENGINE=MyISAM DEFAULT CHARSET=cp1251;

ALTER TABLE users auto_increment = 100;

insert into users (nick,pass,email,stat ) values ('test','1234','test_travgame@mail.ru',1);
insert into users (nick,pass,email,stat ) values ('Суперигрок','1234','super_travgame@mail.ru',1);
</pre>Фрагмент 3.1.1<p>О чем же нам повествуют новые три строчки: В 16 строке 
			фрагмента 3.1.1 мы устанавливаем число начала отсчета для поля usr_id 
			(в таблице только одно поле может быть автоинкрементным и у нас в
			<span lang="en-us">users </span>это поле usr_id ). Таким образом все 
			регистрирующиеся персонажи начнут свой отсчет со 100. Здесь мы 
			просто зарезервировали первый 99 номеров для usr_id, может они нам 
			понадобятся для каких-то неигровых персонажей (<span lang="en-us">NPC)</span>, 
			так, на всякий случай!<br>
			Далее, в строках 18 и 19 фрагмента 3.1.1 мы добавляем двух игроков с 
			никами <font color="#0157B7">test</font> и <font color="#0157B7">Суперигрок</font> 
			в таблицу <b>users</b>. Таким образом, при выполнении скрипта
			<span lang="en-us">travgame.sql </span>у нас в игре сразу будут два 
			игрока, благодаря которым мы будем тестировать создаваемые на наших 
			занятиях все новые и новые возможности нашей с Вами стратегической 
			игры. После выполнения этого скрипта, Вы увидите, что таблица <b>users
			</b>уже имеет две записи.<br>
&nbsp; Итак, у нас есть игроки, нам нет необходимости пока что регистрировать 
			новых через форму в файле <span lang="en-us">regank.php </span>и мы 
			сейчас займемся более полезным делом - создадим таблицу участков 
			карты, на двух из которых поселятся наши игроки
			<font color="#0157B7">test</font> и <font color="#0157B7">Суперигрок</font>.<br>
			Вот как выглядит эта таблица, которую мы назовем <b>fields</b> (по 
			англ. - поля)<br>
            </p>
<pre class="brush: sql;">/*Таблица незанятых полей общей карты и также деревни игрока, если есть usr_id*/
CREATE TABLE `fields` (
fid bigint(20) unsigned NOT NULL auto_increment, /*ID поля*/
xcoord int,
ycoord int,
fid_type int, /*тип поля: 1,2,3,4*/
usr_id int default 0, /*связан с игроком?*/
-- сколько ресурсов?
f_grain int default 700, /* нач. кол-во зерна */
f_ore int default 700, /* нач. кол-во руды */
f_wood int default 700, /* нач. кол-во дерева */
f_clay int default 700, /* нач. кол-во глины */

PRIMARY KEY (`fid`)
) ENGINE=MyISAM DEFAULT CHARSET=cp1251;
</pre>Фрагмент 3.1.2<p>Вы смело можете добавить создание этой таблицы в наш 
			скрипт <span lang="en-us">travgame.sql </span>и выполнить его (мы 
			предполагаем, что Вы работаете в <b>dbForge Studio 
			for MySQL</b> как более удобном средстве разработки баз данных
			<span lang="en-us">mySQL </span>чем <b><span lang="en-us">PHPMyAdmin</span></b>).<br>
			Давайте разберемся, для чего предназначены поля в нашей с Вами 
			таблице <span lang="en-us"><b>field</b></span><b>s</b>.<br>
			<b><br>
			fid</b> <span lang="en-us">- </span>будет хранить уникальный 
			идентификационный номер участка глобальной карты и автоматом будет 
			увеличиваться на единицу для каждого нового участка (вы помните, что 
			мы планируем 255 участков).<br>
			<b>xcoord</b>, <b>ycoord</b> - это координаты участка в нашем мире.<br>
			<b>fid_type</b> - тип участка. В начальной стадии разработки игры мы 
			будем использовать его для рисования отличающихся картинок участков 
			карты. Потому запланируем для него номера с 1 до 4 (будет четыре разных 
			картинки, например такие:&nbsp;
			<img border="0" src="www/img/fld2.png" width="73" height="41"><img border="0" src="www/img/fld1.png" width="73" height="41"><img border="0" src="www/img/fld3.png" width="73" height="41"><img border="0" src="www/img/fld4.png" width="73" height="41">)<br>
			<b>usr_id</b> - это поле содержит либо 0 (значит поле ничейное), 
			либо хранит идентификатор из таблицы<b> <span lang="en-us">users
			</span></b>и это значит что здесь размещен поселок игрока с 
			идентификатором <b>usr_id.</b><br>
			<b>f_grain</b> , <b>f_ore</b> , <b>f_wood</b> , <b>f_clay</b>&nbsp; 
			- это начальные ресурсы (зерно, руда, дерево, глина), которые 
			закрепляются за этим участком (и по умолчанию они равны по
			<font color="#FF0000">700</font> для каждого ресурса).<br>
			Для начала - достаточно. Со временем, возможно, мы немного расширим 
			таблицу <span lang="en-us"><b>fields</b>.</span><br>
            <br>
            <br>
            <span lang="en-us"><font color="#4775A5"><b>3</b></font></span><b><font color="#4775a5">.2. </font></b>
			<font color="#4775A5"><b>Процедура генерации полей карты</b></font><br>
            <br>
			&nbsp;Сейчас, перед нами возник вопрос инициализации всех полей в 
			создаваемой нами игре.&nbsp; Конечно мы может 255 раз написать
			<span lang="en-us">SQL-</span>запрос <span lang="en-us">INSERT</span>, 
			но это не интересно и поступило предложение сделать хранимую 
			процедуру на языке <span lang="en-us">mySQL</span>, чтоб генерация 
			участков в таблице <span lang="en-us"><b>fields</b> </span>выглядела 
			более компактно.<span lang="en-us"> </span>&nbsp;Так как мы 
			планируем<span lang="en-us">
			</span> не более 4 типов картинок для незанятых под поселки 
			участков, то, следовательно процедура должна случайным образом<span lang="en-us">
			</span> формировать значение в поле fid_type <span lang="en-us">&nbsp;</span>таблицы
			<b>field</b><span lang="en-us"><b>s</b>. </span>Но если Вы, вдруг<span lang="en-us">,</span> 
			захотите увеличить количество картинок до 5 или 10, то лучше это 
			предусмотреть сразу и, поэтому, мы будет передавать в процедуру 
			генерации полей два аргумента:<span lang="en-us"><br>
			<br>
			</span>1 - начальный номер генерируемого поля<span lang="en-us"><br>
			</span>2 - конечный номер генерируемого поля<span lang="en-us"><br>
			<br>
			</span>Итак, встречайте нашу процедуру, которая называется <b>
			<span lang="en-us">makefields</span></b> :<br>
            </p>
<pre class="brush: sql;">-- процедура по генерированию случаных типов незанятых полей (участков) --
create procedure makefields (param1 int, param2 int)
BEGIN
 declare x int default 1;
 declare y int default 1;
 declare st int default 0;
 WHILE y &lt;= 15 DO
   WHILE x &lt;= 15 DO
     SET st = RAND()*10 / (10 + 1) * ((param2 - param1) + param1)+0.5;
     insert into fields (xcoord,ycoord,fid_type) values (x,y,st);
     SET x = x+1;
   END WHILE;
   SET x = 1;
   SET y = y+1;
 END WHILE;
END;
</pre>Фрагмент 3.2.1<p>Кратко опишем код во фрагменте 3.2.1. В строке<span lang="en-us">
			</span> 1 мы объявляем создание процедуры с именем makefields
			<span lang="en-us">
			и</span> указываем, что ей нужно передавать два аргумента (param1 и param2<span lang="en-us">,</span> 
			оба имеющие тип -<span lang="en-us"> </span>целое число (<span lang="en-us">int</span>))<span lang="en-us">.
			</span> В строках с 4-6 мы объявляем три переменные <b>x</b>,<b>y</b> 
			и <b>st</b>, которые будем использовать далее. В строках 7-8 мы 
			открываем два цикла по координатам <span lang="en-us">x </span>и
			<span lang="en-us">y (</span>это обе наши ранее объявленные 
			переменные<span lang="en-us">)</span>. Так как каждый из этих циклов 
			повторяется с 1 до 15, то, все что идет далее до <span lang="en-us">
			с</span>троки 12 - повторится 15х15=225 <span lang="en-us">р</span>аз. 
			А это, не что иное как строки с 9 по 11<span lang="en-us">.</span> В 
			9 строке мы генерируем случайное число в диапазоне от param1<span lang="en-us">
			</span>до param2<span lang="en-us">.</span> Это стандартная формула 
			создания диапазона случайных чисел. И если мы <span lang="en-us">п</span>ередадим 
			в процедуру makefields аргументы 1 и 4<span lang="en-us">,</span>
			<span lang="en-us">т</span>о в строке 9 в переменную <b>st </b>
			сгенерируется число от одного до четырех и никак не иначе.<span lang="en-us"><br>
			</span>Далее, в строке 10 Вы видите оператор <span lang="en-us">SQL 
			INSERT </span>, который вставляет значения переменных <b>x</b>,<b>y</b><span lang="en-us">
			</span>и <span lang="en-us">с</span>генерированного значения 
			переменной <b><span lang="en-us">st</span></b><span lang="en-us">
			</span>в<span lang="en-us"> </span>подготовленную нами ранее<span lang="en-us">
			</span>&nbsp;таблицу <b>fields</b><span lang="en-us">.<br>
			<br>
			</span>Попробуйте добавить фрагмент 3.2.1 к нашему файлу
			<span lang="en-us">travgame.sql </span>и выполнить его. Конечно же 
			эта процедура не создаст Вам ничего и поэтому нужно ее вызвать:<br>
            </p>
<pre class="brush: sql;">-- пройдемся по всем полям --------
CALL makefields(1,4);</pre>
			<p>Фрагмент 3.2.2<br>
			<br>
			Вставьте этот фрагмент чуть ниже тела процедуры из предыдущего 
			фрагмента 3.2.1<br>
			Выполните скрипт <span lang="en-us">travgame.sql</span>.<br>
			<br>
			Если возникнет ошибка базы данных <span lang="en-us">mysql </span>
			связанная со стеком, сделайте следующее. Зайдите в
			<a href="file:///C:/WebServers/usr/local/mysql-5.1">
			C:\WebServers\usr\local\mysql-5.1</a><span lang="en-us"> </span>и 
			откройте текстовым редактором (например блокнотом)<span lang="en-us">
			</span>файл <span lang="en-us"><b>my.cnf</b> </span>и найдите в нем 
			такую строку&nbsp; <br>
			<font color="#3B84D0">thread_stack = <span lang="en-us">&lt;</span>какое-то 
			значение (обычно 128 К)</font><span lang="en-us"><font color="#3B84D0">&gt;</font><br>
			</span>исправьте на <br>
			<font color="#3B84D0">thread_stack = 256K</font><br>
			Сохраните измененный файл <span lang="en-us"><b>my.cnf</b>. </span>
			Перегрузите пакет <span lang="en-us">Denwer </span>и снова 
			попытайтесь выполнить <span lang="en-us">sql-с</span>крипт, 
			содержащийся в <span lang="en-us">travgame.sql</span>.</p>
			<p>В результате мы получим заполненную значениями таблицу <b>fields</b>. 
			Откройте ее <span lang="en-us">в</span> <b>dbForge Studio 
			for MySQL</b>.<span lang="en-us"><br>
			</span>Вы должны увидеть что-то типа:<span lang="en-us"><br>
			<br>
			<img border="0" src="pics/fields.png" width="499" height="229"><br>
			<br>
			</span>Рисунок
			3.2.1<span lang="en-us"><br>
			<br>
			</span>Безусловно, значения в поле <span lang="en-us">
			<font color="#3B84D0">fid_type</font> </span>будут у Вас другими, 
			так как формируются случайным образом.<span lang="en-us"><br>
			<br>
			</span>Теперь давайте зарезервируем два из 255 созданных поля под 
			поселки для наших персонажей <span lang="en-us">test </span>и 
			Суперигрок<span lang="en-us">: </span><br>
            </p>
<pre class="brush: sql;">-- резервируем поле для нашего тестового персонажа
update fields set usr_id = 100 where fid = 49;
update fields set usr_id = 101 where fid = 52;</pre>
			<p>Фрагмент 3.2.3</p>
			<p>Поля с идентификаторами 49 и 52 мы выбрали просто так, но чтоб 
			эти поля были неподалеку друг от друга.<span lang="en-us"><br>
			</span>Выставьте и этот фрагмент <span lang="en-us">в</span>
			<span lang="en-us">travgame.sql</span> и выполните. Теперь у нас 
			есть все условия для визуализации игровой карты.<span lang="en-us"><br>
			</span> <br>
            <br><span lang="en-us"><font color="#4775A5"><b>3</b></font></span><font color="#4775a5"><font ><b>.3. 
			Изометрическая визуализация полей
     </b></font><br></font>
            <br>
&nbsp;&nbsp; <span lang="en-us">Е</span>сли<span lang="en-us"> </span>Вы играли 
			в <span lang="en-us">travian</span>, то наверняка помните как 
			интересно в нем отображается карта полей<span lang="en-us"> </span>- 
			имитирует изометрическое расположение<span lang="en-us">.</span> Мы 
			с Вами сейчас попробуем сделать что-то подобное. Все участки карты у 
			нас уже сформированы процедурой makefields, но перед попыткой 
			показать на страничке браузера нашу карту, давайте сделаем 
			авторизацию игрока в создаваемой нами игре. Цель поставим следующую 
			- игрок набирает в браузере <span lang="en-us">url </span>игры -
			<span lang="en-us"><a href="http://travgame">http://travgame</a> -
			</span>попадает на страничку авторизации, вводит логин и пароль 
			(например <span lang="en-us">test </span>и 1234) входит в игру и 
			сразу видит перед собой карту участков. Не сложно? Тогда - вперед!<br>
&nbsp;&nbsp; Нашу стартовую страницу игры назовем стандартно -
			<span lang="en-us"><b>index.php</b>. </span>Весь функционал ее будет 
			составлять форма с двумя полями ввода и кнопкой входа в игру. Ну 
			ладно, сделаем еще какую-нибудь картинку, чтоб выглядело это чуть 
			веселее и сделаем пару надписей с названием нашей игры!<br>
			Форма для ввода логина и пароля проста:<br>
            </p>
<pre class="brush: html;">&lt;form id=&quot;loginForm&quot; name=&quot;loginForm&quot; action=&quot;auth.php&quot; method=&quot;post&quot;&gt; 
&lt;div id=&quot;formz&quot;&gt;
&lt;table cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; id=&quot;logindata&quot; width=&quot;392&quot;&gt;
&lt;tr&gt;
&lt;td width=&quot;148&quot;&gt;&lt;label&gt;Имя игрока&lt;br&gt;&lt;/label&gt;
&lt;input id=&quot;login&quot; name=&quot;name&quot; type=&quot;text&quot; class=&quot;login&quot; /&gt;&lt;/td&gt;
&lt;td width=&quot;152&quot;&gt;&lt;label&gt;Пароль&lt;br&gt;&lt;/label&gt;
&lt;input id=&quot;pwd&quot; name=&quot;password&quot; type=&quot;password&quot; class=&quot;pass&quot; /&gt;&lt;/td&gt;
&lt;td width=&quot;145&quot;&gt;
&lt;input type=&quot;submit&quot; class=&quot;button&quot; value=&quot;Вход&quot; name=&quot;loginMode&quot;&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/form&gt;
</pre>
Фрагмент 1.3.1<br>
			<br>
			Мы не будем нагружать описания уроков всеми строками из некоторых 
			простых страниц, а будем приводить только основные их части. Имейте 
			это в виду! Страницу <b>
			<span lang="en-us">index.php</span> </b>целиком Вы можете найти и 
			изучить ее содержимое <a href="www">здесь</a>.<br>
			<br>
			Выглядит наша страница авторизации следующим образом:<br>
			<br>
			<img border="0" src="pics/index.png" width="551" height="266"><p>В 
			приведенном выше фрагменте нас интересует только имя формы (loginForm и ее action , 
			который передает данные в <b>auth.php</b>), имена полей для ввода 
			логина (name) и пароля (password), а также имя кнопки Вход (loginMode). 
			Вы уже знаете из Занятия 2 как действует форма отправки данных на 
			сервер. Наверно вы догадались, что передаются эти данные в скрипт 
			авторизации - <b>auth.php</b>. и сейчас мы создадим этот скрипт, 
			ведь авторизация игрока в игре - дело немалой важности!<br>
			Встречайте скрипт авторизации:<br>


            </p>


<pre class="brush: php;">
&lt;?php
session_start();

@include(&quot;config.inc.php&quot;);

//Необходимо подключиться к БД
$link = mysql_connect($DBSERVER, $DBUSER, $DBPASS)
or die(&quot;Не могу подключиться&quot; );
// сделать $DB текущей базой данных
mysql_select_db($DB, $link) or die ('Не могу выбрать БД');

// данные отправлены
if( ($_POST['name'] !='') &amp;&amp; ($_POST['password'] !='') ) {

  //Создаем запрос к базе для проверки существования Пользователя
  $name = mysql_escape_string( $_POST['name'] );
  $pass = mysql_escape_string( $_POST['password'] );

  $result = mysql_query(&quot;SELECT * FROM users WHERE stat=1 and nick='&quot;.$name.&quot;' and pass='&quot;.$pass.&quot;'&quot;);
  //Проверка результата запроса
  if(mysql_affected_rows()!=0) {
    $row = mysql_fetch_array( $result );
    $usr_id = $row[&quot;usr_id&quot;];
    // запомним uid сессии
    $uniq_id = md5($_SERVER['REMOTE_ADDR'].$_SERVER['HTTP_USER_AGENT'].mktime());
    mysql_query(&quot;update users set uniq_id = '$uniq_id' WHERE nick='&quot;.$name.&quot;' and pass='&quot;.$pass.&quot;'&quot;);
    $_SESSION['name'] = $name;
    $_SESSION['usr_id'] = $usr_id;
    $_SESSION['uid'] = $uniq_id;
    header(&quot;Location: game.php&quot;);
  } else { echo &quot;Ошибка авторизации!&quot;; }

} else { echo 'Вы не заполнили логин и/или пароль &lt;br/&gt;&lt;a href=&quot;index.php&quot;/&gt;назад&lt;/a&gt;'; }

?&gt;
</pre>
			Фрагмент 3.3.1<p>Кратко опишем работу скрипта. Вначале считываем 
			данные для коннекта к базе из файла config.inc.php и соединяемся с 
			базой. Это мы уже делали во втором занятии.&nbsp; В 13 строке 
			проверяем наличие данных логина и пароля (отправлены ли они из 
			формы, не пустые ли эти значения?). Далее стандартной функцией mysql_escape_string 
			мы очищаем строки от ненужных данных - это простейшая защита от
			<span lang="en-us">sql-</span>инъекций (а вдруг кто-то захочет 
			взломать нашу игру? :) ) В строке 19 мы выполняем <span lang="en-us">
			sql-</span>запрос для нахождения игрока в таблице <span lang="en-us">
			users </span>с данными логином и паролем и конечно же проверяем его 
			статус (<span lang="en-us">stat=1 - </span>прошел ли он 
			подтверждение регистрации?) Если строка, удовлетворяющая этому 
			условия нашлась, создадим переменную $uniq_id (смотрите строку 25 
			скрипта) , мы такое уже тоже делали на прошлом занятии. Значение 
			этой переменной запишем в поле uniq_id таблицы <span lang="en-us">
			<b>users </b></span>и<b> </b>в сессионную переменную $_SESSION['usr_id']
			<span lang="en-us">. </span>Потом на всех страницах мы будем 
			сравнивать эти значения, что оградит нас от несанкционированного 
			запуска этих страниц без авторизации. Кроме того, сохраним и логин 
			игрока в переменной сессии $_SESSION['name'], это нам тоже 
			приходится!<br>
			<br>
			В строке 30 мы передаем управление в файл <b>game.php</b>. Для 
			начала это будет наша главная страница игры. Что? у нас еще нет 
			этого файла? Так давайте сделаем его!<br>
			<br>
			Как уже указывалось, на всех страницах мы будем сравнивать значение $_SESSION['usr_id']&nbsp; 
			с полем uniq_id из таблицы <span lang="en-us">users </span>, если 
			они не совпадают, значит выдавать сообщение, чтоб игрок вначале 
			авторизовался.<br>
			Вот как мы это сделаем в нашем файле <b>game.php</b>.</p>


<pre class="brush: php;">
$name = $_SESSION['name'];

// проверим уникальный id сессии сохраненный в таблице
$result = mysql_query(&quot;SELECT u.uniq_id, f.xcoord, f.ycoord FROM users u join fields f on u.usr_id=f.usr_id WHERE nick='$name'&quot;) 
or die(&quot;Query failed : &quot; . mysql_error());
//Проверка результата запроса
if(mysql_affected_rows()!=0) {
  $row = mysql_fetch_array( $result );
  $sess_id = $row[&quot;uniq_id&quot;];

  if( $_SESSION['uid'] !== $sess_id ) die ( &quot;Ошибка авторизации!&quot; );

} else { die( &quot;Авторизируйтесь в игре!&quot; ) ; }


</pre>
			Фрагмент 3.3.2<p>Вот нам и пригодилась переменная сессии $_SESSION['name']. 
			Мы узнаем логин игрока и передаем его в <span lang="en-us">SQL-</span>запрос 
			(строка 4 фрагмента 3.3.2). Вернет ли это запрос нам данные или нет 
			(это проверяется в строке 7). Если нет - предлагаем игроку 
			авторизоваться в игре! Если да, то далее мы считываем значение из поля uniq_id и еще чуть ниже сравниваем его&nbsp; с $_SESSION['uid']. 
			Если эти значения не совпадают, выдаем сообщение &quot;Ошибка 
			авторизации!&quot;.<span lang="en-us"> <br>
&nbsp;&nbsp; <br>
			</span>Вы наверно заметили, что в запросе (строка 4 фрагмента 3.3.2) 
			мы пытаемся узнать координаты поселка игрока. Этих координат в 
			таблице <span lang="en-us">users</span>, но они есть в таблице
			<span lang="en-us">fields</span>, которая связана с таблицей
			<span lang="en-us">users </span>по полю usr_id (присутствующему в 
			обоих таблицах). Ключевое слово join объединяет эти две таблицы и мы 
			можем получить координаты из таблицы <b><span lang="en-us">fields</span></b>, 
			несмотря на то что поиск (WHERE nick='$name') осуществляем по 
			таблице <b><span lang="en-us">users</span></b>.<br>
			Как Вы думаете , зачем нам эти координаты поселка игрока? Правильно, 
			чтоб отцентрировать карту по координатам этого поселка! Давайте 
			поставим условия, что отображать карту будем фрагментарно - не более 
			чем 7х7=49 видимых участков (Вы помните, что всего у нас 15х15=255 
			участков). Остальные будем показывать скроллингом карты вправо-влево 
			и вверх-вниз.<br>
			Что ж, считаем координаты и произведем необходимые вычисления:</p>


<pre class="brush: php;">
$max_fields = 15;

$x = $row[&quot;xcoord&quot;];
$y = $row[&quot;ycoord&quot;];

// Отцентрируем карту
if($x&lt;4) $x=4;
if($x&gt;($max_fields-3) ) $x = $max_fields-3;
if($y&lt;4) $y=4;
if($y&gt;($max_fields-3) ) $y = $max_fields-3;
// --
</pre>
			Фрагмент 3.3.2<p>Здесь мы делаем проверки расположения поселка. Если 
			поселок находится близко к какой-то границе карты, конечно мы не 
			сможем его отцентрировать, поэтому нам придется выбирать в качестве 
			центра другую ячейку, в других случаях - центром карты будет наш 
			поселок.<br>
			<br>
			Визуализацию поселка сделаем через <span lang="en-us">JavaScript
			</span>процедуру, потому что скроллинг карты будем делать без 
			перезагрузки всей страницы <b>game.php</b>. Так ведь будет красивее, 
			не правда ли?&nbsp; Технология <span lang="en-us">Ajax </span>
			поможет нам в этом.<br>
			Наступило время создать файл, где мы будем хранить все необходимые
			<span lang="en-us">JavaScript </span>функции. Назовем его
			<span lang="en-us"><b>main.js</b> </span>и добавим в него несколько 
			функций. Для начала это будет функция инициализация
			<span lang="en-us">Ajax-</span>объекта.</p>


<pre class="brush: js;">
function ajaxobj()
{
var objXMLHttp = null;
if (window.XMLHttpRequest)
{
objXMLHttp = new XMLHttpRequest();
}
else if (window.ActiveXObject)
{
objXMLHttp = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);
}
return objXMLHttp;
}
</pre>
			Фрагмент 3.3.<span lang="en-us">3<br>
			<br>
			</span>Эта функция, как уже упоминалось поможет нам вызывать 
			содержимое из другого файла, не перегружая текущий, открытый в 
			браузере игрока:<br>
			<br>
			А в начале, в файле <b>game.php </b>добавим такие строки :<pre class="brush: html;">
&lt;html&gt;
&lt;head&gt;
&lt;link href=&quot;start.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;
&lt;script src=&quot;main.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;

&lt;div id=&quot;fld_div&quot; style=&quot;position:absolute;left:0px;top:0px; z-index:12;z-index:12&quot;&gt;&lt;/div&gt;

&lt;/head&gt;

&lt;body onload=&quot;draw_field( &lt;?php echo $x.','.$y; ?&gt; );&quot;&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre>
			Фрагмент 3.3.4<br>
			<br>
			Как видите в строке 4 фрагмента 3.3.4 мы подключаем файл <b>main.js</b>. 
			В дальнейшем мы добавим в него еще немало <span lang="en-us">
			JavaScript </span>функций. А пока что создадим функцию
			<font color="#3B84D0">draw_field</font> (которая, как Вы видите из 
			строки 10 принимает в качестве аргументов наши рассчитанные 
			координаты центрирования карты)<br>
			Вот как выглядит <span lang="en-us">JavaScript </span>функция
			<font color="#3B84D0">draw_field</font>:<pre class="brush: js;">
function draw_field( x, y ){
 var r = parseInt(Math.random()*1000000000000000);
 m = ajaxobj();
 m.open('GET', 'fld.php?x='+x+'&amp;y='+y+'&amp;r='+r,false);
 m.send(null);
 if((m.readyState == 4) &amp;&amp; (m.status == 200)) {
   fld_div.innerHTML = m.responseText;
   cur_x = x; cur_y = y;
 }
}
</pre>
			Фрагмент 3.3.<span lang="en-us">5<br>
			<br>
			</span>В ней создается экземпляр <span lang="en-us">Ajax-</span>объекта, 
			который использует метод <span lang="en-us">open </span>для 
			выполнения скрипта <b>fld.php</b>. Если все хорошо (свойства объекта 
			readyState равно 4 и status == 200 ), значит в responseText 
			содержится ответ (какие-то данные) от файла <b>fld.php</b>, который 
			мы поместим в слой fld_div, определенный еще в во фрагменте 3.3.4 
			(строка 6). Сразу поясним, <b>fld.php </b>что будет нам возвращать
			<span lang="en-us">html-</span>код рисования наших полей карты и 
			сейчас пришло время создать этот файл:<pre class="brush: php;">
&lt;?php

session_start();

@include(&quot;config.inc.php&quot;);
//Необходимо подключиться к БД
$link = mysql_connect($DBSERVER, $DBUSER, $DBPASS)
or die(&quot;Не могу подключиться&quot; );
// сделать $DB текущей базой данных
mysql_select_db($DB, $link) or die ('Не могу выбрать БД');

if( ( $_GET['x'] != '' ) &amp;&amp; ( $_GET['y'] != '' ) ){
$middle_x = $_GET['x'];
$middle_y = $_GET['y'];

$left_x = $middle_x - 3;
$top_y = $middle_y - 3;

$res = mysql_query(&quot;SELECT fid, nick, xcoord, ycoord, fid_type, f.usr_id FROM fields f
left join users u on u.usr_id = f.usr_id
WHERE xcoord&gt;=$left_x 
and xcoord&lt;$left_x+7 
and ycoord&gt;=$top_y 
and ycoord&lt;$top_y+7&quot;,$link ) ;

$x_coord = 0;
$y_coord = 0;

$x_coord_start = 315;
$y_coord_start = 288;

$x = 1;
$y = 1;

$x_coord = $x_coord_start;
$y_coord = $y_coord_start;

while ($row = mysql_fetch_array( $res )) {
$usr_id = $row[&quot;usr_id&quot;];
$fid = $row[&quot;fid&quot;];
$nick = $row[&quot;nick&quot;];
$fid_type = $row[&quot;fid_type&quot;];
$xcoord = $row[&quot;xcoord&quot;];
$ycoord = $row[&quot;ycoord&quot;];

$x1 = 0; $y1 = 20;
$x2 = 36; $y2 = 0;
$x3 = 73; $y3 = 20;
$x4 = 36; $y4 = 41;

if ( $usr_id !=0 ){
  if ( $usr_id == $_SESSION['usr_id'] ){
  // 
   echo &quot;&lt;MAP Name='FPMap1$fid'&gt;&quot;;
   echo &quot;&lt;AREA Shape='Polygon' coords = '$x1,$y1,$x2,$y2,$x3,$y3,$x4,$y4' onmouseover=\&quot;say_owner('&quot;.$nick.&quot;')\&quot;&gt;&lt;/MAP&gt;&quot;;
   echo '&lt;div style=&quot;position:absolute;left:'.$x_coord.'px;top:'.$y_coord.'px;width:73px; height:41px; z-index:12;z-index:12&quot;&gt;
   &lt;IMG SRC=&quot;img/fld200.png&quot; border=&quot;0&quot; USEMAP=&quot;#FPMap1'.$fid.'&quot; ISMAP&quot;&gt;&lt;/div&gt;';
  } else {
    echo &quot;&lt;MAP Name='FPMap1$fid'&gt;&quot;;
    echo &quot;&lt;AREA Shape='Polygon' coords = '$x1,$y1,$x2,$y2,$x3,$y3,$x4,$y4' onmouseover=\&quot;say_owner('&quot;.$nick.&quot;')\&quot;&gt;&lt;/MAP&gt;&quot;;
    echo '&lt;div style=&quot;position:absolute;left:'.$x_coord.'px;top:'.$y_coord.'px;width:73px; height:41px; z-index:12;z-index:12&quot;&gt;
    &lt;IMG SRC=&quot;img/fld100.png&quot; border=&quot;0&quot; USEMAP=&quot;#FPMap1'.$fid.'&quot; ISMAP&quot;&gt;&lt;/div&gt;';
  }
} else {
  echo &quot;&lt;MAP Name='FPMap1$fid'&gt;&quot;;
  echo &quot;&lt;AREA Shape='Polygon' coords = '$x1,$y1,$x2,$y2,$x3,$y3,$x4,$y4' onmouseover=\&quot;say_owner('&quot;.$nick.&quot;')\&quot;&gt;&lt;/MAP&gt;&quot;;
  echo '&lt;div style=&quot;position:absolute;left:'.$x_coord.'px;top:'.$y_coord.'px;width:73px; height:41px; z-index:12;z-index:12&quot;&gt;
  &lt;IMG SRC=&quot;img/fld'.$fid_type.'.png&quot; border=&quot;0&quot; USEMAP=&quot;#FPMap1'.$fid.'&quot; ISMAP&quot;&gt;&lt;/div&gt;';
}
$x_coord += 40;
$y_coord -= 22; 
if ($x++ &gt;= 7 ){ 
  $x = 1; 
  $y++; 
  $y_coord_start += 22; 
  $y_coord = $y_coord_start; 
  $x_coord_start += 40; 
  $x_coord = 
  $x_coord_start;
} 
}

$x_coord = 299;
$y_coord = 278;

// Отрисуем номера полей
for($i=1; $i&lt;=7; $i++){
// номера по горизонтали
echo '&lt;div style=&quot;position:absolute;left:'.$x_coord.'px;top:'.$y_coord.'px;width:73px; height:41px; z-index:12;z-index:12&quot;&gt;'.$left_x++.'&lt;/div&gt;';
$x_coord += 40;
$y_coord -= 22; 

}

$x_coord = 295;
$y_coord = 319;

for($i=1; $i&lt;=7; $i++){
// номера по вертикали
echo '&lt;div style=&quot;position:absolute;left:'.$x_coord.'px;top:'.$y_coord.'px;width:73px; height:41px; z-index:12;z-index:12&quot;&gt;'.$top_y++.'&lt;/div&gt;';
$x_coord += 40;
$y_coord += 22; 
}

} else echo 'error!';

// КНОПКИ
echo '&lt;div style=&quot;position:absolute;left:390px;top:180px;width:73px; height:41px; z-index:12;z-index:12&quot;&gt;
&lt;IMG SRC=&quot;img/ar_up.png&quot; onclick=&quot;map_go_pos(0,-1)&quot;&gt;&lt;/div&gt;';
echo '&lt;div style=&quot;position:absolute;left:735px;top:385px;width:73px; height:41px; z-index:12;z-index:12&quot;&gt;
&lt;IMG SRC=&quot;img/ar_dn.png&quot; onclick=&quot;map_go_pos(0,1)&quot;&gt;&lt;/div&gt;';
echo '&lt;div style=&quot;position:absolute;left:740px;top:180px;width:73px; height:41px; z-index:12;z-index:12&quot;&gt;
&lt;IMG SRC=&quot;img/ar_right.png&quot; onclick=&quot;map_go_pos(1,0)&quot;&gt;&lt;/div&gt;';
echo '&lt;div style=&quot;position:absolute;left:385px;top:385px;width:73px; height:41px; z-index:12;z-index:12&quot;&gt;
&lt;IMG SRC=&quot;img/ar_left.png&quot; onclick=&quot;map_go_pos(-1,0)&quot;&gt;&lt;/div&gt;';

?&gt;

</pre>
			Фрагмент 3.3.6<p>Поначалу выглядит громоздко и немного устрашающе? 
			На самом деле ничего сложного. Пройдемся по строкам этого фрагмента:<br>
			Начнем со строки 12. В ней проверяются координаты центра поселка, 
			которые мы передаем в этот скрипт из <span lang="en-us">JavaScript
			</span>процедуры
			<font color="#3B84D0">draw_field</font>. Это Вы помните! Конечно же, 
			если координаты не переданы - выдаем сообщение об ошибке (строка 
			104). В строках 13 и 14 сохраним координаты центра в переменных (<code class="php variable">$middle_x 
			и $middle_y</code>) чисто для удобства. Так как мы отображаем окно с 
			полями размером 7 х 7, то для нахождения верхней левой координаты 
			отображаемого фрагмента карты отнимем 3.<br>
			Схематично представим фрагмент карты с участком под поселок игрока 
			(помечен цифрой 1) и участком с координатами левого верхнего угла 
			(помечен цифрой 2 на рисунке 3.3.1)<br>
			<img border="0" src="pics/chema.png" width="400" height="400"><br>
			Рисунок 3.3.1<br>
			<br>
			Как Вы видите в идеальном варианте, участок под поле игрока 
			находится в центре видимого фрагмента карты и отстоит от всех границ 
			на три поля (вот откуда мы взяли цифру 3). И следовательно 
			координаты левого верхнего угла мы узнаем в строках 16 и 17 
			фрагмента 3.3.6. Теперь осталось написать <span lang="en-us">sql-</span>запрос 
			и вытащить все 7х7=49 участков из таблицы <span lang="en-us"><b>
			fields</b> </span>для их визуализации на странице в браузере. Этот 
			запрос Вы можете лицезреть в строках 19-34. Т.е. выборка идет по 
			координатам <code class="php variable">с $left_x по $left_x+7 и&nbsp; 
			$top_y по $top_y+7</code> - проще простого! Этот запрос вернет 49 
			строк и нам нужно будет только нарисовать картинки полей в нужных 
			координатах. Для этого инициализируем пару переменных (строки 
			26-36).&nbsp; А в строке 38 начнем цикл по всем 49 строкам, которые 
			нам вернул наш <span lang="en-us">sql-</span>запрос. В 39-44 строки 
			фрагмента 3.3.6 мы сохраняем в переменных значения полей ника игрока 
			(<code class="php variable">$nick</code>), занимающего участок (если 
			участок не пустой ) , тип участка (<code class="php variable">$fid_type</code>), 
			координаты участка и т.д.<br>
			Далее (строки 46-49), переменные $x1,<span lang="en-us">$y1,</span>$x<span lang="en-us">2</span>,<span lang="en-us">$y2,</span>$x<span lang="en-us">3</span>,<span lang="en-us">$y3,</span>$x<span lang="en-us">4</span>,<span lang="en-us">$y4 
			- </span>это не что иное, как относительные координаты вершин 
			каждого участка на карте. <br>
			<br>
			<img border="0" src="pics/fld.png" width="337" height="174"><br>
			<br>
			Рисунок 3.3.2<br>
			<br>
			На рисунке первая координата - х, вторая - у.<br>
			В строках с 51-70 мы занимаемся&nbsp; тем, что создаем так 
			называемые активные области. В языке <span lang="en-us">HTML </span>
			они задаются ключевыми словами <span lang="en-us">MAP (</span>карта<span lang="en-us">)
			</span>и <span lang="en-us">AREA</span> (зона)<span lang="en-us">
			</span>. Зоны могут быть разной формы (<span lang="en-us">circle, 
			rect, polygon</span>)<span lang="en-us">. </span>У нас это будут 
			полигональные формы. Каждая из таких <span lang="en-us">AREA </span>
			описывается восьмью координатами (для всех зон это будут координаты, 
			задаваемые переменными $x1,<span lang="en-us">$y1,</span>$x<span lang="en-us">2</span>,<span lang="en-us">$y2,</span>$x<span lang="en-us">3</span>,<span lang="en-us">$y3,</span>$x<span lang="en-us">4</span>,<span lang="en-us">$y4</span>) 
			- то есть одни и те же координаты. Картинки участков полей&nbsp;
			<img border="0" src="www/img/fld2.png" width="73" height="41"><img border="0" src="www/img/fld1.png" width="73" height="41"><img border="0" src="www/img/fld3.png" width="73" height="41"><img border="0" src="www/img/fld4.png" width="73" height="41"> 
			будут у нас размещаться в слоях, имеющих абсолютные координаты на 
			веб-странице. Вы заметили, что имя объекта <span lang="en-us">MAP
			</span>формируется динамически (&lt;MAP Name='FPMap1<font color="#3B84D0">$fid</font>'&gt;), 
			т.е. скрипт подставит вместо <font color="#3B84D0">$fid </font>
			соответствующее ему значение. Ну а <font color="#3B84D0">$fid</font> 
			для каждой записи - это идентификатор из таблицы <span lang="en-us">
			<b>fields</b>. </span>
			<br>
			Координаты слоев отображающих картинки с полями сдвигаются на 
			значения $x_coord += 40; $y_coord -= 22; (Смотрите строки 70-71 
			фрагмента 3.3.6) именно это смещение и создает иллюзию 
			изометрического размещения участков. В строках 72-80 проверяются 
			вывод участков: т.е после вывода семи участков нужно менять 
			координату по высоте т.е. <span lang="en-us">$y_coord.<br>
			</span>В строках с 83-103 мы выводим номера этих участков (с 1-15 ,&nbsp; 
			ну конечно у нас помещается только 7, так что с 1-7 или 2-8 и т.д.)) 
			чтоб пользователю было удобно понимать, в каких координатах 
			находится тот или иной участок карты.<br>
			<br>
			И последнее, нам нужно сделать кнопки управления скроллингом 
			(смещением карты). Это сделано в строках 108-115 фрагмента 3.3.6. По 
			сути это 4 слоя, расположенные в определенных удобных координатах на 
			странице, которые содержат в себе следующие картинки:
			<img border="0" src="www/img/ar_right.png" width="54" height="54"><img border="0" src="www/img/ar_left.png" width="54" height="54"><img border="0" src="www/img/ar_dn.png" width="54" height="54"><img border="0" src="www/img/ar_up.png" width="54" height="54">(вправо, 
			влево, вниз, вверх)
			<br>
			<br>
			Вот как выглядит наша карта целиком:<br>
			<img border="0" src="pics/map.png" width="604" height="392"><br>
			<br>
			Рисунок 3.3.3.<br>
			<br>
<br><strong><span lang="en-us"><font color="#4775A5">3</font></span></strong><font color="#4775a5"><strong>.4. 
			Реализация скроллинга карты</strong>
      
            <br></font><br>&nbsp;&nbsp; <br>
&nbsp;&nbsp; Так как карта у нас больше чем 7х7 участков, то все остальные 
			участки находятся вне зоны видимости и сейчас мы должны научиться 
			также отображать их на карте. Как Вы помните из предыдущего пункта, 
			кнопки управления скроллингом карты находятся у нас в строках&nbsp; 
			108-115 фрагмента 3.3.6. Так кнопка вверх
			<img border="0" src="www/img/ar_up.png" width="54" height="54"> это 
			картинка на языке <span lang="en-us">HTML </span>описываемая как- &lt;IMG SRC=&quot;img/ar_up.png&quot; onclick=&quot;<font color="#0000FF">map_go_pos</font>(0,-1)&quot;&gt; 
			и это значит что к картинке прикручено событие щелчка мыши ( <b>onclick</b> 
			- значит &quot;при щелчке левой кнопкой мыши&quot;). Это событие приводит к 
			срабатыванию <span lang="en-us">JavaScript </span>функции
			<font color="#0000FF">map_go_pos</font>.<span lang="en-us"> </span>
			Эта функция срабатывает при щелчке на всех четырех картинках 
			навигации карты, вот только аргументы, передаваемые в нее - разные.<br>
			<br>
			1. Для кнопки вверх: map_go_pos(0,-1)<br>
			2. Для кнопки вниз: map_go_pos(0,1)<br>
			3. Для кнопки влево: map_go_pos(-1,0)<br>
			4. Для кнопки вправо : map_go_pos(1,0)<br>
			<br>
			По сути, это значит, что мы просто будем прибавлять или отнимать 
			координату х или у от рассчитанных ранее координат центра 
			отображения карты.<br>
			Вот как выглядит <span lang="en-us">JavaScript </span>&nbsp;функция
			<font color="#0000FF">map_go_pos</font>:</p><pre class="brush: js;">
function map_go_pos(dx,dy){
 if( ((cur_x-3+dx)&gt;0) &amp;&amp; ((cur_x+3+dx)&lt;=15) ) cur_x += dx;
 if( ((cur_y-3+dy)&gt;0) &amp;&amp; ((cur_y+3+dy)&lt;=15) ) cur_y += dy;
draw_field( cur_x, cur_y );
}

</pre>
			Фрагмент 3.4.<span lang="en-us">1</span><p>Аргументы <b>dx</b>,<b>dy</b>&nbsp; 
			- это наши приращения к координатам, <b>cur_x</b> и <b>cur_y</b> 
			определяются в функции <font color="#0000FF">draw_field</font> 
			(вспомните фрагмент
			Фрагмент 3.3.<span lang="en-us">5</span>)<br>
			В строках 2 и 3 фрагмента 2.4.1 осуществляется проверка, а можно ли 
			двигать карту. Т.е. должно выполняться условие, что текущая 
			координата <b>cur_y</b>&nbsp; минус 3&nbsp; должна быть не меньше 
			нуля и эта же координата плюс 3 и плюс приращение по
			<span lang="en-us">Y </span>не должна быть больше 15 (максимальная 
			ячейка поля). Тоже характерно и для переменной <b>cur_x</b> . Таки 
			образом при скроллинге карты мы не должны вылазить за пределы 
			участков 1 и 15. А что же находится в строке 3 фрагментв 3.4.<span lang="en-us">1</span> 
			- конечно же вызов уже знакомой нам функции <font color="#0000FF">draw_field</font> 
			с уже новыми координатами.</p>
			<p>Что же мы увидим при нажатии на кнопку вниз
			<img border="0" src="www/img/ar_dn.png" width="54" height="54">на 
			веб-странице с нашей картой:<br>
			<img border="0" src="pics/map2.png" width="614" height="384"><br>
			<br>
			<br>
			Рисунок 3.<span lang="en-us">4</span>.<span lang="en-us">1</span><br>
			<br>
			Правильно - карта сдвинулась по координате <span lang="en-us">Y (</span>сравните 
			рисунки 3.<span lang="en-us">4</span>.<span lang="en-us">1</span> и 
			3.3.3<span lang="en-us">).<br>
			</span>Теперь Вы можете сдвигать карту в любом направлении и 
			просмотреть все ее 255 участков!<br>
			<br>
			<br>
			<span lang="en-us"><font color="#4775A5"><b>3</b></font></span><font color="#4775A5"><b>.5. 
			Информация о жителях </b></font> <br>
            <br>
            &nbsp;&nbsp; И последнее в текущем третьем занятии - давайте 
			выводить логин игрока при наведении курсора мыши на участок, занятый 
			поселком какого-нибудь игрока. Если Вы вспомните, к примеру строчку 
			из фрагмента 3.3.2</p>


<pre class="brush: php;">
 echo &quot;&lt;AREA Shape='Polygon' coords = '$x1,$y1,$x2,$y2,$x3,$y3,$x4,$y4' onmouseover=\&quot;say_owner('&quot;.$nick.&quot;')\&quot;&gt;&lt;/MAP&gt;&quot;;
</pre>
			Фрагмент 3.5.1<p>то<span lang="en-us">,</span> наверняка<span lang="en-us">,</span> 
			заметили событие <b>onmouseover</b> (событие, возникающее при 
			наведении курсора мыши на элемент -&nbsp; в данном случае это 
			элемент &lt;AREA<span lang="en-us">&gt;</span>)<span lang="en-us">
			</span>Это событие вызывает <span lang="en-us">JavaScript </span>
			функцию <font color="#0000FF">say_owner</font>, в которую передается 
			ник игрока, полученный из таблицы <span lang="en-us"><b>users</b>.<br>
			</span>Функция <font color="#0000FF">say_owner </font>очень
			<span lang="en-us">&nbsp;</span>проста<span lang="en-us">,</span> 
			вот она:</p><pre class="brush: js;">
function say_owner( s ){
  player.innerHTML = s;
}
</pre>
			Фрагмент 3.4.<span lang="en-us">1</span><p>Из листинга этой функции 
			мы видим, что <span lang="en-us">н</span>ик игрока передается в 
			какой-то слой с именем<span lang="en-us">
			</span>player (метод <font color="#0000FF">innerHTML</font> обычно 
			характерен для манипулирования<span lang="en-us"> </span>содержимым 
			слоев в языке <span lang="en-us">JavaScript</span>)<span lang="en-us"><br>
			<br>
			</span>Этот слой мы опишем в файле <span lang="en-us"><b>game.php</b>.
			</span>Вспомните фрагмент 3.3.4 и добавьте в него строки&nbsp; чтоб 
			он принял такой вид:</p><pre class="brush: html;">
&lt;html&gt;
&lt;head&gt;
&lt;link href=&quot;start.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;
&lt;script src=&quot;main.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;

&lt;div id=&quot;fld_div&quot; style=&quot;position:absolute;left:0px;top:0px; z-index:12;z-index:12&quot;&gt;&lt;/div&gt;

&lt;div id=&quot;info_div&quot; style=&quot;position:absolute;left:700px;top:100px; z-index:12;z-index:12&quot;&gt;
&lt;table class=&quot;info&quot;&gt;
&lt;tr&gt;&lt;td colspan=&quot;2&quot; class=&quot;cellinfo&quot;&gt;Данные&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td class=&quot;cellinfo&quot;&gt;Игрок:&lt;/td&gt;&lt;td class=&quot;cellinfo&quot;&gt;&lt;div id=&quot;player&quot;&gt;&lt;/div&gt;&lt;td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td class=&quot;cellinfo&quot;&gt;Население:&lt;/td&gt;&lt;td class=&quot;cellinfo&quot;&gt;&lt;div id=&quot;qty&quot;&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;

&lt;/head&gt;

&lt;body onload=&quot;draw_field( &lt;?php echo $x.','.$y; ?&gt; );&quot;&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre>Фрагмент 3.3.4<p>На самом деле мы создали слой info_div, внутри него 
			определили таблицу и только в одной из ее ячеек создали нужный нам 
			слой <span lang="en-us">:</span><br>
			(&lt;div id=&quot;player&quot;&gt;<span lang="en-us">&lt;/div&gt;</span>)<br>
			<br>
			Теперь при наведении курсора мыши на любой&nbsp; поселок можно 
			увидеть логин игрока, который в нем живет:<br>
			<br>
			<img border="0" src="pics/map_sel.png" width="606" height="399"><br>
			<br>
			<br>
			Все файлы, которые были созданы в нашем с Вами третьем занятии Вы 
			можете найти <a href="www">здесь</a>.<br>
			<br>
			<b>В следующем уроке</b> мы <span lang="ru">с Вами займемся 
			ресурсными полями и научимся создавать фермы, шахты руды, лесопилки 
			и кончено же - основную еду обитателей нашего поселка - зерно</span>.&nbsp;<br>
            <br>
            </p>
            <p></p>
            <p></p></font>
            </td>
            <td background="index_files/m_right_m.gif" width="9"><img height="4" src="index_files/m_right_m.gif" width="9" border="0"></td>
          </tr>
        </tbody>
      </table>
      <table cellpadding="0" cellspacing="0" width="100%">
        <tbody>
          <tr>
            <td background="index_files/m_left_m.gif" width="9"></td>
            <td class="newsbody" bgcolor="#fdfdfd">&nbsp;</td>
            <td class="newsbody" bgcolor="#fdfdfd">
            <div class="nav" align="right">Blitz-School© </div>
            </td>
            <td background="index_files/m_right_m.gif" width="9"><img height="4" src="index_files/m_right_m.gif" width="9" border="0"></td>
          </tr>
        </tbody>
      </table>
      <table cellpadding="0" cellspacing="0" height="7" width="100%">
        <tbody>
          <tr>
            <td background="index_files/m_left_b.gif" width="13"><img height="7" src="index_files/m_left_b.gif" width="13" border="0"></td>
            <td background="index_files/m_center_b.gif"><img height="1" src="index_files/spacer.gif" width="1"></td>
            <td width="13"><img height="7" src="index_files/m_right_b.gif" width="13" border="0"></td>
          </tr>
        </tbody>
      </table>
      </div>
      </td>
      <td background="index_files/right_back.gif" valign="top" width="13">&nbsp;</td>
    </tr>
  </tbody>
</table>
<table cellpadding="0" cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td background="index_files/bottom_left.png" height="51" valign="top" width="254">
      <div class="date" style="MARGIN-TOP: 12px; FONT-SIZE: 10px; MARGIN-LEFT: 45px; COLOR: white"><a style="COLOR: rgb(255,255,255)" href  ="index.phtml">Copyright</a>©
2005-2009.
GameSchool</div>
      </td>
      <td background="index_files/bottom.gif" valign="top">
      <div class="date" style="MARGIN-TOP: 12px; FONT-SIZE: 10px; MARGIN-LEFT: 20px; COLOR: rgb(143,145,147)" 
      ><!-- Bottom menu --><a title="Главная страница" style="COLOR: rgb(143,145,147)" href  ="http://www.blitz-school.info/index.phtml">Главная</a><img height="1" src="index_files/spacer.gif" width="22" align="middle">:<img height="1" src="index_files/spacer.gif" width="22" align="middle"><a href="http://www.blitz-school.info/login.phtml"><span style="COLOR: rgb(143,145,147)"  >Вход</span></a><img height="1" src="index_files/spacer.gif" width="22" align="middle">:<img height="1" src="index_files/spacer.gif" width="22" align="middle"><a href="http://www.blitz-school.info/response.phtml"><span style="COLOR: rgb(143,145,147)" 
      >Отзывы</span></a><img height="1" src="index_files/spacer.gif" width="22" align="middle">:<img height="1" src="index_files/spacer.gif" width="22" align="middle"><a href="http://www.blitz-school.info/contacts.phtml"><span style="COLOR: rgb(143,145,147)" 
      >Контакты</span></a><img height="1" src="index_files/spacer.gif" width="22" align="middle">:<img height="1" src="index_files/spacer.gif" width="22" align="middle"><a href="http://www.blitz-school.info/friends.phtml"><span style="COLOR: rgb(143,145,147)" 
      >Обмен ссылками</span></a> </div>
      </td>
      <td width="19"><img height="51" src="index_files/bottom_right.png" width="19" border="0"></td>
    </tr>
  </tbody>
</table>
<div id="menu" onmouseover="showLayer('menu'); Change('products', 'menu2')" onmouseout="hiddenLayer('menu'); Change('products', 'menu1')">
<table border="0" cellpadding="0" cellspacing="0">
  <tbody>
    <tr>
      <td style="WIDTH: 7px; HEIGHT: 7px"><img height="7" alt="" src="index_files/corner1.gif" width="7"></td>
      <td class="top"></td>
      <td style="WIDTH: 7px; HEIGHT: 7px"><img height="7" alt="" src="index_files/corner2.gif" width="7"></td>
    </tr>
    <tr>
      <td class="left"></td>
      <td class="text"><a href="reg.phtml">Курс обучения созданию игр
на Blitz3D</a><br>
      <a href="reg2.phtml">Курс
обучения созданию браузерных онлайновых игр</a> </td>
      <td class="right"></td>
    </tr>
    <tr>
      <td style="BACKGROUND: 0% 50%; WIDTH: 7px; HEIGHT: 7px; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial" 
      ><img height="7" alt="" src="index_files/corner4.gif" width="7"></td>
      <td class="bottom"></td>
      <td style="WIDTH: 7px; HEIGHT: 7px"><img height="7" alt="" src="index_files/corner3.gif" width="7"></td>
    </tr>
  </tbody>
</table>
</div>
</body></html>
