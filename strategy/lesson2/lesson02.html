<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
  
  <meta http-equiv="Content-Language" content="ru">
  
  <title>Центр обучения созданию компьютерных игр</title>
  <meta name="description" content="Blitz-School - Школа создателей компьютерных игр на языке Blitz3D. Если вы хотите быстро научиться делать компьютерные игры или интересуетесь их созданием, то этот сайт будет вам полезен">
  <meta name="keywords" content="программирование, создание игр, курсы создания игр, школа создателей компьютерных игр, blitzbasic, компьютерные игры, как написать игру, как создать игру, программирование компьютерных игр, Blitz3D, программирование игр, разработка игр, создание 3d игр, аудио, графика, дизайн, 3D">
  <link rel="stylesheet" type="text/css" href="main.css">
  <script language="JavaScript" src="index_files/script.js" type="text/javascript"></script>
  <script type="text/javascript" src="scripts/shCore.js"></script>
  <script type="text/javascript" src="scripts/shBrushBash.js"></script>
  <script type="text/javascript" src="scripts/shBrushCpp.js"></script>
  <script type="text/javascript" src="scripts/shBrushCSharp.js"></script>
  <script type="text/javascript" src="scripts/shBrushCss.js"></script>
  <script type="text/javascript" src="scripts/shBrushDelphi.js"></script>
  <script type="text/javascript" src="scripts/shBrushDiff.js"></script>
  <script type="text/javascript" src="scripts/shBrushGroovy.js"></script>
  <script type="text/javascript" src="scripts/shBrushJava.js"></script>
  <script type="text/javascript" src="scripts/shBrushJScript.js"></script>
  <script type="text/javascript" src="scripts/shBrushPhp.js"></script>
  <script type="text/javascript" src="scripts/shBrushPlain.js"></script>
  <script type="text/javascript" src="scripts/shBrushPython.js"></script>
  <script type="text/javascript" src="scripts/shBrushRuby.js"></script>
  <script type="text/javascript" src="scripts/shBrushScala.js"></script>
  <script type="text/javascript" src="scripts/shBrushSql.js"></script>
  <script type="text/javascript" src="scripts/shBrushVb.js"></script>
  <script type="text/javascript" src="scripts/shBrushXml.js"></script>
  <script type="text/javascript" src="scripts/shBrushBlitz3D.js"></script>
  <link type="text/css" rel="stylesheet" href="styles/shCore.css">
  <link type="text/css" rel="stylesheet" href="styles/shThemeDefault.css">
  <script type="text/javascript">
SyntaxHighlighter.config.clipboardSwf = 'scripts/clipboard.swf';
SyntaxHighlighter.all();
  </script>
  <meta content="MSHTML 6.00.6000.20772" name="GENERATOR"></head>

<body topmargin="0" leftmargin="0" style="BACKGROUND-COLOR: rgb(255,255,255)" marginheight  ="0" marginwidth="0">
<table cellpadding="0" cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td rowspan="2" height="197" width="21"><img height="197" src="index_files/ltoptable.png" width="21" border="0"></td>
      <td colspan="5" valign="top">
      <table cellpadding="0" cellspacing="0" width="100%">
        <tbody>
          <tr>
            <td height="49" width="231"><img height="49" src="index_files/topmenu.png" width="231" usemap="#ImageMap1" border="0"></td>
            <td background="index_files/mtop.gif"><map name="ImageMap1"><area onclick="this.style.behavior='url(#default#homepage)';this.setHomePage('http://www.blitz-school.info'); return false;" shape="RECT" coords="17,26,71,40" href="index.phtml"><area shape="RECT" coords="91,27,149,39" href="javascript:window.external.AddFavorite('http://www.blitz-school.info', 'GameSchool - Центр обучения созданию компьютерных игр!')"></map>
            <div class="searchform" align="right">
            <form method="post"><input value="search" name="do" type="hidden">&nbsp;</form>
            </div>
            </td>
            <td height="49" width="13"><img height="49" src="index_files/mlefttop.png" width="13" border="0"></td>
          </tr>
        </tbody>
      </table>
      </td>
    </tr>
    <tr>
      <td height="148" valign="top" width="225">
      <table cellpadding="0" cellspacing="0" height="148" width="100%">
        <tbody>
          <tr>
            <td height="119" width="225"><a title="Центр обучения созданию компьютерных игр" href="index.phtml"><img height="119" src="index_files/title.png" width="225" border="0"></a></td>
          </tr>
          <tr>
            <td background="index_files/date_b.png" valign="bottom">
            <div class="date" style="FONT-SIZE: 11px; MARGIN-BOTTOM: 10px; MARGIN-LEFT: 12px">
            <script language="JavaScript1.2">
<!-- Begin
var months=new Array(13);
months[1]="января";
months[2]="февраля";
months[3]="марта";
months[4]="апреля";
months[5]="мая";
months[6]="июня";
months[7]="июля";
months[8]="августа";
months[9]="сентября";
months[10]="октября";
months[11]="ноября";
months[12]="декабря";
var time=new Date();
var lmonth=months[time.getMonth() + 1];
var date=time.getDate();
var year=time.getYear();
var hours=time.getHours();
var minutes=time.getMinutes();
if (eval(hours) <10) {hours="0"+hours}
if (eval(minutes) < 10) {minutes="0"+minutes}
if (year < 2000)
year = year + 1900;
document.write("Сейчас: " + date + " ");
document.write(lmonth + " " + year + ", " + hours + ":" + minutes + " ");
// End -->
            </script></div>
            </td>
          </tr>
        </tbody>
      </table>
      </td>
      <td width="296"><img height="148" src="index_files/mainleft.jpg" width="296" border="0"></td>
      <td width="205"><img height="148" src="index_files/mainright.jpg" width="205" border="0"></td>
      <td background="index_files/mback.png">&nbsp;</td>
      <td height="148" width="58"><img height="148" src="index_files/mltopr.png" width="58" border="0"></td>
    </tr>
  </tbody>
</table>
<table bordercolordark="black" bordercolorlight="black" cellpadding="0" cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td background="index_files/anek_tb.png" height="27" valign="top" width="254">
      <div class="lefttext"><b>Меню:</b></div>
      </td><?php include 'menu_top.php'; ?> <td background="index_files/nav_back.gif">&nbsp;</td>
      <td width="17"><img height="27" src="index_files/nav_end.png" width="17" border="0"></td>
    </tr>
  </tbody>
</table>
<table cellpadding="0" cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td background="index_files/lefttable.gif" valign="top" width="254"><!-- Menu -------->
      <div style="MARGIN-LEFT: 21px">
      <table cellpadding="0" cellspacing="0">
        <tbody>
          <tr>
            <td background="index_files/tb_back.gif">
            <div class="style3"><img src="index_files/home.gif"><a href="http://www.blitz-school.info/index.phtml">Главная</a><br>

        <img src="index_files/pages.gif"> <b>Перечень курсов</b><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/blitzindex.phtml">Создание 3D игр на Blitz3D</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/ogindex.phtml">Создание браузерной РПГ</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/egindex.phtml">Создание экономической браузерки</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/mgindex.phtml">Создание мобильных игр</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/cppindex.phtml">Создание 3D игр на С++</a><br>
        <img src="index_files/group.gif"> <a href="http://www.blitz-school.info/begin_study.phtml">Как стать слушателем</a><br>
        <img src="index_files/recom.gif"> <a href="http://www.blitz-school.info/study_tech.phtml">Технология обучения</a><br>
        <img src="index_files/loyalty_sm.jpg"> <a href="http://www.blitz-school.info/loyalty.phtml">Программа лояльности</a>
        <br>
&nbsp;&nbsp;&nbsp;&nbsp;
    <img border="0" src="index_files/navdiv.gif" width="80" height="4">
        <br><img src="index_files/newuser.gif"> <b>Регистрация</b><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/reg.phtml">Курс 3D игр на Blitz3D</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/reg2.phtml">Курс браузерной RPG</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/reg3.phtml">Экономическая браузерка</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/reg4.phtml">Курс мобильных игр</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/reg5.phtml">3D игры на С++</a><img src="index_files/new.gif"><br>
        <img src="index_files/admin.gif"> <a href="http://www.blitz-school.info/login.phtml">Вход для слушателей</a><br>
        <img src="index_files/study.gif"> <a href="http://www.blitz-school.info/program.phtml">Учебные программы курсов</a><br>
        <img src="index_files/society.gif"> <a href="http://www.blitz-school.info/response.phtml">Отзывы</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;
    <img border="0" src="index_files/navdiv.gif" width="80" height="4">
        
        <br><img src="index_files/media.gif"> <a href="http://www.blitz-school.info/distant.phtml">О дистанционном образовании</a><br>
        <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/articles.phtml">Статьи</a><br>
        <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/less_ex.phtml">Изложение материала</a><br>
        <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/gallery.phtml">Галерея</a><br> 
        <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/links.phtml">Полезные ссылки</a><br>
        <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/contacts.phtml">Контакты</a><br>
       <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/friends.phtml">Обмен ссылками</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;

            </div>
            </td>
          </tr>
          <tr>
            <td width="222"><img height="8" src="index_files/tb_b.gif" width="222" border="0"></td>
          </tr>
        </tbody>
      </table>
      </div><!-- ------------------ end of menu ------------------- --> </td>
      <td class="news" valign="top">
      <script language="javascript" type="text/javascript">
      </script>
      <div style="MARGIN-TOP: 7px">
      <table cellpadding="0" cellspacing="0" width="100%">
        <tbody>
          <tr>
            <td width="13"><img height="24" src="index_files/m_left.gif" width="13" border="0"></td>
            <td class="newstitle" background="index_files/m_center.gif">
            <b>Занятие
2</b></td>
            <td class="newstitle" align="right" background="index_files/m_center.gif">&nbsp;</td>
            <td width="9"><img height="24" src="index_files/m_right.gif" width="9" border="0"></td>
          </tr>
        </tbody>
      </table>
      <table cellpadding="0" cellspacing="0" width="100%">
        <tbody>
          <tr>
            <td background="index_files/m_left_m.gif" width="4">&nbsp;</td>
            <td class="newsbody" bgcolor="#fdfdfd">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <b><font size="3"> Создание
регистрации в игре</font></b><br>
            <br>
            <b><font color="#4775a5">2.1. Таблица регистрационной
информации</font><br>
            <br>
&nbsp;</b><span lang="en-us">&nbsp;&nbsp; </span>Здравствуйте, дорогой коллега! 
			На нашем втором с Вами занятии мы рассмотрим тему регистрации 
			игроков в игре.<br>
&nbsp;&nbsp; Для того, чтоб пользователь мог войти в создаваемый нами
игровой мир, он должен пройти регистрацию на сайте онлайновой
игры.&nbsp; Обычно процедура регистрации
состоит из заполнения десятка обязательных и необязательных полей, где
потенциальный игрок делится с разработчиком информацией о себе и
придумывает имя персонажа (логин), которым впоследствии намеревается играть.<br>
&nbsp;&nbsp; Чтоб сохранить всю эту введенную информацию у нас
в базе, нам, для начала, нужна сама база, посему давайте ее создадим.<br>
&nbsp;&nbsp; Из прошлого ознакомительного занятия Вы уже знаете как 
			устанавливать пакет Denwer и теперь пришло время приступить к его 
			использованию.<br>
&nbsp;&nbsp; Мы можем воспользоваться поставляемым вместе с
пакетом Denwer инструментом PHPMyAdmin или задействовать пакет dbForge Studio 
			for MySQL, который Вы можете скачать с нашего сайта (
			<a href="http://www.blitz-school.info/dbforge.rar">http://www.blitz-school.info/dbforge.rar</a>&nbsp;
)<br>
&nbsp;&nbsp; Если Вы решили применить первый способ, то
убедитесь, что после установки пакета Denwer Вы
запустили его ( ярлык Start servers на Вашем рабочем столе) и
скопируйте в адресную строку браузера следующий url: <a href="http://localhost/Tools/phpmyadmin/index.php">&nbsp;http://localhost/Tools/phpmyadmin/index.php</a>.
            <br>
После того как запустится <b>PHPMyAdmin</b>,
впишите
название нашей с Вами базы - <span lang="en-us"><b>travgame</b></span>
в пустое поле под строкой "<span lang="en-us">Create new database</span>" 
			<span lang="en-us">(</span>что означает - создать новую базу данных
			<span lang="en-us">)</span> а в выпадающих списках
кодировки и коннекта к базе выберите cp1251_general_ci. Смотрите рисунок 2.1.1<br>
            <br>
            <img src="pics/phpma1.png" border="0"><br>
Рисунок
2.1.1<br>
            <br>
После этих действий Нажмите
кнопку <span lang="en-us">Create (</span>Создать<span lang="en-us">)</span>.<br>
В результате этого программа выполнит следующий запрос (см.
рис. 2.1.2)<br>
			<br>
            <img src="pics/phpma2.png" border="0"><br>
Рисунок
2.1.2<br>
            <br>
и на диске создастся база данных с названием <span lang="en-us"><b>travgame</b></span>.
Пока что в этой
базе нет ни одной таблицы<span lang="en-us"> (</span>PHPMyAdmin
			<span lang="en-us">в</span>ыдала это сообщение<span lang="en-us">
			</span>- <span lang="en-us"><b>No tables found in database</b>)</span>. В наших с Вами планах создать в базе
			<span lang="en-us"><b>travgame </b></span>таблицу <b>users</b>,
в которой и будем хранить информацию о всех игроках,
зарегистрировавшихся в нашей онлайновой игре. Мы можем вписать название
таблицы и кол-во прогнозируемых полей, как на рисунке 2.1.3.:<br>
			<br>
            <img src="pics/phpma3.png" border="0"><br>
Рисунок
2.1.3 <br>
            <br>
и затем в открывшемся окне ввести названия всех полей их типы<span lang="en-us"> 
			(</span>цифровые, текстовые, даты...<span lang="en-us">)</span>, значения
по умолчанию и т.д., но так как это весьма трудоемко, воспользуемся
следующим скриптом (Фрагмент 2.1.1), который мы для Вас заготовили:<br>
Файл с этими строками вы можете найти <a href="sql/travgame.sql">здесь:</a>
            <br>
<pre class="brush: sql;">/*Таблица персонажей*/
CREATE TABLE `users` (
   usr_id                        bigint(20) unsigned NOT NULL auto_increment, /*ID игрока*/
   nick                          CHAR(32) UNIQUE,                             /*ник игрока (уникальный, при регистрации)*/
   pass                          CHAR(32),                                    /*пароль игрока (задается при регистрации)*/
   uniq_id                       varchar(50) NOT NULL default '',             /*уникальный идентификатор сессии*/
   stat                          int(1) not null default 0,                   /*подтверждена регистрация 0/1*/
   email                         CHAR(64),                                    /*почтовый ящик игрока*/
   full_name                     CHAR(50),                                    /*реальное имя игрока*/
   regdate                       timestamp,                                   /*дата регистрации*/
   user_gender                   SMALLINT(1),                                 /*пол игрока и перса*/
   gold                          FLOAT DEFAULT 0,                             /*золотых монет*/
  PRIMARY KEY  (`usr_id`)
) ENGINE=MyISAM DEFAULT CHARSET=cp1251;
</pre>Фрагмент 2.1.1<br>
 <br>
			Еще раз напомним, что файл <b><span lang="en-us">travgame</span>.sql</b> с
этими строками вы можете найти <a href="sql/travgame.sql">здесь</a>. <br>
            <br>
Теперь в PHPMyAdmin
выберите сверху вкладку SQL
и в открывшееся
окно скопируйте вышеприведенный фрагмент sql-кода.<br>
			<br>
            <img src="pics/phpma4.png" border="0"><br>
Рисунок 2.1.4<br>
            <br>
Затем нажмите кнопку "<span lang="en-us">Go</span>". После выполнения sql-скрипта
в нашей, до этого пустой базе <span lang="en-us"><b>travgame</b></span>
создастся первая
таблица <b><font color="#4B719E">users</font></b>.<br>
			<br>
            <img src="pics/phpma5.png" border="0"><br>
Рисунок 2.1.5<br>
            <br>
Нажмите на название этой таблицы <span lang="en-us">(</span>кликните мышью на<span lang="en-us">
			<b><font color="#4B719E">users</font></b>) </span>для просмотра ее структуры средствами PHPMyAdmin<span lang="en-us">
			</span>и Вы увидите примерно следующее:<br>
			<br>
			<img border="0" src="pics/phpma55.png" width="656" height="258"><br>
			<br>
			Рисунок 2.1.6<br>
            <br>
Давайте проделаем&nbsp; те же шаги, но теперь воспользуемся
программой <b>dbForge Studio 
			for MySQL</b>,
которую Вы уже наверное успели скачать&nbsp; с нашего сайта. <br>
Запустите программу <b>dbForge Studio 
			for MySQL</b>. После запуска
программы, мы должны
			создать соединение с базой, которую мы уже создали чуть ранее. Жмем правой кнопкой на 
			панели Проводника и выбираем Новое соединение (Рисунок 2.1.7). <br>
			<br>
            <img src="pics/host.jpg" border="0"><br>
			Рисунок 2.1.7<br>
            <br>
выбираем
из списка Хост:&nbsp; <b>localhost</b>
			(если список пуст, вводим <span lang="en-us">localhost </span>
			вручную), порт оставляем по умолчанию 3306, имя пользователя вводим <b>root</b>, 
			а
поле пароля оставляем пустым. Далее из списка База данных выбираем нашу базу
			<span lang="en-us"><b>travgame</b>. </span>Лучше убрать галочку с 
			пункта &quot;Показывать все базы данных&quot;, чтоб нам не мешала лишняя 
			информация.
			<span lang="en-us">(</span>Должно быть как на 
			рисунке 2.1.8<span lang="en-us">)</span><br>
			<br>
            <img src="pics/hostname.jpg" border="0"><br>
			Рисунок 2.1.<span lang="en-us">8</span><br>
            <br>
			Мы можем нажать кнопку Проверить и программа выведет сообщение - 
			&quot;Соединение установлено&quot;. Значит у нас с Вами все в порядке и можем 
			смело нажимать кнопку <span lang="en-us">Ok </span>для завершения 
			создания нашего с Вами соединения с базой <span lang="en-us"><b>
			travgame</b>.</span><br>
            <br>
            <img height="194" src="pics/base.jpg" width="249" border="0"><br>
Рисунок 2.1.9<br>
            <br>
			На вышеприведенном рисунке Вы увидите базу <span lang="en-us">
			travgame </span>с входящими в нее объектами. Разверните дерево 
			&quot;Таблицы&quot; и&nbsp; Вы увидите нашу таблицу <span lang="en-us">users</span>, 
			развернув которую можно будет увидеть, входящие в нее поля:<br>
			<br>
			<img border="0" src="pics/phpma6.png" width="260" height="454"><br>
			<br>
Рисунок 2.1.10<br>
            <br>
			Вы помните, что эту таблицу мы создали еще в PHPMyAdmin, а
Теперь давайте пересоздадим всю базу данных <span lang="en-us"><b>travgame</b></span> 
			и
таблицу <b>users, </b>используя
инструмент
выполнения sql-скрипта
в программе <b>dbForge Studio 
			for MySQL</b>. Для этого загрузите из
папки <b>sql</b>&nbsp;
текущего урока
файл <b><span lang="en-us">travgame</span>.sql</b>
			выбрав пункт меню Файл -<span lang="en-us">&gt; </span>Открыть.<br>
            <br>
            <img src="pics/script.jpg" border="0"><br>
            <br>
			Рисунок 2.1.11<br>
            <br>
			Как Вы можете
видеть, это уже знакомый Вам скрипт создания таблицы <b>users</b>. Однако
первые добавленные три строки:
            <br>
<pre class="brush: sql;">  
  DROP DATABASE travgame;
  CREATE DATABASE travgame DEFAULT CHARACTER SET cp1251 COLLATE cp1251_general_ci;
  USE travgame;
</pre>
Фрагмент 2.2<br>
            <br>
вначале удаляют базу данных <b>travgame</b>
вместе с
имеющейся в ней таблицей <b>users</b>
а затем, создают
ее снова. Третья строка выбирает уже вновь созданную базу и указывает
дальнейшим операторам sql
на работу
непосредственно с ней.<br>
Для
выполнения скрипта нажмите на пиктограмме восклицательного знака (показано на Рисунке 2.1.12) .<br>
            <br>
            <img src="pics/f9.jpg" border="0"><br>
Рисунок 2.1.10<br>
            <br>
Давайте рассмотрим скрипт создания таблицы регистрационной информации,
который Вы открыли в программе <b>dbForge Studio 
			for MySQL</b> немного
подробнее (Фрагмент 2.1.3):&nbsp;<br>

<pre class="brush: sql;">
DROP DATABASE travgame;
CREATE DATABASE travgame DEFAULT CHARACTER SET cp1251 COLLATE cp1251_general_ci;
USE travgame;

/*Таблица персонажей*/
CREATE TABLE `users` (
   usr_id                        bigint(20) unsigned NOT NULL auto_increment, /*ID игрока*/
   nick                          CHAR(32) UNIQUE,                             /*ник игрока (уникальный, при регистрации)*/
   pass                          CHAR(32),                                    /*пароль игрока (задается при регистрации)*/
   uniq_id                       varchar(50) NOT NULL default '',             /*уникальный идентификатор сессии*/
   stat                          int(1) not null default 0,                   /*подтверждена регистрация 0/1*/
   email                         CHAR(64),                                    /*почтовый ящик игрока*/
   full_name                     CHAR(50),                                    /*реальное имя игрока*/
   regdate                       timestamp,                                   /*дата регистрации*/
   user_gender                   SMALLINT(1),                                 /*пол игрока и персонажа*/
   gold                          FLOAT DEFAULT 0,                             /*золотых монет*/
  PRIMARY KEY  (`usr_id`)
) ENGINE=MyISAM DEFAULT CHARSET=cp1251;
</pre>
Фрагмент 2.1.3
            <p>Как Вы знаете, любая
таблица базы данных mySQL состоит из набора полей. Давайте разберемся, для
чего предназначены поля в нашей с Вами таблице <b>users</b>.<br>
			<br>
            <b> usr_id</b>
- будет хранить
уникальный
идентификационный номер созданного игроком персонажа и автоматом будет
увеличиваться на единицу с каждым новым зарегистрированным
пользователем (о чем свидетельствует ключевое слово <b>
auto_increment</b>), unsigned <span lang="en-us">- </span>значит этот номер не 
			имеет знака, NOT NULL - не может быть пустым значением (за каждым 
			игроком обязательно должен быть закреплен идентификатор), bigint(20) 
			- это поле должно иметь достаточно большую разрядность, ведь игроков 
			может быть много!<br>
            <b>n</b><b>ick</b>
- уникальное поле (чему свидетельство ключевое слово UNIQUE),
в котором будет
храниться логин персонажа. Если при регистрации, игрок введет логин,
который уже есть в таблице <b>users</b>
у
другого ранее зарегистрировавшегося пользователя, то он должен будет
быть предупрежден об этом и выбрать себе другой логин (<b> nick</b>
)<br>
            <b>pass</b>
- пароль пользователя
(для простоты будем
хранить его в таблице в открытом текстовом виде, хотя в реальной, не учебной 
			базе, можно было бы
применить ну хотя бы простейшее MD5
шифрование
)<br>
            <b>uniq_id</b>
- нужно нам для
служебных целей (для хранения сессионной идентификации) и мы
остановимся на этом чуть позже.<br>
			<span lang="en-us"><b>stat</b> - </span>это поле хранит значение 0 
			или 1, понадобится нам для подтверждения регистрации по почте.<br>
            <b>email</b>
- почтовый адрес
регистрирующегося юзера.<br>
            <b> full_name</b>
- ФИО игрока<br>
            <span lang="en-us"><b>regdate</b></span>
- на всякий случай запомним. когда зарегистрировался игрок<br>
            <b>u</b><b>ser_gender</b>
- пол игрока (может тоже оказаться полезным знать).<br>
            <span lang="en-us"><b>gold</b></span> - золотой запас игрока 
			(возможно понадобится, если игрок намерен вводить реальные деньги в 
			нашу с Вами игру).<br>
            <br>
Если кто не особо знаком с базой <b>MySQL</b>
то
заметим, что тип таблиц для нашего клуба мы выбрали MyISAM. <b>MyISAM</b>
– это стандартный тип таблиц в MySQL. Он основывается на коде <a title="ISAM" href="http://ru.wikipedia.org/wiki/ISAM">ISAM</a>
и обладает в сравнении с ним большим количеством полезных дополнений.
MyISAM-таблицы идеально оптимизированы для использования в WWW, где
преобладают запросы на чтение. Таблицы типа MyISAM показывают хорошие
результаты при выборках SELECT. Во многом это связано с отсутствием
поддержки транзакций и внешних ключей.<br>
Если
вы теперь загляните в папку&nbsp; <font color="#0000ff">C:\WebServers\usr\local\mysql-5.1\data\<span lang="en-us">travgame</span></font><br>
то увидите, что там появились несколько файлов:
&nbsp;Индексные
файлы имеют расширение .MYI (MYIndex). Файлы с расширением .MYD
(MYData) содержат данные, а с расширением .frm – схему
таблицы. Если индексный файл по какой-то причине теряется, программа
перестраивает индексы, используя информацию из frm-файла. Пока что у
нас создались файлы:<br>
users.frm,
users.MYD, users.MYI<span lang="en-us"> </span>и <span lang="en-us">db.opt (</span>хранит 
			кодировку базы<span lang="en-us">)</span>.<br>
            <b><span lang="en-us">u</span>sers.frm</b>
- содержит
только голую структуру таблицы, поскольку мы не ввели в него никаких
данных и ни один пользователь не зарегистрировался в нашей с Вами игре.
Да и как он может зарегистрироваться, если у нас до сих пор нет формы
регистрации! Что ж, пора исправлять эту несправедливость и переходить к
следующему разделу нашего урока<br>
            <br>
            <b><font color="#4775a5">2.2. Форма ввода данных
пользователя</font></b><br>
            <br>
Форма
ввода данных пользователя - это дверь, через которую игрок попадает во
вселенную нашего игрового мира. Все данные которые, он честно введет в
соответствующие поля ввода на странице браузера в регистрационной
анкете попадут в нашу таблицу <b>users</b>
и
будет затем использоваться для авторизации пользователя&nbsp; в
игре. <br>
&nbsp;&nbsp; Итак для создания анкеты для регистрации игрока, создадим пустой 
			файл с расширением
.ph<span lang="en-us">p</span>. Давайте назовем его <b>
reg<span lang="en-us">ank</span>.ph<span lang="en-us">p </span></b>
			<span lang="en-us">(</span>Типа - регистрационная анкета<span lang="en-us">)</span>. Вы можете
пользоваться любым удобным для
Вас редактором HTML (FrontPage,
DreamWeaver )
или просто набирать код страницы вручную в текстовом редакторе
(блокноте<span lang="en-us"> </span>или какого-то файлового менеджера<span lang="en-us">,</span>
			<span lang="en-us">Far Manager, </span>например). Возможно Вам будет 
			удобно воспользоваться более профессиональными программами -
			<span lang="en-us">Zend Studio</span>,<span lang="en-us"> </span>к 
			примеру.<br>
			Итак, нам понадобится <span lang="en-us">HTML </span>форма и таблица<span lang="en-us">.
			</span>Таблица для удобного размещения элементов ввода (логин, 
			пароль и т.д.) а форма - для ее отправки со всеми заполненными 
			данными в нашу таблицу <span lang="en-us">mySQL - <b>users</b>.</span><br>
&nbsp;<br>
Так, если Вы создаете эту форму вручную, начальный фрагмент кода с формой, 
			таблицей и текстовыми полями для ввода логина
и пароля пользователя будет выглядеть так:<br>
            </p>
<pre class="brush: html;">&lt;form name=&quot;registerForm&quot; action=&quot;regank.php&quot; method=&quot;post&quot;&gt;
&lt;p class=&quot;desc&quot;&gt;
&lt;table cellpadding=&quot;3&quot; cellspacing=&quot;0&quot; id=&quot;logindata&quot;&gt;
&lt;td&gt;&lt;label&gt;Имя игрока&lt;/label&gt;&lt;/td&gt;
&lt;td&gt;&lt;input type='text' name='name' class=&quot;startinput&quot; size='30'&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;label&gt;Пароль&lt;/label&gt;&lt;/td&gt;
&lt;td&gt;&lt;input type='pass<span lang="en-us">word</span>' name='pass' class=&quot;startinput&quot; size='30'&gt;&lt;/td&gt;
&lt;/tr&gt;
</pre>
Фрагмент 2.2.1<br>
            <br>
Если вы решили воспользоваться визуальным редактором (к примеру
FrontPage) то можно легко, в режиме проектирования создать такую форму,
а HTML-код за вас создаст сам редактор.<br>
Какие же поля, нам нужно создать для заполнения пользователем! Кроме
уже вышеперечисленных Логина и Пароля, которые называются <b>name</b><span lang="en-us">
			</span>и <b>pass</b>
соответственно <span lang="en-us">(name='name' </span>и <span lang="en-us">
			name='pass'</span>,<span lang="en-us"> </span>type='pass<span lang="en-us">word</span>'<span lang="en-us">
			</span>для ввода пароля говорит о том, что данные при вводе в нем 
			отображаются в виде звездочек <span lang="en-us">) </span>нам понадобятся поля для ввода e-mail, 
			цифрового кода подтверждения и галочки, что игрок принимает Основные 
			положения игры:<br>
<pre class="brush: html;"> &lt;tr&gt;
&lt;td&gt;&lt;label&gt;e-mail&lt;/label&gt;&lt;/td&gt;
&lt;td&gt;&lt;input type='text' name='email' class=&quot;startinput&quot; size='30'&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;img src=&quot;img/capcha.php?sid=&lt;? echo $_SESSION['uid'] ?&gt;&quot;&gt;&lt;/td&gt;
&lt;td&gt;&lt;input name=&quot;sid&quot; class=&quot;startinput&quot; type=&quot;text&quot; size=&quot;30&quot; value=&quot;&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td &gt;&lt;input type=checkbox name=&quot;agb&quot;&gt;&lt;label&gt;Я принимаю Основные Положения игры Travgame.&lt;/label&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt; 
</pre>
Фрагмент 2.2.2<br>
			<br>
			С текстовым полем ввода почтового адреса (name='email') и галочки /
			<span lang="en-us">checkbox (</span>name=&quot;agb&quot;<span lang="en-us">)
			</span>все ясно, а вот в строках Фрагмента 6 и 7 Вы можете видеть 
			элемент картинки (<span lang="en-us">&lt;img&gt;</span>)<span lang="en-us">
			</span>который создается скриптом <b>capcha.php</b> на основании 
			переданного в этот скрипт параметра <b>sid</b>, который 
			устанавливается как одна из переменных сессии, а именно
			<font color="#3B84D0">$_SESSION['uid']</font>.&nbsp; Откуда же это 
			все берется?<br>
			Очень часто при написании скриптов на php необходимо хранить 
			некоторую информацию о посетителе в течение всего сеанса его работы. 
			Типичным примером такой ситуации является необходимость &quot;помнить&quot; 
			логин и пароль пользователя при его нахождении в закрытой части 
			сайта (например - непосредственно в нашей с Вами игре). Собственного 
			говоря, именно для этого и существует механизм сессий, реализованный 
			в php, однако давайте все по порядку. Для того, чтобы в скрипте 
			(т.е. в нашем скриптовом файле регистрации <span lang="en-us">
			regank.php</span>) можно было работать с сессиями, необходимо 
			сначала инициализировать механизм сессий. Делается это с помощью 
			функции session_start(). При этом будет создана новая сессия или 
			восстановлена уже существующая.<span lang="en-us">&nbsp; </span>Вот 
			как это реализовано в нашем файле <span lang="en-us">regank.php</span>:<br>


<pre class="brush: php;">
&lt;?php
session_start();

@include(&quot;config.inc.php&quot;);
@include(&quot;functions.inc.php&quot;);
//Необходимо подключиться к БД
$link = mysql_connect($DBSERVER, $DBUSER, $DBPASS)
or die(&quot;Не могу подключиться&quot; );
// сделать $DB текущей базой данных
mysql_select_db($DB, $link) or die ('Не могу выбрать БД');

if($_SESSION['uid'] =='') { $_SESSION['uid'] = mt_rand(100000,999999); }
?&gt;
</pre>
			Фрагмент 2.2.3<p>В этом фрагменте нас пока интересуют строки 2 и 12.&nbsp; 
			В строке 2 мы запускаем стандартную функцию в <span lang="en-us">PHP
			</span>session_start() описанную Выше. А в строке 12 при помощи 
			опять же стандартной функции mt_rand генерируем случайное число 
			состоящее из 6 цифр для нашей картинки и засовываем его в массив $_SESSION 
			под именем uid (если это не было сделано ранее). Теперь Вам должно 
			быть понятна строка 6 из фрагмента 2.2.2. Однако не до конца! Ведь 
			мы еще не рассмотрели скрипт <b>capcha.php</b>, который на основании 
			этой переменной сессии, собственно и формирует графическое 
			представление картинки. Тогда давайте рассмотрим его:<br>


			</p>


<pre class="brush: php;">
&lt;?php
//Запускаем или восстанавливаем сессию
session_start();
//Создаем изображение из 3-х возможных подложек
$im=ImageCreateFromJpeg(round(mt_rand(1,3)).&quot;.jpg&quot;);
//Генерируем цвет надписи
$color=ImageColorAllocate($im,mt_rand(0,255),mt_rand(0,255),mt_rand(0,255));
//Формируем надпись, используя шрифт
ImageTtfText($im, 23, mt_rand(-5,5), 3, 30, $color, &quot;addict.ttf&quot;, $_SESSION['uid']);
//Указываем тип содержимого
Header(&quot;Content-type: image/jpeg&quot;);
//Создаем и выводим изображение
ImageJpeg($im);
//Разрушаем изображение
ImageDestroy($im);
?&gt;
</pre>
			Фрагмент 2.2.4<p>Как Вы догадались этот фрагмент находится в 
			отдельном файле (у нас он даже лежит в отдельной папке <b>
			<span lang="en-us">img</span></b>).<span lang="en-us"> </span>Все 
			вызываемые в нем<span lang="en-us"> </span>функции, входят в 
			стандартную графическую библиотеку <span lang="en-us">PHP. </span>В 
			строке 5 мы создаем подложку под нашу картинку. Для этого будем 
			использовать три разные картинки<span lang="en-us"> </span>в формате
			<span lang="en-us">.jpg. </span>Вот эти картинки:<br>
			<br>
			<img border="0" src="www/img/2.jpg" width="120" height="33">
			<img border="0" src="www/img/1.jpg" width="120" height="33">
			<img border="0" src="www/img/3.jpg" width="120" height="33"><br>
			Они имеют названия <span lang="en-us">1.jpg, 2.jpg, 3.jpg</span> и 
			выпадают случайным образом при обновлении страницы регистрации (<span lang="en-us">regank.php</span>)<span lang="en-us">
			</span>благодаря функции mt_rand(1,3). В строке 7 мы также случайно 
			создаем цвет цифр, которые будут видны на подложке (иногда цвет 
			выпадает неудачно и цифры очень трудно разобрать - тогда лучше 
			обновить страницу регистрации). В 9 строке на подложке рисуются сами 
			цифры, взятые из переменной сессии. В 11 строке мы указываем 
			браузеру как трактовать данные полученные от скрипта <b>capcha.php</b>, 
			а именно как картинку формата jpeg. В 13 строке функция
			<font color="#3B84D0">ImageJpeg</font> формирует все это изображение 
			целиком и в завершающей строке его лучше убрать, чтоб не засоряло 
			память. В результате работы этого скрипта в регистрационной анкете 
			отобразится картинка с подложкой и цифрами, например такая:<br>
			<br>
			<img border="0" src="pics/reg2.png" width="121" height="33"><br>
			<br>
			Конечно, цифры зависят от того, какое случайное число у нас будет в
			<font color="#3B84D0">$_SESSION['uid']</font>.<br>
			С этим закончили и теперь у нас в регистрационной анкете есть поля 
			для ввода логина, пароля, <span lang="en-us">e-mail, </span>цифр с 
			картинки и галочка соглашения с правилами игры<span lang="en-us">.
			</span>Теперь нам нужна кнопка, нажав на которую, игрок предпримет 
			попытку регистрации.<br>
			Вот, собственно, эта кнопка:<br>
            </p>
<pre class="brush: html;">&lt;input type=&quot;submit&quot; name=&quot;do&quot; class=&quot;button&quot; value=&quot;Регистрация&quot; /&gt;
</pre>
			Фрагмент 2.2.5<p>На рисунке 2.2.1 Вы видите, что у нас с Вами получилось:<br>
            <br>
            <img src="pics/reg1.png" border="0"><br>
&nbsp; Рисунок 2.2.1<br>
            <br>
			Кнопка Регистрация имеет тип <span lang="en-us">submit </span>и 
			поэтому сразу отправляет нашу форму с данными на сервер (это весьма 
			условно, так как сервер у нас с Вами находится на той же машине, где 
			выполняется и клиентская часть - т.е. наша страничка в браузере). 
			Собственно проверку введенной пользователем информации проверяет тот 
			же скрипт - <b>
reg<span lang="en-us">ank</span>.ph<span lang="en-us">p</span></b> (так как из 
			Фрагмента 2.2.1 вы помните, что у формы action=&quot;regank.php&quot;).<br>
			<br>
			<span lang="en-us">&nbsp;</span>&nbsp; Безусловно, то что мы с Вами 
			сделали - это только первая часть механизма регистрации. С помощью 
			такой страницы игрок сможет лишь заполнить необходимые поля и не более того. Поэтому необходимо
научиться сохранять введенные пользователем данные в нашу таблицу <b>users</b>, 
			которую Вы создали в пункте 2.1 текущего Занятия. <br>
            <br><font color="#4775a5">
            <font ><b><font color="#4775a5">2.3. Проверка данных регистрации на 
			сервере</font>
     </b></font><br></font>
            <br>
&nbsp;&nbsp; Особо не мудрствуя по этому поводу, мы сделаем три проверки:</p>
			<p>&nbsp;&nbsp; 1. Не существует ли уже в таблице <span lang="en-us">
			users </span>игрок с введенным логином?<br>
&nbsp;&nbsp; 2. Не забыл ли пользователь ввести пароль в регистрационной анкете?<br>
&nbsp;&nbsp; 3. Не ошибся ли он при вводе цифрового кода подтверждения?<br>


			</p>


<pre class="brush: php;">
&lt;?php
// данные отправлены
if($_POST['do'] !='') {
//Начинаем проверять входящие данные
if($_POST['sid'] == $_SESSION['uid']) {

//Создаем запрос к базе для проверки существования Пользователя
$name = $_POST['name'];
mysql_query(&quot;SELECT * FROM users WHERE nick='&quot;.strtolower($name).&quot;'&quot;);

//Проверка результата запроса
if(mysql_affected_rows()==0) {
//Проверка ввведенных паролей

if( $_POST['pass'] !='' ){

//Осуществляем регистрацию
$uniq_id = md5($_SERVER['REMOTE_ADDR'].$_SERVER['HTTP_USER_AGENT'].mktime());
$pass = $_POST['pass'];
$email = $_POST['email'];
//Создаем запрос для записи данных в БД
$query = &quot;INSERT INTO users (nick,pass,email,regdate,uniq_id) VALUES('&quot;.strtolower($name).&quot;','$pass','$email', Now(), '$uniq_id')&quot;;
$r = mysql_query($query,$link) or die(&quot;Query failed : &quot; . mysql_error());
if($r) {
  echo 'Регистрация завершена успешно!';
}

}

} else { echo 'Регистрация невозможна: Введенный пароль пустой &lt;br&gt;&lt;a href=&quot;regank.php&quot;/&gt;назад&lt;/a&gt;';}

} else { echo 'Регистрация невозможна: Пользователь с таким именем уже существует&lt;br/&gt;&lt;a href=&quot;regank.php&quot;/&gt;назад&lt;/a&gt;';}
session_destroy();

} else { echo 'Регистрация невозможна: Код подтверждения введен не верно&lt;br/&gt;&lt;a href=&quot;regank.php&quot;/&gt;назад&lt;/a&gt;';}

?&gt;</pre>
			<p>Фрагмент 2.3.1&nbsp;&nbsp;&nbsp; </p>
			<p>В строке 3 вышеприведенного фрагмента мы проверяем на 
			существование переданную методом <span lang="en-us">POST </span>(те 
			есть произошел формы) переменной <span lang="en-us">
			<font color="#3B84D0">do</font>. </span>Это не что иное, как нажатая 
			кнопка Регистрация. Если эта переменная существует, значит была 
			предпринята регистрация и мы можем проверить еще пару переданных 
			переменных. В строке 5 производится сверка ввода цифрового кода и 
			сессионной переменной, из которой собственно и создана картинка 
			этого цифрового кода. Если пользователь ошибся с вводом цифрового 
			кода, то мы выведем соответствующее сообщение которое Вы можете 
			увидеть в строке 35 фрагмента. В том случае, если игрок ввел 
			цифровой код корректно в строках с 8-12 мы проверяем, присутствует 
			ли в таблице <span lang="en-us">users </span>такой логин и если да, 
			выведем в строке 32 сообщение об ошибке. Стандартная функция
			<span lang="en-us">PHP </span>для работы с базой данных
			<span lang="en-us">mySQL </span>mysql_affected_rows()<span lang="en-us">
			</span>возвращает число строк, которое затрагивает
			<span lang="en-us">sql</span>-запрос из 9 строки фрагмента (этот 
			запрос выбирает из <span lang="en-us">т</span>аблицы <b>
			<span lang="en-us">users</span></b> все строки, у которых поле 
			логина (<span lang="en-us">nick</span>)<span lang="en-us"> </span>
			равно введенному пользователем при регистрации). Если это число 
			равно нулю, то мы можем зарегистрировать нового игрока (все условия 
			выполнены!) , что мы и делаем в строках 22-23, выполняя
			<span lang="en-us">sql-</span>запрос <span lang="en-us">insert (</span>вставка<span lang="en-us">)</span> 
			введенных в форме данных в новую строку в таблице <span lang="en-us">
			<b>users</b>. </span>Так в нашей игре появился новый пользователь!<br>
			Хорошо, скажете Вы, а как мы вообще подключились к базе данных
			<span lang="en-us"><b>travgame</b>? </span>И будете совершенно 
			правы! Давайте вернемся к строкам 4-10 Фрагмента 2.2.3. Именно здесь 
			функция <span lang="en-us">PHP <font color="#3B84D0">mysql_connect</font></span><font color="#3B84D0">()</font><span lang="en-us">
			</span>проверяет возможность и осуществляет подключение к нашей базе
			<span lang="en-us"><b>travgame</b></span>. А параметры для 
			подключения она берет из файла config.inc.php, который подключается 
			к файлу <span lang="en-us">regank.php </span>пр помощи директивы
			<span lang="en-us">include.<br>
			</span>Что же содержится в файле config.inc.php?&nbsp; А находятся в 
			нем следующие строки:<br>


			</p>


<pre class="brush: php;">
&lt;?
//Данные для работы с MySQL
//Сервер
$DBSERVER = &quot;localhost&quot;;
//Пользователь и пароль
$DBUSER = &quot;root&quot;;
$DBPASS = &quot;&quot;;
//База данных
$DB = &quot;travgame&quot;;
?&gt;
</pre>
			Фрагмент 2.3.2<p>Как Вы видите, здесь происходит простая 
			инициализация переменных. <span lang="en-us">localhost - </span>это 
			имя нашего сервера (помните, Вы его еще прописывали в <b>dbForge Studio 
			for MySQL</b>). <span lang="en-us">root - </span>наш пользователь 
			базы данных <span lang="en-us"><b>travgame</b> (</span>он создался 
			автоматически еще когда Вы создавали базу данных в <b>PHPMyAdmin</b>
			<span lang="en-us">)</span>. Ну и&nbsp; <b>travgame</b> - имя нашей 
			базы данных. Все эти уже инициализированные переменные ($DBSERVER,$DBUSER,$DBPASS 
			и $DB) передаются в <span lang="en-us"><font color="#3B84D0">ф</span>ункцию
			<span lang="en-us">mysql_connect</span></font><font color="#3B84D0">()</font> 
			для подключения к базе <span lang="en-us">mySQL.</span><br>
			<br>
<br><font color="#4775a5"><strong>2.4. Сохранение данных на сервере</strong>
      
            <br></font><br>&nbsp;&nbsp; В предыдущем пункте нашего урока мы 
			вскользь рассмотрели сохранение введенной информации в базу данных. 
			Давайте остановимся на этом чуть подробнее. Как Вы помните, для 
			регистрации игрок заполняет на странице регистрации поля формы и 
			нажимает кнопку Регистрация. Если Вы внимательно посмотрите&nbsp; на 
			фрагменты 2.2.1, 2.2.2, и 2.2.5, то увидите, что все поля, которые 
			заполняет игрок имеют имена (ключевое слово <span lang="en-us">
			<font color="#3B84D0">name</font> </span>в <span lang="en-us">HTML
			</span>)<br>
			<span lang="en-us">1</span>. Поле ввода логина&nbsp; name='name'<br>
			2. Поле ввода пароля <span lang="en-us">&nbsp;</span>name='<span lang="en-us">pass</span>'<br>
			<span lang="en-us">3. </span>Поле для ввода электронного адреса&nbsp; name='email' 
			и т.д.<br>
			<br>
			Механизм приема данных из этих полей посредством языка
			<span lang="en-us">PHP </span>сводится к проверке специального 
			служебного массива <span lang="en-us">$_POST</span>, который 
			содержит все эти данные. Таким образом, чтоб узнать какой логин, 
			ввел игрок при регистрации, нужно обратиться к этому массиву 
			следующим образом:<br>
			<span lang="en-us">$_POST[&quot;name&quot;]&nbsp; </span>а, чтоб узнать пароль 
			- конечно же <span lang="en-us">$_POST[&quot;pass&quot;] </span>и т.д.&nbsp; 
			Таким образом становится понятным, что имя элемента массива <span lang="en-us">$_POST</span> 
			соответствует имени элемента заполняемой формы страницы в браузере 
			пользователя!<br>


            </p>


<pre class="brush: php;">
$pass = $_POST['pass'];
$email = $_POST['email'];
//Создаем запрос для записи данных в БД
$query = &quot;INSERT INTO users (nick,pass,email,regdate,uniq_id) VALUES('&quot;.strtolower($name).&quot;','$pass','$email', Now(), '$uniq_id')&quot;;
$r = mysql_query($query,$link) or die(&quot;Query failed : &quot; . mysql_error());
</pre>
			Фрагмент 2.4.1<br>
			<br>
			Перед использованием в строке запроса <span lang="en-us">INSERT
			</span>мы просто для наглядности присвоили значения из массива
			<span lang="en-us">$_POST </span>переменным $name, $pass, $email и 
			т.д.<br>
			Что касается <span lang="en-us">SQL-</span>запроса на вставку данных 
			в таблицу, то он имеет следующий формат &quot;<span lang="en-us">INSERT 
			INTO (</span>имена сто<span lang="en-us">л</span>бцов через запятую<span lang="en-us">)</span>
			<span lang="en-us">VALUES (</span>имена значений через запятую
			<span lang="en-us">)</span>&quot;. Тут все понятно, единственное для 
			заполнения поля regdate (это дата регистрации игрока в игре) мы 
			используем стандартную <span lang="en-us">PHP </span>функцию Now(), 
			возвращающую текущую дату сервера.<br>
			<br>
			У Вас может еще возникнуть вопрос, как формируется значение в 
			переменной <font color="#3B84D0">$uniq_id</font> и для чего ее 
			значение засовывать в поле uniq_id таблицы <span lang="en-us"><b>
			users</b>.<br>
			</span>Вообще-то это поле нам понадобится в дальнейшем при 
			авторизации игрока в игре. А форсируется она, как Вы&nbsp; видели в 
			фрагменте 2.3.1 следующим образом:<br>


<pre class="brush: php;">
$uniq_id = md5($_SERVER['REMOTE_ADDR'].$_SERVER['HTTP_USER_AGENT'].mktime());
</pre>
			Фрагмент 2.4.2<p>Служебный массив в <span lang="en-us">PHP </span>$_SERVER 
			хранит много интересной и полезной информации. В частности $_SERVER['REMOTE_ADDR'] 
			- это <span lang="en-us">IP </span>адрес, с которого заходит 
			регистрирующийся игрок.&nbsp; А $_SERVER['HTTP_USER_AGENT'] - это 
			строка, которую передает браузер и в которой есть данные о его 
			версии, типе и т.д. Ну а функция mktime() возвращает текущее время 
			сервера. Что касается функции md5 то она занимается тем, что создает 
			так называемый хэш строки. Таким образом мы заботимся об 
			уникальности этого значения, что впоследствии пригодится нам для 
			проверки авторизации игрока в игре, но об этом уже речь пойдет в 
			нашем следующем уроке, а также подтверждения регистрации!<br>
			<br>
			<font color="#4775A5"><b>2.5. Подтверждение регистрации по почте </b></font> <br>
            <br>
            &nbsp;&nbsp; Для того, чтоб немного защитить нашу игру от 
			нежелательных регистраций мы также сделаем механизм отправки писем с 
			подтверждением регистрации на <span lang="en-us">email </span>
			пользователей.<br>
			Но в связи с тем, что у нас учебный сервер <span lang="en-us">Denwer</span>, 
			а не реальный на хостинге какого-нибудь провайдера<span lang="en-us">
			</span>мы поступим следующим образом. В состав <span lang="en-us">
			Denwer </span>входит отладочный эмулятор отправки писем, который 
			называется&nbsp; <span lang="en-us">sendmail.exe</span>. В 
			действительности копии этой программы несколько раз попадаются в 
			папках с <span lang="en-us">Denwer</span>, но мы будем использовать 
			эту копию: <a href="file:///c:/Webservers/usr/sbin/sendmail.exe">
			c:\Webservers\usr\sbin\sendmail<span lang="en-us">.exe</span></a><span lang="en-us"> 
			(</span>Если Вы не изменяли пути при установке пакета, то именно 
			здесь Вы и найдете эту программу<span lang="en-us">) </span>. Сейчас 
			нам нужно будет сделать небольшие изменения в файле
			<span lang="en-us"><b>php.ini</b> </span>который размещен здесь:<br>
			<a href="file:///c:/Webservers/usr/sbin/sendmail.exe">
			c:\Webservers\usr<span lang="en-us">\local\php5\</span></a><br>
			Откройте файл <b><span lang="en-us">php.ini</span></b> в блокноте 
			или любой другой удобной для Вас программой и произведите следующие 
			изменения.<br>
			Найдите строки <br>
			<br>
			; For Unix only. You may supply arguments as well (default: &quot;sendmail 
			-t -i&quot;).<br>
			sendmail_path = \usr\sbin\sendmail -t -i<br>
			<br>
			и измените вторую строку на<br>
			sendmail_path = c:\Webservers\usr\sbin\sendmail -t -i<br>
			<br>
			После этого <u>обязательно</u> перезагрузите сервер (ярлычки
			<span lang="en-us">Denwer </span>на рабочем столе)<br>
			<br>
			Теперь все письма, которые будут отправляться из файлов
			<span lang="en-us">.php </span>будут накапливаться здесь:<br>
			<a href="file:///C:/WebServers/tmp/!sendmail">
			C:\WebServers\tmp\!sendmail</a></p>
			<p>или их можно будет просмотреть посредством специального скрипта:
			<a href="http://localhost/tests/sendmail/index.php">
			http://localhost/tests/sendmail/index.php</a><br>
			который есть в поставке пакета <span lang="en-us">Denwer.<br>
			<br>
			</span>Отлично! Нам остается немного изменить фрагмент 2.3.1 и 
			сделать в нем отправку писем о подтверждении регистрации на
			<span lang="en-us">e-mail </span>игроков. Конечно же они не будут 
			никуда уходить, но зато станут накапливаться в
			<a href="file:///C:/WebServers/tmp/!sendmail">
			C:\WebServers\tmp\!sendmail</a> , что для учебных целей нам вполне 
			подойдет.<br>
			Итак, добавим в фрагмент 2.3.1 после строки 24 следующие строки:<br>


			</p>


<pre class="brush: php;">
// Для отправки e-mail в виде HTML устанавливаем необходимый mime-тип и кодировку
$headers = 'MIME-Version: 1.0' . &quot;\r\n&quot;;
$headers .= 'Content-type: text/html; charset=windows-1251' . &quot;\r\n&quot;;
// Откуда пришло
$headers .= 'From: Travgame &lt;game@travgame.org&gt;'.&quot;\r\n&quot;;
//Здесь укажите электронный адрес, куда будут уходить сообщения
$subject = &quot;Подтверждение регистрaции на сайте&quot;;
$message = 'Для активации аккаунта пройдите по следующей ссылке 
&lt;a href=&quot;http://travgame/regank.php?activation='.$uniq_id.'&quot; target=&quot;_blank&quot;&gt;http://travgame/regank.php?activation='.$uniq_id.'&lt;/a&gt;';
$message .= 'или скопируйте ссылку в окно ввода адреса браузера и нажмите enter.';
//Отправляем сообщение
if(sendmail($email,$subject,$message,$headers) !== FALSE) {
echo 'Регистрация завершена, код активации отправлен Вам на электронный адрес!';
}</pre>
			<p>Фрагмент 2.5.1<br>
			<br>
			Здесь мы создаем переменную $headers, которую инициализируем по 
			правилам электронной почты, формирую ее как заголовок почтового 
			сообщения с указанием кодировки, адреса отправителя. $subject - это 
			тема письма, а $message - тело письма в котором мы прописываем 
			ссылку для подтверждения регистрации. Тело письма со ссылкой может 
			выглядеть примерно так:<br>
			<br>
			Для активации аккаунта пройдите по следующей ссылке &lt;a href=&quot;http://travgame/regank.php?activation=d7a984b1514b187df1262dd77ae51725&quot; 
			target=&quot;_blank&quot;&gt;http://travgame/regank.php?activation=d7a984b1514b187df1262dd77ae51725&lt;/a&gt;или 
			скопируйте ссылку в окно ввода адреса браузера и нажмите enter.<br>
			<br>
			В конце, функция отправки почты <font color="#3B84D0">sendmail(),</font> 
			которую Вы можете найти в подключаемом файле <b>functions.inc.php</b>, отправляет 
                        письмо игроку.<br>
			<br>
			Что ж, письмо отправлено, и нам нужно сделать механизм подтверждения 
			регистрации. Для этого добавим в наш многострадальный файл
			<b>regank.php </b>такие строки:<br>


			</p>


<pre class="brush: php;">
//Фрагмент отвечающий за активацию аккаунта
if($_GET['activation'] AND $_GET['activation']!='') {

  $uniq_id = $_GET['activation'];
  //Создаем запрос
  $r=@mysql_query(&quot;UPDATE users SET stat=1 WHERE uniq_id='&quot;.$uniq_id.&quot;' AND stat=0&quot;);
  if($r) {
    if( mysql_affected_rows() != 0) { 
      echo '&lt;h2&gt;Ваша учетная запись активирована.&lt;/h2&gt;&lt;br/&gt; Теперь вы можете &lt;a href=&quot;index.php&quot;&gt;войти на сайт&lt;/a&gt; используя данные
указанные при регистрации';
    } else { echo 'Непредвиденная ошибка!'; }
  } else { echo 'Ошибка активации!'; }
}</pre>
			<p>Фрагмент 2.5.2</p>
			<p>Здесь все просто, мы проверяем переданную строку активации 
			методом <span lang="en-us">GET, </span>т.е. $_GET['activation'] и 
			ищем в таблице <span lang="en-us">users </span>поле uniq_id с таким 
			значением, если находим, присваиваем полю stat в этой найденной 
			строке число 1, это означает, что регистрация успешно подтверждена.<br>
			Все созданные в нашем занятии скрипты и картинки Вы можете найти
			<a href="www">здесь</a>.<br>
			<br>
			<br>
			<b>В следующем уроке</b> мы <span lang="ru">с Вами создадим карту 
			поселков нашей стратегической игры в псевдо-изометрической проекции, научимся производить ее скроллинг, для того, чтоб видеть
                        всех соседей, создаваемого нами игрового мира</span>.&nbsp;<br>
            <br>
            </p>
            <p></p>
            <p></p></font>
            </td>
            <td background="index_files/m_right_m.gif" width="9"><img height="4" src="index_files/m_right_m.gif" width="9" border="0"></td>
          </tr>
        </tbody>
      </table>
      <table cellpadding="0" cellspacing="0" width="100%">
        <tbody>
          <tr>
            <td background="index_files/m_left_m.gif" width="9"></td>
            <td class="newsbody" bgcolor="#fdfdfd">&nbsp;</td>
            <td class="newsbody" bgcolor="#fdfdfd">
            <div class="nav" align="right">Blitz-School© </div>
            </td>
            <td background="index_files/m_right_m.gif" width="9"><img height="4" src="index_files/m_right_m.gif" width="9" border="0"></td>
          </tr>
        </tbody>
      </table>
      <table cellpadding="0" cellspacing="0" height="7" width="100%">
        <tbody>
          <tr>
            <td background="index_files/m_left_b.gif" width="13"><img height="7" src="index_files/m_left_b.gif" width="13" border="0"></td>
            <td background="index_files/m_center_b.gif"><img height="1" src="index_files/spacer.gif" width="1"></td>
            <td width="13"><img height="7" src="index_files/m_right_b.gif" width="13" border="0"></td>
          </tr>
        </tbody>
      </table>
      </div>
      </td>
      <td background="index_files/right_back.gif" valign="top" width="13">&nbsp;</td>
    </tr>
  </tbody>
</table>
<table cellpadding="0" cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td background="index_files/bottom_left.png" height="51" valign="top" width="254">
      <div class="date" style="MARGIN-TOP: 12px; FONT-SIZE: 10px; MARGIN-LEFT: 45px; COLOR: white"><a style="COLOR: rgb(255,255,255)" href  ="index.phtml">Copyright</a>©
2005-2009.
GameSchool</div>
      </td>
      <td background="index_files/bottom.gif" valign="top">
      <div class="date" style="MARGIN-TOP: 12px; FONT-SIZE: 10px; MARGIN-LEFT: 20px; COLOR: rgb(143,145,147)" 
      ><!-- Bottom menu --><a title="Главная страница" style="COLOR: rgb(143,145,147)" href  ="http://www.blitz-school.info/index.phtml">Главная</a><img height="1" src="index_files/spacer.gif" width="22" align="middle">:<img height="1" src="index_files/spacer.gif" width="22" align="middle"><a href="http://www.blitz-school.info/login.phtml"><span style="COLOR: rgb(143,145,147)"  >Вход</span></a><img height="1" src="index_files/spacer.gif" width="22" align="middle">:<img height="1" src="index_files/spacer.gif" width="22" align="middle"><a href="http://www.blitz-school.info/response.phtml"><span style="COLOR: rgb(143,145,147)" 
      >Отзывы</span></a><img height="1" src="index_files/spacer.gif" width="22" align="middle">:<img height="1" src="index_files/spacer.gif" width="22" align="middle"><a href="http://www.blitz-school.info/contacts.phtml"><span style="COLOR: rgb(143,145,147)" 
      >Контакты</span></a><img height="1" src="index_files/spacer.gif" width="22" align="middle">:<img height="1" src="index_files/spacer.gif" width="22" align="middle"><a href="http://www.blitz-school.info/friends.phtml"><span style="COLOR: rgb(143,145,147)" 
      >Обмен ссылками</span></a> </div>
      </td>
      <td width="19"><img height="51" src="index_files/bottom_right.png" width="19" border="0"></td>
    </tr>
  </tbody>
</table>
<div id="menu" onmouseover="showLayer('menu'); Change('products', 'menu2')" onmouseout="hiddenLayer('menu'); Change('products', 'menu1')">
<table border="0" cellpadding="0" cellspacing="0">
  <tbody>
    <tr>
      <td style="WIDTH: 7px; HEIGHT: 7px"><img height="7" alt="" src="index_files/corner1.gif" width="7"></td>
      <td class="top"></td>
      <td style="WIDTH: 7px; HEIGHT: 7px"><img height="7" alt="" src="index_files/corner2.gif" width="7"></td>
    </tr>
    <tr>
      <td class="left"></td>
      <td class="text"><a href="reg.phtml">Курс обучения созданию игр
на Blitz3D</a><br>
      <a href="reg2.phtml">Курс
обучения созданию браузерных онлайновых игр</a> </td>
      <td class="right"></td>
    </tr>
    <tr>
      <td style="BACKGROUND: 0% 50%; WIDTH: 7px; HEIGHT: 7px; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial" 
      ><img height="7" alt="" src="index_files/corner4.gif" width="7"></td>
      <td class="bottom"></td>
      <td style="WIDTH: 7px; HEIGHT: 7px"><img height="7" alt="" src="index_files/corner3.gif" width="7"></td>
    </tr>
  </tbody>
</table>
</div>
</body></html>
