<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
  
  <meta http-equiv="Content-Language" content="ru">
  
  <title>Центр обучения созданию компьютерных игр</title>
  <meta name="description" content="Blitz-School - Школа создателей компьютерных игр на языке Blitz3D. Если вы хотите быстро научиться делать компьютерные игры или интересуетесь их созданием, то этот сайт будет вам полезен">
  <meta name="keywords" content="программирование, создание игр, курсы создания игр, школа создателей компьютерных игр, blitzbasic, компьютерные игры, как написать игру, как создать игру, программирование компьютерных игр, Blitz3D, программирование игр, разработка игр, создание 3d игр, аудио, графика, дизайн, 3D">
  <link rel="stylesheet" type="text/css" href="main.css">
  <script language="JavaScript" src="index_files/script.js" type="text/javascript"></script>
  <script type="text/javascript" src="scripts/shCore.js"></script>
  <script type="text/javascript" src="scripts/shBrushBash.js"></script>
  <script type="text/javascript" src="scripts/shBrushCpp.js"></script>
  <script type="text/javascript" src="scripts/shBrushCSharp.js"></script>
  <script type="text/javascript" src="scripts/shBrushCss.js"></script>
  <script type="text/javascript" src="scripts/shBrushDelphi.js"></script>
  <script type="text/javascript" src="scripts/shBrushDiff.js"></script>
  <script type="text/javascript" src="scripts/shBrushGroovy.js"></script>
  <script type="text/javascript" src="scripts/shBrushJava.js"></script>
  <script type="text/javascript" src="scripts/shBrushJScript.js"></script>
  <script type="text/javascript" src="scripts/shBrushPhp.js"></script>
  <script type="text/javascript" src="scripts/shBrushPlain.js"></script>
  <script type="text/javascript" src="scripts/shBrushPython.js"></script>
  <script type="text/javascript" src="scripts/shBrushRuby.js"></script>
  <script type="text/javascript" src="scripts/shBrushScala.js"></script>
  <script type="text/javascript" src="scripts/shBrushSql.js"></script>
  <script type="text/javascript" src="scripts/shBrushVb.js"></script>
  <script type="text/javascript" src="scripts/shBrushXml.js"></script>
  <script type="text/javascript" src="scripts/shBrushBlitz3D.js"></script>
  <link type="text/css" rel="stylesheet" href="styles/shCore.css">
  <link type="text/css" rel="stylesheet" href="styles/shThemeDefault.css">
  <script type="text/javascript">
SyntaxHighlighter.config.clipboardSwf = 'scripts/clipboard.swf';
SyntaxHighlighter.all();
  </script>
  <meta content="MSHTML 6.00.6000.20772" name="GENERATOR"></head>

<body topmargin="0" leftmargin="0" style="BACKGROUND-COLOR: rgb(255,255,255)" marginheight  ="0" marginwidth="0">
<table cellpadding="0" cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td rowspan="2" height="197" width="21"><img height="197" src="index_files/ltoptable.png" width="21" border="0"></td>
      <td colspan="5" valign="top">
      <table cellpadding="0" cellspacing="0" width="100%">
        <tbody>
          <tr>
            <td height="49" width="231"><img height="49" src="index_files/topmenu.png" width="231" usemap="#ImageMap1" border="0"></td>
            <td background="index_files/mtop.gif"><map name="ImageMap1"><area onclick="this.style.behavior='url(#default#homepage)';this.setHomePage('http://www.blitz-school.info'); return false;" shape="RECT" coords="17,26,71,40" href="index.phtml"><area shape="RECT" coords="91,27,149,39" href="javascript:window.external.AddFavorite('http://www.blitz-school.info', 'GameSchool - Центр обучения созданию компьютерных игр!')"></map>
            <div class="searchform" align="right">
            <form method="post"><input value="search" name="do" type="hidden">&nbsp;</form>
            </div>
            </td>
            <td height="49" width="13"><img height="49" src="index_files/mlefttop.png" width="13" border="0"></td>
          </tr>
        </tbody>
      </table>
      </td>
    </tr>
    <tr>
      <td height="148" valign="top" width="225">
      <table cellpadding="0" cellspacing="0" height="148" width="100%">
        <tbody>
          <tr>
            <td height="119" width="225"><a title="Центр обучения созданию компьютерных игр" href="index.phtml"><img height="119" src="index_files/title.png" width="225" border="0"></a></td>
          </tr>
          <tr>
            <td background="index_files/date_b.png" valign="bottom">
            <div class="date" style="FONT-SIZE: 11px; MARGIN-BOTTOM: 10px; MARGIN-LEFT: 12px">
            <script language="JavaScript1.2">
<!-- Begin
var months=new Array(13);
months[1]="января";
months[2]="февраля";
months[3]="марта";
months[4]="апреля";
months[5]="мая";
months[6]="июня";
months[7]="июля";
months[8]="августа";
months[9]="сентября";
months[10]="октября";
months[11]="ноября";
months[12]="декабря";
var time=new Date();
var lmonth=months[time.getMonth() + 1];
var date=time.getDate();
var year=time.getYear();
var hours=time.getHours();
var minutes=time.getMinutes();
if (eval(hours) <10) {hours="0"+hours}
if (eval(minutes) < 10) {minutes="0"+minutes}
if (year < 2000)
year = year + 1900;
document.write("Сейчас: " + date + " ");
document.write(lmonth + " " + year + ", " + hours + ":" + minutes + " ");

// End -->

           </script>
            </div>
            </td>
          </tr>
        </tbody>
      </table>
      </td>
      <td width="296"><img height="148" src="index_files/mainleft.jpg" width="296" border="0"></td>
      <td width="205"><img height="148" src="index_files/mainright.jpg" width="205" border="0"></td>
      <td background="index_files/mback.png">&nbsp;</td>
      <td height="148" width="58"><img height="148" src="index_files/mltopr.png" width="58" border="0"></td>
    </tr>
  </tbody>
</table>
<table bordercolordark="black" bordercolorlight="black" cellpadding="0" cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td background="index_files/anek_tb.png" height="27" valign="top" width="254">
      <div class="lefttext"><b>Меню:</b></div>
      </td><?php include 'menu_top.php'; ?> <td background="index_files/nav_back.gif">&nbsp;</td>
      <td width="17"><img height="27" src="index_files/nav_end.png" width="17" border="0"></td>
    </tr>
  </tbody>
</table>
<table cellpadding="0" cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td background="index_files/lefttable.gif" valign="top" width="254"><!-- Menu -------->
      <div style="MARGIN-LEFT: 21px">
      <table cellpadding="0" cellspacing="0">
        <tbody>
          <tr>
            <td background="index_files/tb_back.gif">
            <div class="style3"><img src="index_files/home.gif"><a href="http://www.blitz-school.info/index.phtml">Главная</a><br>

        <img src="index_files/pages.gif"> <b>Перечень курсов</b><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/blitzindex.phtml">Создание 3D игр на Blitz3D</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/ogindex.phtml">Создание браузерной РПГ</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/egindex.phtml">Создание экономической браузерки</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/mgindex.phtml">Создание мобильных игр</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/cppindex.phtml">Создание 3D игр на С++</a><br>
        <img src="index_files/group.gif"> <a href="http://www.blitz-school.info/begin_study.phtml">Как стать слушателем</a><br>
        <img src="index_files/recom.gif"> <a href="http://www.blitz-school.info/study_tech.phtml">Технология обучения</a><br>
        <img src="index_files/loyalty_sm.jpg"> <a href="http://www.blitz-school.info/loyalty.phtml">Программа лояльности</a>
        <br>
&nbsp;&nbsp;&nbsp;&nbsp;
    <img border="0" src="index_files/navdiv.gif" width="80" height="4">
        <br><img src="index_files/newuser.gif"> <b>Регистрация</b><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/reg.phtml">Курс 3D игр на Blitz3D</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/reg2.phtml">Курс браузерной RPG</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/reg3.phtml">Экономическая браузерка</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/reg4.phtml">Курс мобильных игр</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a href="http://www.blitz-school.info/reg5.phtml">3D игры на С++</a><img src="index_files/new.gif"><br>
        <img src="index_files/admin.gif"> <a href="http://www.blitz-school.info/login.phtml">Вход для слушателей</a><br>
        <img src="index_files/study.gif"> <a href="http://www.blitz-school.info/program.phtml">Учебные программы курсов</a><br>
        <img src="index_files/society.gif"> <a href="http://www.blitz-school.info/response.phtml">Отзывы</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;
    <img border="0" src="index_files/navdiv.gif" width="80" height="4">
        
        <br><img src="index_files/media.gif"> <a href="http://www.blitz-school.info/distant.phtml">О дистанционном образовании</a><br>
        <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/articles.phtml">Статьи</a><br>
        <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/less_ex.phtml">Изложение материала</a><br>
        <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/gallery.phtml">Галерея</a><br> 
        <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/links.phtml">Полезные ссылки</a><br>
        <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/contacts.phtml">Контакты</a><br>
       <img src="index_files/media.gif"> <a href="http://www.blitz-school.info/friends.phtml">Обмен ссылками</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;

            </div>
            </td>
          </tr>
          <tr>
            <td width="222"><img height="8" src="index_files/tb_b.gif" width="222" border="0"></td>
          </tr>
        </tbody>
      </table>
      </div><!-- ------------------ end of menu ------------------- --> </td>
      <td class="news" valign="top">
      <script language="javascript" type="text/javascript">
      </script>
      <div style="MARGIN-TOP: 7px">
      <table cellpadding="0" cellspacing="0" width="100%">
        <tbody>
          <tr>
            <td width="13"><img height="24" src="index_files/m_left.gif" width="13" border="0"></td>
            <td class="newstitle" background="index_files/m_center.gif">
            <b>Занятие
<span lang="en-us">7</span></b></td>
            <td class="newstitle" align="right" background="index_files/m_center.gif">&nbsp;</td>
            <td width="9"><img height="24" src="index_files/m_right.gif" width="9" border="0"></td>
          </tr>
        </tbody>
      </table>
      <table cellpadding="0" cellspacing="0" width="100%">
        <tbody>
          <tr>
            <td background="index_files/m_left_m.gif" width="4">&nbsp;</td>
            <td class="newsbody" bgcolor="#fdfdfd">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <font size="3"><b>Поселок ч.3. Другие постройки<br>
			</b></font>
            <br>
            <span lang="en-us"><font color="#4775A5"><b>7</b></font></span><b><font color="#4775a5">.1. 
			</font><font color="#4775A5">Тайник </font><br>
            <br>
&nbsp;</b><span lang="en-us">&nbsp;</span>Приветствуем Вас, уважаемый коллега по 
			игродельческому мастерству и сегодня мы продолжим рассмотрение 
			строительства зданий в поселке игрока и на первом месте у нас идет 
			тайник. Тайник - нужен в игре для того, чтоб прятать от набегов 
			враждебных войск излишки ресурсов. Картинку для отображения тайника 
			в поселке будем использовать эту:<br>
			<img border="0" src="www/img/vill/g23.gif" width="75" height="65"><br>
			<br>
			Для начала мы должны добавить тип этой постройки в нашу справочную 
			таблицу <b>
			building_types</b><span lang="en-us">.</span>
			<br>
<pre class="brush: sql;">insert into building_types (bt_id,bt_name,bt_image,bt_image_not_ready,bt_description,bt_ycoord_dif,bt_template) 
values (11,'Тайник','img/vill/g23.gif','img/vill/g23b.gif','При набеге на Вашу деревню ее жители прячут в тайник часть сырья.',22,'tpl_g23');
</pre>Фрагмент <span lang="en-us">7</span>.1.1<p>Затем мы добавляем несколько уровней апгрейдов 
			тайника в таблицу
			<b>build_levels_cost</b>.<br>
			</p>
<pre class="brush: sql;">/*тайник*/
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_space, blc_time_upgrade) 
values (11,0,0,0,0,0,0,0,'0:00:00');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_space, blc_time_upgrade) 
values (11,1,40,50,30,10,0,100,'0:09:40');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_space, blc_time_upgrade) 
values (11,2,50,65,40,15,0,130,'0:15:10');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_space, blc_time_upgrade) 
values (11,3,65,80,50,15,0,170,'0:21:20');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_space, blc_time_upgrade) 
values (11,4,85,105,65,20,0,220,'0:28:40');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_space, blc_time_upgrade) 
values (11,5,105,135,80,25,0,280,'0:37:10');
</pre>Фрагмент 7.1.2<br>
			<br>
			Как Вы видите, для тайника тоже характерно поле blc_space, как для 
			склада и амбара и значение в этом поле показывает, сколько может 
			быть спрятано ресурсов в этом тайнике. Чем выше уровень тайника, тем 
			больше ресурсов может быть спрятано в случае набега врага.<p>Вы помните, что для &quot;входа&quot; в какое-то здание&nbsp; из карты поселка 
			у нас применяется скрипт <b> <span lang="en-us">build.php</span></b>, а к нему 
			подключаются шаблоны, характерные для каждого здания. И у тайника 
			тоже есть свой простенький шаблон. Как Вы видели из справочника <b>building_types</b> 
			<span lang="en-us">&nbsp;</span>для тайника название шаблона - <b>
			tpl_g23</b><span lang="en-us"><b>.php</b></span> .<span lang="en-us">
			</span>Вот его содержимое:</p>


<pre class="brush: php;">
 // Тайник
echo '&lt;table cellpadding=&quot;5&quot; cellspacing=&quot;1&quot; id=&quot;build_value&quot;&gt;&lt;tr&gt;
&lt;td &gt;Тайник:&lt;/td&gt;
&lt;td &gt;&lt;b&gt;'.get_res_space( $b_level, 11 ).'&lt;/b&gt; ед. сырья&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td &gt;Тайник на уровне '.($b_level+1).':&lt;/td&gt;
&lt;td &gt;&lt;b&gt;'.get_res_space( $b_level + 1, 11 ).'&lt;/b&gt; ед. сырья&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;'; 
</pre>
			Фрагмент 7.1.<span lang="en-us">3</span>.<p>Тут все просто, рисуем 
			табличку и вписываем вместимость тайника на текущем и следующем 
			уровне, используя функцию <font color="#3B84D0">get_res_space</font>, 
			которую ранее применяли&nbsp; для амбара и склада.<br>
			<br>
			После добавления в наш скрипт <span lang="en-us">travgame.sql </span>
			фрагментов 7.1.1 и 7.1.2 и пересоздания базы можно построить тайник, 
			щелкнув на любую стройплощадку и выбрав из списка доступных построек 
			созданным нами тип тайника. После этого при &quot;входе&quot; в еще строящееся 
			здание мы увидим следующую картину:<br>
			<br>
			<img border="0" src="pics/tajn.png" width="517" height="364"><br>
			Рисунок 7.1.1<br>
			<br>
			<font color="#4775A5"><b><span lang="en-us"><br>
			<br>
			7</span></b></font><b><font color="#4775a5">.2. 
			</font></b><font color="#4775A5"><b>Рынок<br>
			<br>
			</b></font>&nbsp;&nbsp; Какая современная браузерная игра обходится 
			без торговых операций. Более подробно сами торговые операции мы 
			рассмотрим в следующем Занятии, полностью посвященному торговле и 
			торговцам в нашей игре. А сегодня мы мы создадим саму постройку - 
			рынок и сделаем заготовки - шаблоны под все виды торговых операций. 
			И если все ранее рассмотренные шаблоны для зданий состояли из одного 
			файла, то для рынка у нас будет сразу четыре шаблона! А пока что - 
			вот как выглядит картинка рынка:<br>
			<br>
			<img border="0" src="www/img/vill/g17.gif" width="75" height="60"><br>
			<br>
&nbsp;</p>
			ПО сложившейся традиции мы должны добавить тип этой постройки в нашу 
			справочную таблицу <b>
			building_types</b><span lang="en-us">.</span>
			<br>
<pre class="brush: sql;">insert into building_types (bt_id,bt_name,bt_image,bt_image_not_ready,bt_description,bt_ycoord_dif,bt_template) 
values (12,'Рынок','img/vill/g17.gif','img/vill/g17b.gif','На рынке можно обменяться с другими игроками сырьем.',22,'tpl_g17');</pre>Фрагмент 
			<span lang="en-us">7</span>.2.1<p>И после этого мы добавляем несколько уровней апгрейдов 
			рынка в таблицу
			<b>build_levels_cost</b>.<br>
			</p>
<pre class="brush: sql;">/*рынок*/
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_time_upgrade) 
values (12,0,0,0,0,0,0,'0:00:00');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_time_upgrade) 
values (12,1,80,70,120,70,4,'0:23:40');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_time_upgrade) 
values (12,2,100,90,155,90,2,'0:30:10');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_time_upgrade) 
values (12,3,130,115,195,115,2,'0:39:20');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_time_upgrade) 
values (12,4,170,145,250,145,2,'0:49:40');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_time_upgrade) 
values (12,5,215,190,320,190,2,'1:01:40');
</pre>Фрагмент 7.2.2<p>После внесения в наш скрипт <span lang="en-us">
			travgame.sql </span>фрагментов 7.2.1 и 7.2.2 и пересоздания базы 
			можно приступить к постройке рынка, щелкнув на любую стройплощадку и 
			выбрав из списка доступных построек созданным нами тип рынка.<br>
			<br>
			Какие же торговые операции будут осуществляться на нашем рынке?<br>
			<br>
			1.<font color="#3B84D0"><b> Отправка ресурсов</b></font> - в этой 
			операции мы будем просто указывать сколько ресурсов и какого типа 
			отправить в какой поселок.<br>
			2. <font color="#3B84D0"><b>Покупка ресурсов</b></font> - в этой 
			операции мы будем выбирать из таблицы рыночных предложений, то 
			предложение об обмене один тип ресурса на <br>
&nbsp;&nbsp;&nbsp; другой, который нас в данный момент устраивает.<br>
			3. <font color="#3B84D0"><b>Продажа ресурсов </b></font>- здесь мы 
			сами задаем, какой тип ресурса на какой мы хотели бы обменять на 
			рынке. <br>
			4. <font color="#3B84D0"><b><span lang="en-us">NPC</span> торговец</b></font> 
			- это просто скрипт, который поможет распределить ресурсы и 
			подсчитать остатки от распределения.<br>
			<br>
			Как мы уже упоминали,&nbsp; у нас с Вами будет 4 шаблона для этих 
			операций. Первый и основной будет носить имя, как указано в 
			справочной таблице <b>
			building_types </b>и это имя - <b>tpl_g17<span lang="en-us">.php</span></b>.<span lang="en-us">
			</span>Обратите также внимание, что мы теперь в справочной таблице 
			стали писать название шаблона без <span lang="en-us">.php. </span>А 
			это расширение добавляется уже при вызове из&nbsp; <b> <span lang="en-us">build.php</span></b><span lang="en-us">.
			</span>Это связано с необходимостью манипуляции несколькими 
			страницами шаблонов для одного здания<span lang="en-us">.<br>
			</span>Итак, для начала, шаблон <b>tpl_g17<span lang="en-us">.php</span></b>:</p>


<pre class="brush: php;">
// Рынок

echo &quot;&lt;div id='textmenu'&gt;
&lt;a href='build.php?bnum=$bnum' class='selected'&gt;Отправить&lt;/a&gt;
| &lt;a href='build.php?bnum=$bnum&amp;p=2'&gt;Покупка&lt;/a&gt;
| &lt;a href='build.php?bnum=$bnum&amp;p=3'&gt;Продажа&lt;/a&gt;
| &lt;a href='build.php?bnum=$bnum&amp;p=4'&gt;NPC-торговец&lt;/a&gt;
&lt;/div&gt;&quot;;

echo '&lt;br&gt;Каждый Ваш торговец может переносить до 500 единиц сырья.&lt;br&gt;'; 
</pre>
			Фрагмент 7.2.<span lang="en-us">3</span><p>Вы видите, что мы 
			создаем что-то типа меню и текущий элемент меню выделен (определен 
			как class='selected' , посмотрите&nbsp; файле стилей
			<span lang="en-us"><b>start.css</b> </span>что из себя представляет 
			определение <font color="#3B84D0"><span lang="en-us">a</span>.selected</font>)<span lang="en-us">
			</span>подчеркиванием.<span lang="en-us"> </span>По сути каждый 
			элемент это ссылка<span lang="en-us">,</span> вызывающая один и тот 
			же файл <b>build.php </b>и передающая в<span lang="en-us"> </span>
			него номер здания и номер страницы (<span lang="en-us">p</span>=<span lang="en-us">2,3
			</span>или 4). Если номер страницы не передается, значит это главная 
			страница шаблона (т.е. <b>tpl_g17<span lang="en-us">.php</span></b>)<span lang="en-us">
			</span>В файле <b>build.php </b>обрабатывается номер страницы 
			следующим образом:</p>


<pre class="brush: php;">
// есть подменю в здании?
if( $_GET['p'] &lt;&gt; '' ){
  $page = &quot;_&quot;.$_GET['p'];
}
</pre>
			Фрагмент 7.2.<span lang="en-us">4<br>
			<br>
			</span>И подключение шаблона теперь осуществляется так:<pre class="brush: php;">
 @include(&quot;tpl/&quot;.$bt_template.$page.'.php');
</pre>
			Фрагмент 7.2.<span lang="en-us">5<br>
			<br>
			</span>Из фрагментов 7.2.4 и 7.2.5 видно, что если, например передан 
			номер страницы <b>2</b>, то <b>build.php </b>попытается подключить 
			шаблон <b>tpl/tpl_g17<span lang="en-us">_</span>2<span lang="en-us">.php</span></b>, 
			если передан номер страницы <b>3</b>, то - <b>tpl/tpl_g17<span lang="en-us">_</span>3<span lang="en-us">.php</span></b> 
			и т.д.<br>
			Значит нам нужно создать все эти шаблоны (<b>tpl_g17<span lang="en-us">.php</span>, tpl_g17<span lang="en-us">_</span>2<span lang="en-us">.php</span>, tpl_g17<span lang="en-us">_</span>3<span lang="en-us">.php</span>, tpl_g17<span lang="en-us">_</span>4<span lang="en-us">.php</span></b>). 
			Пока что в них будет находится одна и та же информация как во 
			фрагменте 7.2.3. Единственное - в каждом шаблоне нужно выделить 
			подчеркиванием&nbsp; свой (текущий) пункт меню. Откройте эти 
			шаблоны, которые находятся <a href="www/tpl">здесь</a> и посмотрите 
			как это сделано. А выглядит это так:<br>
			<br>
			<img border="0" src="pics/mark1.png" width="513" height="293"><br>
			<br>
			Рисунок 7.2.1<br>
			<br>
			<br>
            <br><span lang="en-us"><font color="#4775A5"><b>7</b></font></span><font color="#4775a5"><font ><b>.3. 
			Резиденция, Таверна
     </b></font><br></font>
            <br>
&nbsp;&nbsp; Оба этих здания нужны в основном для экспансии - то есть захвата 
			других земель. Резиденция нужна для основания нового поселения, а 
			Таверна для тренировки героя и захвата оазисов (захват оазисов и 
			создание героя мы рассмотрим в 10 занятии). <br>
&nbsp;&nbsp;&nbsp; Сперва рассмотрим Резиденцию и картинка для нее у нас будет 
			следующей:<br>
			<br>
			<img border="0" src="www/img/vill/g25.gif" width="75" height="90"><br>
			<br>
&nbsp;&nbsp; Резиденция, как и рынок будет у нас иметь шаблон, состоящий из 
			нескольких файлов,<br>
			<br>
			1. Пункт меню: Обучить - файл <b>tpl_g25<span lang="en-us">.php</span>
			</b>&nbsp;(после 10 уровня резиденции, можно проводить основание 
			новых поселений)<br>
			2. Пункт меню: Культура - файл <b>tpl_g25<span lang="en-us">_</span>2<span lang="en-us">.php</span>
			</b>&nbsp;(В поселке накапливаются единицы культуры, которые нужны 
			для экспансии)<br>
			3. Пункт меню: Одобрение - файл <b>tpl_g25<span lang="en-us">_</span>3<span lang="en-us">.php</span>
			</b>&nbsp;(на этой странице показывается лояльность населения к 
			захватам чужих земель)<br>
			4. Пункт меню: Экспансия - файл <b>tpl_g25<span lang="en-us">_</span>4<span lang="en-us">.php</span>
			</b>&nbsp;(здесь можно увидеть захваченные нашим поселком земли)<br>
			<br>
			<br>
			Более подробно мы рассмотрим только накопление единиц культуры, а 
			сейчас поглядим как выглядят наши шаблоны для Резиденции. Первый 
			шаблон с именем <b>tpl_g25<span lang="en-us">.php</span> </b>
			выглядит так:<pre class="brush: php;">
// Резиденция

echo &quot;&lt;div id='textmenu'&gt;
&lt;a href='build.php?bnum=$bnum' class='selected '&gt;Обучить&lt;/a&gt;
| &lt;a href='build.php?bnum=$bnum&amp;amp;p=2'&gt;Культура&lt;/a&gt;
| &lt;a href='build.php?bnum=$bnum&amp;amp;p=3'&gt;Одобрение&lt;/a&gt;
| &lt;a href='build.php?bnum=$bnum&amp;amp;p=4'&gt;Экспансия&lt;/a&gt;
&lt;/div&gt;&quot;;

if ($b_level &lt; 10 ) { 
echo '&lt;br&gt;Для основания следующего поселения или захвата деревни требуется резиденция с уровнем 10.&lt;br&gt;';
} 
</pre>
			Фрагмент 7.3.1<br>
			<br>
			Здесь особых комментариев делать не нужно. И мы сразу перейдем ко 
			второму шаблону&nbsp; <b>tpl_g25<span lang="en-us">_</span>2<span lang="en-us">.php</span></b>:<pre class="brush: php;">
// Резиденция

echo &quot;&lt;div id='textmenu'&gt;
&lt;a href='build.php?bnum=$bnum'&gt;Обучить&lt;/a&gt;
| &lt;a href='build.php?bnum=$bnum&amp;amp;p=2' class='selected '&gt;Культура&lt;/a&gt;
| &lt;a href='build.php?bnum=$bnum&amp;amp;p=3'&gt;Одобрение&lt;/a&gt;
| &lt;a href='build.php?bnum=$bnum&amp;amp;p=4'&gt;Экспансия&lt;/a&gt;
&lt;/div&gt;&quot;;

echo '&lt;br&gt; Для развития Вашей Империи необходимы единицы культуры. Их количество со временем увеличивается. 
С развитием Ваших зданий увеличивается прирост единиц культуры.&lt;br&gt;';

echo '&lt;br&gt;Производится в данной деревне: &lt;b&gt;'.get_culture_points( $fid ).'&lt;/b&gt; единиц культуры в сутки. &lt;br&gt;';

echo '&lt;br&gt;В общем было произведено &lt;b&gt;'.get_user_cp_all( $_SESSION['usr_id'] ).'&lt;/b&gt; единиц культуры. Для основания следующего поселения или 
захвата деревни требуется &lt;b&gt;2000&lt;/b&gt; единиц культуры.&lt;br&gt;';

update_culture_points( $fid );

</pre>
			Фрагмент 7.3.2<p>Как видите, здесь уже немного интереснее. 
			Используются какие-то незнакомые функции! Например
			<font color="#3B84D0">get_culture_points</font> с которой мы и 
			начнем. Единицы культуры в поселке зависят от количества зданий и их 
			уровня. Придумаем какую-нибудь формулу. К примеру такую: <br>
			<span lang="en-us">CulturePoints = (building_level*2+building_level)*qty</span>, 
			где<br>
			<span lang="en-us"><br>
			CulturePoints </span>&nbsp;- количество единиц культуры в сутки<br>
			<span lang="en-us">building_level</span> - уровень здания <br>
			<span lang="en-us">qty</span> - количество зданий<br>
			<br>
			Исходя из этих соображений функция <font color="#3B84D0">
			get_culture_points</font> будет выглядеть так:</p>


<pre class="brush: php;">
/////// посчитаем кол-во единиц культуры от всех зданий //////////////
function get_culture_points( $fid ){
$culture = 0;
$res = mysql_query(&quot;SELECT b_level from buildings where fid=$fid&quot; ) 
or die(&quot;Query failed : &quot; . mysql_error());
while ($row = mysql_fetch_array( $res )) {
$culture += $row[&quot;b_level&quot;] * 2 + $row[&quot;b_level&quot;];
} 
return ( $culture );
</pre>
			Фрагмент 7.3.3<p>Вы видите, что мы перебрали все здания в нашем 
			поселке и применили выше придуманную формулу для подсчета единиц 
			культуры и вернули подсчитанное значение оператором
			<span lang="en-us">return.<br>
			<br>
			</span>Теперь пришла очередь функции <font color="#3B84D0">
			get_user_cp_all</font>. Она выводит количество единиц культуры уже 
			накопленных в нашем поселке. Как жаль, что мы не позаботились о 
			хранении этой величины и нам предстоит это сделать сейчас. Для этого 
			в таблице <span lang="en-us"><b>users</b> </span>мы сделаем еще одно 
			одно поле <b>culture_points</b> в котором и будем хранить единицы 
			культуры. В принципе можно было хранить и в таблице <b>
			<span lang="en-us">fields</span></b>, но это уже на Ваше усмотрение, 
			можно хранить это значение для всех поселков в таблице
			<span lang="en-us"><b>users</b> </span>&nbsp;или для каждого поселка 
			игрока (если их будет больше, чем 1) отдельно в таблице <b>
			<span lang="en-us">fields</span></b>. А пока что, вот эта процедура:</p>


<pre class="brush: php;">
// сколько всего единиц культуры уже накоплено?
function get_user_cp_all( $user_id ){
$res = mysql_query(&quot;SELECT culture_points from users where usr_id=$user_id&quot; ) 
or die(&quot;Query failed : &quot; . mysql_error());
$row = mysql_fetch_array( $res );
return ( $row[&quot;culture_points&quot;] );
}
</pre>
			Фрагмент 7.3.4<p>Кроме поля <b>culture_points</b> нам понадобится 
			еще поле, где будет хранится время последнего апдейта информации о 
			единицах культуры - <b>time_up</b>.</p>
			Вот эти поля мы добавляем в скрипт таблицы <span lang="en-us"><b>users</b>:</span><br>
<pre class="brush: sql;">time_up bigint DEFAULT 0, /*время обновления страниц игры (доб.7 урок)*/
culture_points bigint DEFAULT 0, /*единицы культуры (доб. 7 урок)*/ 
</pre>Фрагмент <span lang="en-us">7</span>.3.5<br>
			<br>
			И теперь осталось сделать функцию, которая будет отслеживать, 
			сколько же единиц культуры у нас накопилось. Назовем ее
			<font color="#3B84D0">update_culture_points</font>. Вот как она 
			выглядит:<pre class="brush: php;">
// расчитываем и обновляем единицы культуры //
function update_culture_points( $fid ){

$cpsec = get_culture_points( $fid )/86400;
$timedif = time() - get_user_time_up( $_SESSION['usr_id'] );
$gencp = $cpsec*$timedif;
if( $gencp &gt; 1 ) {
  $gencp = ceil($gencp);
  $res = mysql_query(&quot;update users set culture_points = culture_points + $gencp, time_up = &quot;.time().&quot; where usr_id=&quot;.$_SESSION['usr_id'] ) 
  or die(&quot;Query failed : &quot; . mysql_error());
} 
}
</pre>
			Фрагмент 7.3.6<p>Эта функция использует еще одну маленькую функцию
			<font color="#3B84D0">get_user_time_up</font>, которая возвращает 
			время последнего апдейта из поля <b>time_up</b> таблицы
			<span lang="en-us"><b>users</b>.</span></p><pre class="brush: php;">
// время последнего обновления страниц игры
function get_user_time_up( $user_id ){
$res = mysql_query(&quot;SELECT time_up from users where usr_id=$user_id&quot; ) 
or die(&quot;Query failed : &quot; . mysql_error());
$row = mysql_fetch_array( $res );
return ( $row[&quot;time_up&quot;] );
}
</pre>
			Фрагмент 7.3.<span lang="en-us">7</span><p>Возвращаясь к фрагменту 
			7.3.6, мы видим, что сперва мы находим число генерации единиц 
			культуры в секунду (86400 - это число секунд в сутках, т.е. 
			60*60*24). Далее мы находим, сколько времени уже прошло с того 
			момента как мы последний раз интересовались единицами культуры. 
			Затем перемножим кол-во единиц культуры в секунду на количество 
			секунд, прошедших со времени последнего апдейта этой информации и 
			если результат больше единицы, то значит накопилось еще немного 
			единиц культуры и мы можем выполнить запрос на обновление этого 
			количества в таблице <b>users</b> , а заодно и пропишем время 
			текущего апдейта. Как Вы поняли, мы не делаем апдейт времени, пока 
			не накопится хотя бы одна единица культуры!<br>
			Вот как выглядит страница, создаваемая фрагментом&nbsp; 7.3.2:<br>
			<br>
			<img border="0" src="pics/cult_ed.png" width="512" height="438"><br>
			<br>
			Рисунок 7.3.1</p>
			<p>Чтоб посмотреть как производятся единицы культуры в реальном 
			времени (потому что при 21 единицы культуры в сутки, мы будем ждать 
			очень долго), исправьте значение, возвращаемое функцией
			<font color="#3B84D0">get_culture_points</font>, например так:</p><pre class="brush: php;">
return ( $culture + 1500 );
</pre>
			Фрагмент 7.3.8<p>И тогда дело пойдет значительно быстрее!<br>
			<br>
			Страницу <b>tpl_g25<span lang="en-us">_</span>2<span lang="en-us">.php</span></b>, 
			мы сделаем просто:</p><pre class="brush: php;">
// Резиденция

echo &quot;&lt;div id='textmenu'&gt;
&lt;a href='build.php?bnum=$bnum'&gt;Обучить&lt;/a&gt;
| &lt;a href='build.php?bnum=$bnum&amp;amp;p=2'&gt;Культура&lt;/a&gt;
| &lt;a href='build.php?bnum=$bnum&amp;amp;p=3' class='selected'&gt;Одобрение&lt;/a&gt;
| &lt;a href='build.php?bnum=$bnum&amp;amp;p=4'&gt;Экспансия&lt;/a&gt;
&lt;/div&gt;&quot;;

echo '&lt;br&gt;Нападение на деревню совместно с сенаторами, вождями или предводителями может уменьшить лояльность населения. 
Если уровень лояльности достиг нуля, население деревни решает примкнуть к Империи нападающего. Уровень одобрения в этой деревне составляет 
&lt;b&gt;100%&lt;/b&gt;.&lt;br&gt;';
</pre>
			Фрагмент 7.3.9<p>Она у нас пока что будет описательного характера и 
			особого интереса не представляет. Тоже можно сказать и про страницу <b>tpl_g25<span lang="en-us">_</span>3<span lang="en-us">.php</span></b>. 
			Все эти шаблоны Вы можете увидеть <a href="www/tpl">здесь</a>.<br>
			<br>
			На этом занятии мы также сделаем заготовку для 10 урока и соорудим 
			Таверну, хотя все функции ее будем уже создавать на 10 занятии. Для 
			начала определимся с типом здания в справочнике <b>
			building_types </b>и уровнями его апгрейдов в <b>build_levels_cost</b>.<br>
			</p>
<pre class="brush: sql;">insert into building_types (bt_id,bt_name,bt_image,bt_image_not_ready,bt_description,bt_ycoord_dif,bt_template) 
values (14,'Таверна','img/vill/g37.gif','img/vill/g37b.gif','В таверне Вы можете нанять героя. После 10 уровня....',32,'tpl_g37');

/*таверна*/
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_time_upgrade) 
values (14,0,0,0,0,0,0,'0:00:00');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_time_upgrade) 
values (14,1,700,670,700,240,2,'0:29:40');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_time_upgrade) 
values (14,2,930,890,930,320,1,'0:34:10');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_time_upgrade) 
values (14,3,1240,1185,1240,425,1,'0:39:20');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_time_upgrade) 
values (14,4,1645,1575,1645,565,1,'0:46:40');
insert into `build_levels_cost`(bt_id, blc_level, blc_wood, blc_clay, blc_ore, blc_grain, blc_cons, blc_time_upgrade) 
values (14,5,2190,2095,2190,750,1,'0:53:20');
</pre>Фрагмент <span lang="en-us">7</span>.3.10<p>Шаблон для нее пока сделаем 
			статичным:</p><pre class="brush: php;">
// Таверна
echo '&lt;br&gt;&lt;table style=&quot;border-collapse: collapse;&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; id=&quot;army&quot;&gt;&lt;tr&gt;
&lt;td width=&quot;450&quot; class=&quot;tabhead&quot;&gt;Список героев&lt;/td&gt;
&lt;tr&gt;
&lt;td width=&quot;450&quot; class=&quot;armyinfo&quot;&gt;&lt;font color=&quot;#CCCCCC&quot;&gt;В настоящий момент в деревне нет воинов, которые могли бы стать героями.&lt;/font&gt;&lt;/td&gt;
&lt;tr&gt;
&lt;/table&gt;';</pre>
			Фрагмент 7.3.9<p>В 10 занятии мы сделаем в таверне тренировку героя 
			из какого-то типа войска и научим его как захватывать свободные 
			оазисы вокруг поселка.<font color="#4775A5"><span lang="en-us"><strong><br>
			<br>
			<br>
			7</strong></span></font><font color="#4775a5"><strong>.4. 
			Таблица дерева построек</strong></font><br>
			<br>
			&nbsp;&nbsp; В реальной игре <span lang="en-us">travian </span>
			задействован механизм очередности построек. Так, к примеру, нельзя 
			построить конюшню, пока нет казармы&nbsp; или нельзя построить рынок 
			пока нет амбара, склада и главное здание не достигло третьего 
			уровня. Давайте попробуем реализовать нечто подобное и в 
			разрабатываемом нами аналоге игры&nbsp; - <span lang="en-us">
			travgame.</span> <br>
			<span lang="en-us">&nbsp;&nbsp;&nbsp; </span>Конечно же для этих 
			целей нам понадобится новая таблица для хранения информации об 
			очередности построек или по другому можно сказать -&nbsp; дереве 
			построек в поселке игрока<span lang="en-us">.</span> Придумаем имя 
			этой таблице - <span lang="en-us">spr_tree (</span>справочник дерева<span lang="en-us">).</span><br>
			</p>
<pre class="brush: sql;">/* таблица дерева построек */
CREATE TABLE `spr_tree` (
st_id bigint(20) unsigned NOT NULL auto_increment, /*ID*/
bt_id bigint(20), /*ID из building_types, зависимая постройка*/
bt_id_parent bigint(20), /*ID из building_types, постройка (от которой зависит)*/ 
st_level int DEFAULT 0, /*уровень постройки*/ 
PRIMARY KEY (`st_id`) 
) ENGINE=MyISAM DEFAULT CHARSET=cp1251;
</pre>Фрагмент <span lang="en-us">7</span>.4.1<br>
			<br>
			<b>st_id</b>&nbsp;&nbsp; - уникальный идентификатор записи в таблице 
			spr_tree<br>
			<b>bt_id</b> - тип постройки (связь с таблицей <b>
			building_types </b>)<br>
			<b>bt_id_parent</b> - тип постройки (связь с таблицей <b>
			building_types </b>строения (родительское строение) от которого 
			зависит возможность строительства <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
			этого)<br>
			<b>st_level</b> - уровень строения (родительское строение) от 
			которого зависит возможность строительства этого<br>
			<br>
			Таким образом эта структура позволяет знать, что предварительно 
			необходимо построить для того строения, которой мы сейчас хотим 
			возвести в нашем поселке.<span lang="en-us"> </span>Давайте добавим 
			в нее несколько записей:<br>
<pre class="brush: sql;">/*Резиденция требует главного здания уровень 3*/
insert into spr_tree(bt_id,bt_id_parent,st_level) values (13,2,3);

/*Рынок требует Главное здание уровнеь 3, Амбар уровень 1, Склад уровень 1*/
insert into spr_tree(bt_id,bt_id_parent,st_level) values (12,2,3);
insert into spr_tree(bt_id,bt_id_parent,st_level) values (12,3,1);
insert into spr_tree(bt_id,bt_id_parent,st_level) values (12,4,1);
</pre>Фрагмент <span lang="en-us">7</span>.4.2<br>
			<br>
			Добавьте создание новой таблицы spr_tree и несколько строк ее 
			содержимого в наш скриптовый файл создания таблицы
			<span lang="en-us">travgame.sql</span>.<p>Вы видите, что
			<span lang="en-us">,</span> например для типа здания
			<span lang="en-us">(</span>12)<span lang="en-us"> </span>создано 
			сразу три строки. В первой указано главное здание (тип 2)<span lang="en-us">
			</span>и его уровень - 3, во второй и третьей указаны - амбар и 
			склад. А Сейчас давайте сделаем механизм проверки, можно ли строить 
			здание<span lang="en-us"> </span>на выбранной стройплощадке.<span lang="en-us"><br>
			</span>
			<br>
			<br>
<br><font color="#4775A5"><b><span lang="en-us">7</span>.5. 
			Использование дерева</b></font><br>
            <br>
            &nbsp;&nbsp; Вы прекрасно помните, что нажав на любую стройплощадку 
			мы увидим список зданий для постройки. Так, например, для скрипта
			<span lang="en-us">travgame.sql </span>из текущего занятия мы увидим 
			следующий список:<br>
			<br>
			<img border="0" src="pics/sp.png" width="510" height="699"><br>
			<br>
			Рисунок 7.5.1<br>
			<br>
			Если Вы внесли изменения в <span lang="en-us">travgame.sql</span> в 
			соответствии с прошлым пунктом нашего занятия, то строения - рынок и 
			резиденция не будут нам доступны. Как же работает этот механизм? 
			Давайте вспомнит шаблон стройплощадки, который находится в файле
			<span lang="en-us"><b>tpl_iso.php</b>. </span>Он немного поменялся и 
			тепрь выглядит так:</p>
			<pre class="brush: php;">
// Стройплощадка!

$res = mysql_query(&quot;SELECT bt.bt_id,bt.bt_name,bt.bt_image,bt_description,
blc_grain, blc_ore, blc_wood, blc_clay, blc_cons, blc_time_upgrade
FROM building_types bt
inner join build_levels_cost blc on blc.bt_id = bt.bt_id
WHERE blc_level = 1 and bt.bt_id &lt;&gt; 10 and bt.bt_id not in (select bt_id from
buildings b WHERE b.fid = $fid) and bt.bt_id &lt;&gt; 1&quot;, $link )
or die(&quot;Query failed : &quot; . mysql_error());


while ($row = mysql_fetch_array( $res )) {
$btype = $row[&quot;bt_id&quot;]; // какой тип здания?
$bt_name = $row[&quot;bt_name&quot;];
$bt_image = $row[&quot;bt_image&quot;];
$bt_description = $row[&quot;bt_description&quot;];
$a_grain = $row[&quot;blc_grain&quot;];
$a_ore = $row[&quot;blc_ore&quot;];
$a_wood = $row[&quot;blc_gwood&quot;];
$a_clay = $row[&quot;blc_clay&quot;];
$a_cons = $row[&quot;blc_cons&quot;];
$a_time_up = $row[&quot;blc_time_upgrade&quot;];

if ( allow_tree_build( $fid, $btype) ){ // проверим дерево построек?

echo '&lt;br&gt;&lt;img src=&quot;../'.$bt_image.'&quot; align=&quot;right&quot;&gt;'; 
echo &quot;&lt;span class='res_header'&gt;&quot;.$bt_name.&quot; &lt;/span&gt;&lt;br&gt;&lt;br&gt;&quot;;
echo $bt_description.&quot;&lt;br&gt;&lt;br&gt;&quot;;

echo '&lt;img src=&quot;img/res/grain.png&quot;&gt;'.$a_grain.' | &lt;img src=&quot;img/res/ore.png&quot;&gt;'.$a_ore.' | &lt;img src=&quot;img/res/wood.png&quot;&gt;'.$a_wood.' |
 &lt;img src=&quot;img/res/clay.png&quot;&gt;'.$a_clay.' | &lt;img src=&quot;img/res/cons.png&quot;&gt;'.$a_cons.' | &lt;img src=&quot;img/res/time.png&quot;&gt; '.$a_time_up.'&lt;br&gt;';
if( !build_upgrade_in_progress( $fid ) )
echo '&lt;a class=&quot;build&quot; href=&quot;village.php?bnum='.$bnum.'&amp;bt='.$btype.'&quot;&gt;Построить здание &lt;/a&gt;&lt;br&gt;&lt;br&gt;'; 
else echo '&lt;font color=&quot;#CCCCCC&quot;&gt;Строители заняты&lt;/font&gt;'; 
}

}

</pre>
			Фрагмент 7.5.1<p>Вы видите, что в строке 24 появилась проверка при 
			помощи функции <font color="#3B84D0">allow_tree_build</font>, в 
			качестве аргументов которой передается идентификатор поселка и тип 
			строения, который мы собираемся возводить. Как же выглядит эта 
			функция? А вот как:<br>
			</p>
<pre class="brush: sql;">//// разрешено ли строить здания исходя из дерева построек? ///////
function allow_tree_build( $fid, $btype ){
$res = mysql_query(&quot;SELECT st_level,bt_id_parent from spr_tree where bt_id=$btype&quot; ) 
or die(&quot;Query failed : &quot; . mysql_error());
while ($row = mysql_fetch_array( $res )) {
  $bt_id_parent = $row[&quot;bt_id_parent&quot;];
  $st_level = $row[&quot;st_level&quot;];
  if( !is_building_level_exists( $fid,$bt_id_parent,$st_level ) )
    return ( false );
  } 
  return ( true );
}
</pre>Фрагмент <span lang="en-us">7</span>.5.2<p>В ней мы делаем выборку по 
			указанному типу зданию из таблицы spr_tree , то есть ищем - а есть 
			ли в ней записи о строениях, которые нужно построить сперва до того 
			как построится заказанное здание игроком. Если такие постройки есть, 
			то считываем их тип и уровень и передаем в функцию
			<font color="#3B84D0">is_building_level_exists</font>, которая&nbsp; 
			выглядит так:<br>
            </p>
<pre class="brush: sql;">/////// есть ли в поселки такое здания и такого уровня? ////////
function is_building_level_exists( $fid, $btype, $st_level ){
$res = mysql_query(&quot;SELECT bid from buildings where fid=$fid and bt_id=$btype and b_level=$st_level&quot; ) 
or die(&quot;Query failed : &quot; . mysql_error());
return ( mysql_num_rows( $res ) &gt; 0 );
}

</pre>Фрагмент <span lang="en-us">7</span>.5.3<p>Эта функция возвращает
			<span lang="en-us">true </span>или <span lang="en-us">false</span> в 
			зависимости от того, построено ли в поселки игрока нужное здание 
			требуемого уровня.<br>
			Вот и все! Теперь игроку придется позаботится о постройке 
			необходимых зданий и апгрейдов существующих перед тем, как, 
			например, возводить рынок. Вы можете добавить еще какие-нибудь 
			зависимости в таблицу spr_tree. А на сегодня мы закончили текущее 
			занятие.<b><br>
			<br>
			<br>
			В следующем уроке</b> мы <span lang="ru">с Вами займемся 
			операциями торговли ресурсами, узнаем как продавать и покупать 
			ресурсы у других игроков, а также распределять имеющиеся при помощи 
			</span><span lang="en-us">NPC-</span>торговца.<br>
            <br>
            </p>
            <p></p>
            <p></p></font>
            </td>
            <td background="index_files/m_right_m.gif" width="9"><img height="4" src="index_files/m_right_m.gif" width="9" border="0"></td>
          </tr>
        </tbody>
      </table>
      <table cellpadding="0" cellspacing="0" width="100%">
        <tbody>
          <tr>
            <td background="index_files/m_left_m.gif" width="9"></td>
            <td class="newsbody" bgcolor="#fdfdfd">&nbsp;</td>
            <td class="newsbody" bgcolor="#fdfdfd">
            <div class="nav" align="right">Blitz-School© </div>
            </td>
            <td background="index_files/m_right_m.gif" width="9"><img height="4" src="index_files/m_right_m.gif" width="9" border="0"></td>
          </tr>
        </tbody>
      </table>
      <table cellpadding="0" cellspacing="0" height="7" width="100%">
        <tbody>
          <tr>
            <td background="index_files/m_left_b.gif" width="13"><img height="7" src="index_files/m_left_b.gif" width="13" border="0"></td>
            <td background="index_files/m_center_b.gif"><img height="1" src="index_files/spacer.gif" width="1"></td>
            <td width="13"><img height="7" src="index_files/m_right_b.gif" width="13" border="0"></td>
          </tr>
        </tbody>
      </table>
      </div>
      </td>
      <td background="index_files/right_back.gif" valign="top" width="13">&nbsp;</td>
    </tr>
  </tbody>
</table>
<table cellpadding="0" cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td background="index_files/bottom_left.png" height="51" valign="top" width="254">
      <div class="date" style="MARGIN-TOP: 12px; FONT-SIZE: 10px; MARGIN-LEFT: 45px; COLOR: white"><a style="COLOR: rgb(255,255,255)" href  ="index.phtml">Copyright</a>©
2005-2009.
GameSchool</div>
      </td>
      <td background="index_files/bottom.gif" valign="top">
      <div class="date" style="MARGIN-TOP: 12px; FONT-SIZE: 10px; MARGIN-LEFT: 20px; COLOR: rgb(143,145,147)" 
      ><!-- Bottom menu --><a title="Главная страница" style="COLOR: rgb(143,145,147)" href  ="http://www.blitz-school.info/index.phtml">Главная</a><img height="1" src="index_files/spacer.gif" width="22" align="middle">:<img height="1" src="index_files/spacer.gif" width="22" align="middle"><a href="http://www.blitz-school.info/login.phtml"><span style="COLOR: rgb(143,145,147)"  >Вход</span></a><img height="1" src="index_files/spacer.gif" width="22" align="middle">:<img height="1" src="index_files/spacer.gif" width="22" align="middle"><a href="http://www.blitz-school.info/response.phtml"><span style="COLOR: rgb(143,145,147)" 
      >Отзывы</span></a><img height="1" src="index_files/spacer.gif" width="22" align="middle">:<img height="1" src="index_files/spacer.gif" width="22" align="middle"><a href="http://www.blitz-school.info/contacts.phtml"><span style="COLOR: rgb(143,145,147)" 
      >Контакты</span></a><img height="1" src="index_files/spacer.gif" width="22" align="middle">:<img height="1" src="index_files/spacer.gif" width="22" align="middle"><a href="http://www.blitz-school.info/friends.phtml"><span style="COLOR: rgb(143,145,147)" 
      >Обмен ссылками</span></a> </div>
      </td>
      <td width="19"><img height="51" src="index_files/bottom_right.png" width="19" border="0"></td>
    </tr>
  </tbody>
</table>
<div id="menu" onmouseover="showLayer('menu'); Change('products', 'menu2')" onmouseout="hiddenLayer('menu'); Change('products', 'menu1')">
<table border="0" cellpadding="0" cellspacing="0">
  <tbody>
    <tr>
      <td style="WIDTH: 7px; HEIGHT: 7px"><img height="7" alt="" src="index_files/corner1.gif" width="7"></td>
      <td class="top"></td>
      <td style="WIDTH: 7px; HEIGHT: 7px"><img height="7" alt="" src="index_files/corner2.gif" width="7"></td>
    </tr>
    <tr>
      <td class="left"></td>
      <td class="text"><a href="reg.phtml">Курс обучения созданию игр
на Blitz3D</a><br>
      <a href="reg2.phtml">Курс
обучения созданию браузерных онлайновых игр</a> </td>
      <td class="right"></td>
    </tr>
    <tr>
      <td style="BACKGROUND: 0% 50%; WIDTH: 7px; HEIGHT: 7px; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial" 
      ><img height="7" alt="" src="index_files/corner4.gif" width="7"></td>
      <td class="bottom"></td>
      <td style="WIDTH: 7px; HEIGHT: 7px"><img height="7" alt="" src="index_files/corner3.gif" width="7"></td>
    </tr>
  </tbody>
</table>
</div>

</body></html>
